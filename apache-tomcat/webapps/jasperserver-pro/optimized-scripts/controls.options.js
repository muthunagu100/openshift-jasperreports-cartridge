!function(e,t,n,r){function s(e){return e.status>=500?void showErrorPopup(e.responseText):void(e.getResponseHeader("JasperServerError")&&(e.getResponseHeader("SuppressError")||showErrorPopup(e.responseText)))}function i(t,r,s){var i=n.TemplateEngine.renderUrl(p,{reportUnitURI:t});return e.ajax({type:"GET",url:i,success:function(e){r(e.reportOptionsSummary)},error:s,dataType:"json",cache:!1})}function o(t,r,s,i,o,a){var u=n.TemplateEngine.renderUrl(c,{reportUnitURI:t,label:r,overwrite:i});return e.ajax({type:"POST",url:u,processData:!1,data:JSON.stringify(s),success:function(e){o(e)},error:a,contentType:"application/json",dataType:"json"})}function a(t,r,s,i){var o=n.TemplateEngine.renderUrl(d,{reportUnitURI:t,optionId:r});return e.ajax({type:"DELETE",url:o,success:function(e){s(e)},error:i,contentType:"application/json",dataType:"text"})}function u(e){return{id:"",uri:e,label:r.CONTROL_DEFAULT_OPTION_TEXT}}function l(e,n){var r=void 0!==t.find(n,function(e){return e.selected===!0});return r||(e.selected=!0),t.union([e],n)}var p=__jrsConfigs__.contextPath+"/rest_v2/reports{{reportUnitURI}}/options",c=__jrsConfigs__.contextPath+"/rest_v2/reports{{reportUnitURI}}/options?label={{label}}&overwrite={{overwrite}}",d=__jrsConfigs__.contextPath+"/rest_v2/reports{{reportUnitURI}}/options/{{optionId}}";return t.extend(n,{ReportOptions:n.BaseControl.extend({title:"",label:r.CONTROL_OPTIONS_TEXT,type:"reportOptions",update:function(e){var t=this.getElem().find("select"),r=this.getTemplateSection("data");t.empty(),n.Utils.setInnerHtml(t[0],r,{data:e})},bindCustomEventListeners:function(){var e=this.getElem();e&&e.on("change","select",t.bind(function(e){var t=jQuery(e.target).val(),n=this.find({id:t});this.set({selection:n})},this))},fireControlSelectionChangeEvent:function(){var e=this.get("selection");jQuery(document).trigger(n.REPORT_OPTIONS_SELECTION_CHANGE,e)},set:function(e,r){if(void 0!==e.selection){var s=e.selection.id;this.selection=this.find({id:s}),this.enableRemoveButton(""!=s),this.update(t.map(this.values,function(e){return s===e.id?e.selected=!0:delete e.selected,e})),!r&&this.fireControlSelectionChangeEvent()}else n.ReportOptions.__super__.set.apply(this,arguments)},fetch:function(e,n){var r=u(e);return this.set({defaultOption:r}),i(e,t.bind(function(e){var s=t.map(e,function(e){return n&&n==e.uri&&(e.selected=!0),e});s=l(r,s),this.set({values:s})},this),s)},reset:function(e){this.set({selection:this.get("defaultOption")},e)},add:function(e,r,i,a){var u=t.bind(function(e){var n;e.selected=!0;var r=this.get("values"),s=t.find(r,function(e){return e.selected});s&&delete s.selected,n=r?t.union(r,[e]):[e],(!r||t.isEmpty(r))&&(n=l(this.get("defaultOption"),n)),a?this.set({selection:e},!0):this.set({values:n}),this.enableRemoveButton(!0)},this);return o(e,r,i,a,u,s).fail(t.bind(function(e){try{var t=jQuery.parseJSON(e.responseText),r=n.TemplateEngine.render(t.message,t.parameters,n.TemplateEngine.STD_PLACEHOLDERS);this.set({error:r})}catch(s){}},this))},removeOption:function(e,r){var i=t.bind(function(){var e=this.get("selection"),t=this.get("values"),n=t.without(e);this.set({values:n}),this.values.size()<2&&delete this.values},this);return a(e,r,i,s).fail(t.bind(function(e){try{var t=jQuery.parseJSON(e.responseText),r=n.TemplateEngine.render(t.message,t.parameters,n.TemplateEngine.STD_PLACEHOLDERS);this.set({error:r})}catch(s){}},this))},enableRemoveButton:function(t){var n=e("#"+(t?r._BUTTON_REMOVE:r._BUTTON_SAVE))[0],s=e("#"+(t?r._BUTTON_SAVE:r._BUTTON_REMOVE))[0];n&&s&&(jQuery(n).removeClass("hidden"),jQuery(s).addClass("hidden"))}}),REPORT_OPTIONS_SELECTION_CHANGE:"reportoptions:selection:changed"})}(jQuery,_,JRS.Controls,ControlsBase);