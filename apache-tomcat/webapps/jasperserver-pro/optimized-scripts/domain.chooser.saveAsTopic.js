dc.saveAsTopic={RESOURCE_DOESNT_EXISTS_RESPONSE:"resource doesnt exist",RESOURCE_ALREADY_EXISTS_RESPONSE:"resource already exists",RESOURCE_OF_OTHER_TYPE_EXISTS_RESPONSE:"resource of other type already exists",ID_TOPIC_NAME:"topicName",ID_TOPIC_LOCATION:"topicLocation",ID_TOPIC_DESCRIPTION:"topicDesc",ID_DATA_LIFETIME:"dataStrategy_dataLifetimeMinutes",ID_STAGED:"dataStrategy_staged",ID_MAX_ROWS:"dataStrategy_maxRows",ID_HIDDEN_TOPIC_NAME:"slTopicLabel",ID_HIDDEN_TOPIC_LOCATION:"slTopicLocation",ID_HIDDEN_TOPIC_DESCRIPTION:"slTopicDesc",ID_SAVE_AS_TOPIC_CONFIRM:"standardConfirm",SAVE_TOPIC_BUTTONS:["#goToDesigner"],fillForm:function(){$("slTopicLabel").writeAttribute("value",$F("topicName")),$("slTopicLocation").writeAttribute("value",$F("topicLocation")),$("slTopicDesc").writeAttribute("value",$F("topicDesc"))},getFlowControlsClickEventHandler:function(){return this._flowControlsClickEventHandlerWrapper.bind(this)},init:function(e){this.params=e,this.organizationId=e.organizationId,this.storedTopicLocationPath=e.folderURI,this.ORGANIZATIONS_FOLDER_URI=e.organizationsFolderUri,this.ORGANIZATION_MATCHER="^#{org}(/[^/]+#{org})*$".interpolate({org:dc.saveAsTopic.ORGANIZATIONS_FOLDER_URI});var t=e.maxTopicDescription;this.topicName=$(this.ID_TOPIC_NAME),this.topicName.writeAttribute("maxLength",e.maxTopicName),this.topicDescription=$(this.ID_TOPIC_DESCRIPTION),this.topicDescription.writeAttribute("maxLength",t),this.topicDescription.writeAttribute("error",domain._messages.tooLongDescription.replace("{0}",t)),this.topicLocation=$(this.ID_TOPIC_LOCATION),this.saveTopicBtn=null,this.saveAsTopicConfirm=$(this.ID_SAVE_AS_TOPIC_CONFIRM),this._clickHandlersHash=this._clickHandlersFactory(),domain.registerClickHandlers([this._flowControlsClickEventHandlerWrapper.bind(this),this._clickHandler.bind(this)]),this._registerKeyUpHandlers()},_changeEventIdForSaveButtons:function(){this.SAVE_TOPIC_BUTTONS.each(function(e){dc.flowControlsEventMap.get(e).eventId="save"})},_maxLengthValidator:function(e,t,i){var o=!0,r="";return e.length>t&&(r=i,o=!1),{isValid:o,errorMessage:r}},_isDataValid:function(){return this._validateInput(this.topicDescription)},_validateInput:function(e){return ValidationModule.validate([{validator:function(t){return this._maxLengthValidator(t,e.readAttribute("maxLength"),e.readAttribute("error"))}.bind(this),element:e}])},_flowControlsClickEventHandlerWrapper:function(e){function t(e,t){if(!e)return!0;var i=!0;return _.each(e,function(e,o){e?(i=!1,ValidationModule.showError(t[o],e)):ValidationModule.hideError(t[o])}),i}var i=!1;return this.SAVE_TOPIC_BUTTONS.each(function(o){if(domain.elementClicked(e,o)){if(i=!0,this.saveTopicBtn=$$(o).first(),!dc.saveAsTopic._isDataValid())throw $break;var r=this._formToParams();if(!r[this.ID_HIDDEN_TOPIC_NAME])throw dc.flowControlsClickEventHandler(e),$break;throw this.checkIfTopicExists(r,function(e){if(ValidationModule.hideError($(this.ID_TOPIC_NAME)),!e)throw"malformed server response";t(e.validation,{topicLocation:this.topicLocation})&&(e.topicExists&&"no"!=e.topicExists?"nameBusy"==e.topicExists?ValidationModule.showError($(this.ID_TOPIC_NAME),domain._messages.resource_of_other_type_exists):"yes"==e.topicExists&&this.showConfirmDialog().then(function(){this.saveTopic()}.bind(this)):this.saveTopic())}.bind(this)),$break}},this),i||dc.flowControlsClickEventHandler(e)},_clickHandler:function(e){domain.basicClickHandler(e,this._clickHandlersHash)},_registerKeyUpHandlers:function(){var e=this;this.topicDescription.observe("keyup",function(){e._validateInput(this)})},_clickHandlersFactory:function(){return $H({"#browser_button":function(){var e=this.repositoryBrowser;return e.isInitialized?(dialogs.popup.show(e.browseRepositoryDialog),e.saveAsTree.selectFolder($("topicLocation").getValue())):(e.init(this.params),dialogs.popup.show(e.browseRepositoryDialog)),!0}.bind(this)})},checkIfTopicExists:function(e,t){domain.sendAjaxRequest({flowExecutionKey:dc.flowExecutionKey,eventId:"checkIfExists"},e,t)},saveTopic:function(){this._changeEventIdForSaveButtons(),dc.flowControlsClickEventHandler(this.saveTopicBtn)},showConfirmDialog:function(){return dialogs.popupConfirm.show(this.saveAsTopicConfirm,null,{okButtonSelector:"#saveAsTopicOverwriteButtonId",cancelButtonSelector:"#saveAsTopicOverwriteCancelButtonId"})},_formToParams:function(){var e={};return e[this.ID_HIDDEN_TOPIC_NAME]=$F(this.ID_TOPIC_NAME)||this.params.topicName,e[this.ID_HIDDEN_TOPIC_LOCATION]=$F(this.ID_TOPIC_LOCATION)||this.params.topicLocation,e[this.ID_HIDDEN_TOPIC_DESCRIPTION]=$F(this.ID_TOPIC_DESCRIPTION)||this.params.topicDescription,void 0!==$(this.ID_DATA_LIFETIME)&&null!=$(this.ID_DATA_LIFETIME)&&(e[this.ID_DATA_LIFETIME]=$F(this.ID_DATA_LIFETIME),e[this.ID_STAGED]=$(this.ID_STAGED).checked),e}};var dc_saveAs=dc.saveAsTopic;dc_saveAs.repositoryBrowser={isInitialized:!1,init:function(e){this.browseRepositoryDialog=$("selectFromRepository"),this.selectFromRepoButton=$("selectFromRepoBtnSelect"),this.saveAsTree=this.createRepositoryTree(e),this._clickHandlersHash=this._createClickHandlersFactory(),domain.registerClickHandlers([function(e){domain.basicClickHandler(e,this._clickHandlersHash)}.bind(this)]),this.isInitialized=!0},createRepositoryTree:function(e){var t="addFileTreeRepoLocation",i="repositoryTreeFoldersProvider",o=e.folderURI?e.folderURI:"/",r=new dynamicTree.createRepositoryTree(t,{providerId:i,organizationId:e.organizationId,publicFolderUri:e.publicFolderUri});return r.getTreeId=function(){return t},r.selectFolder=function(e){r.openAndSelectNode(e)},r.getSelectedFolderUri=function(){var e=r.getSelectedNode();return e&&e.param.uri},r.observe("server:error",function(){window.console&&console.log("Server internal error occurred on repo tree loading.")}),r.observe("childredPrefetched:loaded",function(){r.openAndSelectNode(o)}),r.observe("tree:loaded",function(){r.openAndSelectNode(o)}),r.observe("node:selected",function(e){this._refreshSelectButtonState(e.memo.node)}.bind(this)),r.showTreePrefetchNodes(o),r},_refreshSelectButtonState:function(e){if(e){var t=!!e.param.uri.match(dc.saveAsTopic.ORGANIZATION_MATCHER);e.param.extra.isWritable&&!t?buttonManager.enable(this.selectFromRepoButton):buttonManager.disable(this.selectFromRepoButton)}},_createClickHandlersFactory:function(){return $H({"#selectFromRepoBtnCancel":function(){dialogs.popup.hide(this.browseRepositoryDialog)}.bind(this),"#selectFromRepoBtnSelect":function(){$("topicLocation").value=this.saveAsTree.getSelectedFolderUri(),dialogs.popup.hide(this.browseRepositoryDialog)}.bind(this)})}},"undefined"==typeof require&&document.observe("dom:loaded",dc.initialize.bind(dc));