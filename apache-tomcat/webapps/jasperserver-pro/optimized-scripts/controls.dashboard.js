!function(t,e,n){return e.extend(n,{DashboardViewModel:n.ViewModel.extend({drawControl:function(e,n){if(e.visible&&n){var o=t("#"+n);o.length>0&&(e.refresh(),o.append(e.getElem()))}},draw:function(t){e.each(this.getControls(),function(e){var n=t[e.id];this.drawControl(e,n)},this)},add:function(t){void 0!==t.structure&&e.each(t.structure,function(t){var e=this.createControl(t);this.drawControl(e,t.decoratorId)},this)}}),DashboardController:n.Controller.extend({decorators:{},getDecorators:function(){return this.decorators},addDecorator:function(t,e){this.decorators[t]||(this.decorators[t]=e)},removeDecoratorByControlId:function(t){delete this.decorators[t]},expandWithDecorators:function(t){var n=this.getDecorators();return e.map(t,function(t){var e=n[t.id];return e?(t.decoratorId=e,t):t})},get:function(t){return this.getViewModel().get(t)},draw:function(){this.getViewModel().draw(this.getDecorators())},addControls:function(t){var n=this.getViewModel(),o=this.getDataTransfer();e.each(t,function(t){this.addDecorator(t.controlId,t.controlFrameId)},this);var r=e.union(n.pluck("id"),e.pluck(t,"controlId")),i=e.bind(this._updateControlsDependencies,this,t),s=e.bind(this._filterResponse,this,t),c=function(t){n.add({structure:t.structure}),n.set({state:t.state},!0)},d={};return e.each(t,function(t){t.controlValue&&(d[t.controlId]=t.controlValue)}),d=e.extend(n.get("selection"),d),o.fetchControlsStructure(r,d).then(i).then(s).done(c)},_filterResponse:function(t,n){var o=e.pluck(t,"controlId"),r=this.expandWithDecorators(n.structure);return r=e.filter(r,function(t){return o.indexOf(t.id)>=0}),{structure:r,state:n.state}},_updateControlsDependencies:function(t,n){var o=n.structure;if(!e.isEmpty(t)){var r=e.pluck(t,"controlId");o=e.filter(n.structure,function(t){return-1===r.indexOf(t.id)})}return e.each(o,function(t){var e=this.viewModel.findControl({id:t.id});e.masterDependencies=t.masterDependencies,e.slaveDependencies=t.slaveDependencies},this),n},removeControls:function(t){var n=this.getViewModel(),o=this.getDataTransfer();e.each(t,e.bind(function(t){var e=n.findControl({id:t});this.removeDecoratorByControlId(e.id),n.removeControl(t)},this));var r=n.pluck("id");if(0!=r.length){var i=e.bind(this._updateControlsDependencies,this,{});return o.fetchControlsStructure(r,n.get("selection")).then(i).done(function(t){n.set({state:t.state},!0)})}}}),SingleSelect:n.SingleSelect.extend({MAIN_CONTROL_CONTAINER_SELECTOR:"div.componentContainer.control.select",bindCustomEventListeners:function(){this.singleSelect.off("selection:change").on("selection:change",function(t){this.set({selection:t})},this).off("expand").on("expand",function(t){var e=t.$el.parents("div.componentContainer.control.select");this.set({zIndex:e.css("z-index")}),e.css("z-index",1001)},this).off("collapse").on("collapse",function(t){var e=t.$el.parents("div.componentContainer.control.select");e.css("z-index",this.get("zIndex"))},this)}})})}(jQuery,_,JRS.Controls);