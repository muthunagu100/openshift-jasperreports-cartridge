domain.typesMap={Integer:"number",Decimal:"number",BigDecimal:"number",Time:"date",Date:"date",Timestamp:"date",String:"string",Boolean:"boolean"},domain.javaNumericTypesValidation={"java.lang.Double":{min:-1/0,max:1/0},"java.math.BigDecimal":{min:-1/0,max:1/0},"java.lang.Long":{min:"-9223372036854775808",max:"9223372036854775807"},"java.lang.Integer":{min:"-2147483648",max:"2147483647"},"java.lang.Short":{min:"-32768",max:"32767"},"java.lang.Byte":{min:"-128",max:"127"}},domain.getNumberBounds=function(e){return domain.javaNumericTypesValidation[e]},domain.filter={CALENDAR_DATE_FORMAT:"M dd yy",CALENDAR_TIMESTAMP_FORMAT:"M dd yy",CALENDAR_TIME_FORMAT:"HH:mm:ss",init:function(e){this.TIMEZONE_OFFSET=e.timeOffset,this.FILTER_DATE_FORMAT=e.dateFormat||"MMM dd yyyy",this.FILTER_TIMESTAMP_FORMAT=e.dateTimeFormat||"MMM dd yyyy HH:mm:ss",this.FILTER_TIME_FORMAT=e.timeFormat||"HH:mm:ss",this.CALENDAR_DATE_FORMAT=e.calendarDateFormat||"M dd yy",this.CALENDAR_TIMESTAMP_FORMAT=e.calendarDateTimeFormat||"M dd yy",this.CALENDAR_TIME_FORMAT=e.calendarTimeFormat||"HH:mm:ss",this.DECIMAL_SEPARATOR=e.decimalSeparator||".",this.GROUPING_SEPARATOR=e.groupingSeparator||",",this.numberFormat=domain.NumberFormat(this.DECIMAL_SEPARATOR,this.GROUPING_SEPARATOR),MONTH_NAMES=Calendar._SMN,DAY_NAMES=Calendar._SDN,domain.javaToDataTypeMap=e.javaToDataTypeMap},toNumber:function(e){return this.numberFormat.toNumber(e)},normalizeNumberEntry:function(e){return this.numberFormat.normalizeNumberEntry(e)},toString:function(e){var t=typeof e;switch(t){case"undefined":case"function":case"unknown":return"{''}";case"boolean":case"number":case"string":return"{"+e.toString()+"}"}return null===e?"{''}":Object.isArray(e)?"{"+this.arrayToString(e)+"}":void 0},arrayToString:function(e){return e.collect(function(e){return isNotNullORUndefined(e)&&""!==e?e:"''"}).join(", ")}},domain.FilterItem=function(e){if(!e||!e.node&&!e.json)throw"Trying to create FilterItem with empty input";this.fieldId=null,this.id=null,this.name=null,this.type=null,this.value=null,this.comparison="",this.locked=null,this.dataType=null,this.javaType=null,this.index=1,e.node?this._initNode(e.node):this._initJson(e.json)},_.extend(domain.FilterItem.prototype,{_initNode:function(e){if(e&&e.param&&e.param.extra){var t=e.param.extra;this.setFieldId(e.param.id),this.name=e.name,this.value=[],this.locked=!1,this.javaType=t.JavaType,domain.javaToDataTypeMap&&this.javaType&&(t.dataType=domain.javaToDataTypeMap[this.javaType]),this.dataType=t.dataType,this.type=domain.typesMap[this.dataType]}},_initJson:function(e){e&&(this.init=!0,this.setFieldId(e.fieldId),this.name=e.fieldName,this.type=e.ruleTypeId||e.ruleType,this.setValues(e.value||e.values),this.locked=!e.isParameter,this.comparison=e.comparisonId||e.comparison,this.dataType=e.dataType,this.javaType=e.javaType||e.JavaType)},setFieldId:function(e){this.fieldId=e,this.id=this.normalizeIdentifier(e)},setValues:function(e){if("field"===this.type){this.field2Id=e[0];var t=_.find(dynamicTree.nodes,function(t){return t.param.id===e[0]});this.name2=t&&t.name}else"string"===this.type&&null===e[0]&&(e=[domain.getMessage("filter_null_value")]);this.value=e},getValues:function(){return"field"===this.type?[this.field2Id]:this.value},normalizeIdentifier:function(e){return e&&e.length>0?e.gsub(/[.]/,"_").gsub(/[\W]/,""):e},updateIndex:function(e){this.index=e,this.id+="_"+e,this.init||(this.name+="_"+e)},toJSON:function(){return{fieldId:this.fieldId,fieldName:this.name,ruleTypeId:this.type,value:this.getValues(),isParameter:!this.locked,comparisonId:this.comparison,dataType:this.dataType,javaType:this.javaType}},initFieldFilterItem:function(e){this.type="field",this.field2Id=e.fieldId,this.name2=e.name,this.value=[this.name2]}}),domain.FilterList=function(e){if(this._valueList=[],this._keyPositionMapping={},e&&"object"==typeof e)for(var t in e)this.set(t,e[t])},_.extend(domain.FilterList.prototype,{reIndex:function(e,t){var i;for(var a in this._keyPositionMapping)i=this._keyPositionMapping[a],i>e&&(this._keyPositionMapping[a]=i+t)},unset:function(e){this._valueList.splice(this._keyPositionMapping[e],1),this.reIndex(this._keyPositionMapping[e],-1),delete this._keyPositionMapping[e]},set:function(e,t,i){this._keyPositionMapping[e]>=0?this._valueList.splice(this._keyPositionMapping[e],1,t):(i=i>=0?i:this._valueList.length,this._valueList.splice(i,0,t),i<this._valueList.length-1&&this.reIndex(i-1,1),this._keyPositionMapping[e]=i)},get:function(e){return this._valueList[this._keyPositionMapping[e]]},size:function(){return this._valueList.length},values:function(){return this._valueList.clone()},collect:function(e){return _.collect.call(_,this._valueList,e)}}),domain.FilterEditor=function(e,t){this.filterValue=e,t&&(this.flowExecutionKey=t),this.init()},_.extend(domain.FilterEditor.prototype,{EDITOR_TEMPLATE:"editorTemplate",create:function(e,t){if(!e||!e.type)return null;var i=null;switch(e.type){case"string":i=new domain.StringFilterEditor(e,t);break;case"number":i=new domain.NumberFilterEditor(e);break;case"date":i=new domain.DateFilterEditor(e);break;case"time":i=new domain.TimeFilterEditor(e);break;case"boolean":i=new domain.BooleanFilterEditor(e);break;case"field":i=new domain.FieldFilterEditor(e);break;default:throw"Unsupported editor type: [#{editorType}]".interpolate({editorType:e.type})}return i},init:function(){this.valueEditorsCache={},this.valueEditorsFactory=this.createValueEditorsFactory(),this.initTemplate(),this.initComparisons(this.getFirstComparison()),this.initEventHandlers()},createValueEditorsFactory:function(){return{}},afterDraw:function(){this.fillinTemplate(),isIE7()&&setWidthStyleByReflection(this.editorTemplate,".content")},beforeRemove:function(){this.removeEventHandlers()},initTemplate:function(){this.editorTemplate=this._cloneTemplate(this.EDITOR_TEMPLATE),this.fieldNameElement=this.editorTemplate.select(".fieldName").first()},fillinTemplate:function(){this.fieldNameElement.update(this.getOriginalValue().name),this.updateFilterValueEditor()},initComparisons:function(e){this._comparisons=this.createComparisons(),this.comparisonId=e,this.comparisonsSelect=this.editorTemplate.select("#fieldAndOperation select")[0],this._comparisons.each(function(t,i){var a={id:t,title:domain.getMessage(t)};t===e&&(a.selected="selected",this.selectedIndex=i);var n=new Element("option",a).insert(domain.getMessage(t));this.comparisonsSelect.insert(n)}.bind(this))},getFirstComparison:function(){return this.getOriginalValue().comparison||"equals"},initEventHandlers:function(){this.comparisonsSelect.observe("change",this.comparisonSelectedHandler.bindAsEventListener(this)),this.getTemplate().observe("submit",function(e){Event.stop(e)})},removeEventHandlers:function(){Event.stopObserving(this.comparisonsSelect),Event.stopObserving(this.getTemplate())},comparisonSelectedHandler:function(e){this.comparisonId=domain.getSelectedOptionId(e.element()),this.updateFilterValueEditor()},updateFilterValueEditor:function(){this.valueEditor=this.createValueEditor(this.comparisonId);var e=this.valueEditor.getTemplate();this.editorTemplate.select("#values")[0].replace(e),this.valueEditor.afterDraw()},createValueEditor:function(e){if(!e)return null;var t=this.getFactoryKey(e),i=this.valueEditorsCache[t];if(!i)try{i=this.valueEditorsFactory[t](this.getOriginalValue.bind(this),e,this.flowExecutionKey),this.valueEditorsCache[t]=i}catch(a){throw"Editor for #{name} is undefined".interpolate({name:t})}return i},processTemplate:function(e){var t=e.select(".fieldName")[0],i=e.select(".operation")[0],a=e.select(".value")[0],n=e.select(".lock")[0],o=this.getValue(),r=o.getOriginalValue();t.update(r.name.escapeHTML()),i.update(domain.getMessage(r.comparison)),a.update(o.getFormattedValue()),o.lockStatusElement&&n.update(domain.getMessage(r.locked?"domain.filter.locked":"domain.filter.unlocked"));var l="f"+r.id+"_filter";if(!$$("#"+l)[0]){var d=o.getTemplate();d.removeClassName("hidden"),e.appendChild(d),d.writeAttribute("id",l)}return e},getTemplate:function(){return this.editorTemplate},getOriginalValue:function(){return this.filterValue},getFormattedValue:function(){return domain.filter.toString(this.getOriginalValue().value)},resetToCurrentEditor:function(){this.comparisonId=this.getOriginalValue().comparison,this.comparisonsSelect.selectedIndex=this.selectedIndex},applyEditorValue:function(){this.filterValue=this.getValue(),this.selectedIndex=this.comparisonsSelect.selectedIndex},cancel:function(){this.resetToCurrentEditor(),disableSelectionWithoutCursorStyle($(document.body)),this.valueEditor&&this.valueEditor.cancel()},getValue:function(){var e=deepClone(this.getOriginalValue());return e.value=this._toArray(this.valueEditor.getValue()),e.comparison=this.comparisonId,e},validate:function(){return this.valueEditor.validate()},_cloneTemplate:function(e){return Element.clone(e,!0)||null},_toArray:function(e){return Object.isArray(e)?e:[e]},handleClick:function(e){this.valueEditor&&domain.FilterValueEditor.handleClick.call(this.valueEditor,e)}}),domain.StringFilterEditor=function(e,t){domain.FilterEditor.call(this,e,t)},domain.StringFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.StringFilterEditor.addMethod("createComparisons",function(){return["isOneOf","isNotOneOf","equals","doesNotEqual","contains","doesNotContain","startsWith","doesNotStartWith","endsWith","doesNotEndWith"]}),domain.StringFilterEditor.addMethod("getFactoryKey",function(e){switch(e){case"isOneOf":case"isNotOneOf":return"MultipleValuesEditor";case"equals":case"doesNotEqual":return"ComboSelectEditor";case"contains":case"doesNotContain":case"startsWith":case"doesNotStartWith":case"endsWith":case"doesNotEndWith":return"StringValueEditor";default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}}),domain.StringFilterEditor.addMethod("createValueEditorsFactory",function(){return{MultipleValuesEditor:function(e,t,i){return new domain.MultipleValuesEditor(e,t,i)},ComboSelectEditor:function(e,t,i){return new domain.ComboSelectEditor(e,t,i)},StringValueEditor:function(e,t,i){return new domain.StringValueEditor(e,t,i)}}}),domain.NumberFilterEditor=function(e){domain.FilterEditor.call(this,e)},domain.NumberFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.NumberFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isGreaterThan","lessThan","isGreaterThanOrEqualTo","isLessThanOrEqualTo","isBetween","isNotBetween"]}),domain.NumberFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isGreaterThan":case"lessThan":case"isGreaterThanOrEqualTo":case"isLessThanOrEqualTo":t=new domain.NumberValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new domain.NumberRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.NumberFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return e.value[0]}}),domain.NumberFilterEditor.addMethod("updateFilterValueEditor",function(){domain.FilterEditor.prototype.updateFilterValueEditor.call(this),this.registerKeypressHandlers()}),domain.NumberFilterEditor.addMethod("registerKeypressHandlers",function(){var e=this.valueEditor.getValueElement();!Object.isArray(e)&&(e=[e]),e.invoke("observe","keyup",function(){var e=this.getValue(),t=domain.filter.normalizeNumberEntry(e);e!=t&&this.setValue(t)})}),domain.BooleanFilterEditor=function(e){domain.FilterEditor.call(this,e)},domain.BooleanFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.BooleanFilterEditor.addMethod("createComparisons",function(){return["equals"]}),domain.BooleanFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":t=new domain.BooleanSelectEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.DateFilterEditor=function(e,t){domain.FilterEditor.call(this,e,t)},domain.DateFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.DateFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore","isBetween","isNotBetween"]}),domain.DateFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isAfter":case"isBefore":case"isOnOrAfter":case"isOnOrBefore":t=new domain.DateValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new domain.DateRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.DateFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return domain.FilterEditor.prototype.getFormattedValue.call(this)}}),domain.TimeFilterEditor=function(e,t){domain.FilterEditor.call(this,e,t)},domain.TimeFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.TimeFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore","isBetween","isNotBetween"]}),domain.TimeFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isAfter":case"isBefore":case"isOnOrAfter":case"isOnOrBefore":t=new domain.StringValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new domain.TimeRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.DateFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return domain.FilterEditor.prototype.getFormattedValue.call(this)}}),domain.FieldFilterEditor=function(e,t){this.newFilterValue=deepClone(e),domain.FilterEditor.call(this,e,t)},domain.FieldFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.FieldFilterEditor.addMethod("createComparisons",function(){switch(domain.typesMap[this.getOriginalValue().dataType]){case"string":return["equals","contains","startsWith","endsWith","doesNotEqual","doesNotContain"];case"number":return["equals","isNotEqualTo","isGreaterThan","lessThan","isGreaterThanOrEqualTo","isLessThanOrEqualTo"];case"date":return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore"];case"boolean":return["equals","isNotEqualTo"];default:throw"Unsupported editor type: [#{editorType}]".interpolate({editorType:filterValue.type})}}),domain.FieldFilterEditor.addMethod("initTemplate",function(){this.editorTemplate=this._cloneTemplate(this.EDITOR_TEMPLATE);var e=this.editorTemplate.down(".checkBox.lock");e&&e.remove();var t=this._cloneTemplate("fieldEditor");t.writeAttribute("id","fieldAndOperation"),t.removeClassName("hidden"),this.editorTemplate.select("#fieldAndOperation").first().replace(t),this.fieldNameElement=this.editorTemplate.select(".fieldName").first(),this.fieldValueElement=this.editorTemplate.select(".fieldName")[1]}),domain.FieldFilterEditor.addMethod("handleClick",function(e){matchAny(e,["button#swap"],!0)&&this.swapClickHandler()}),domain.FieldFilterEditor.addMethod("fillinTemplate",function(){var e=this.newFilterValue;this.fieldNameElement.update(e.name),this.fieldValueElement.update(e.name2)}),domain.FieldFilterEditor.addMethod("getValue",function(){return this.newFilterValue.comparison=this.comparisonId,this.newFilterValue.locked=!0,this.newFilterValue}),domain.FieldFilterEditor.addMethod("cancel",function(){this.resetToCurrentEditor(),this.newFilterValue=deepClone(this.getOriginalValue())}),domain.FieldFilterEditor.addMethod("getFormattedValue",function(){return"{"+String(this.getOriginalValue().name2)+"}"}),domain.FieldFilterEditor.addMethod("validate",function(){return!0}),domain.FieldFilterEditor.addMethod("swapClickHandler",function(){var e=this.newFilterValue,t=e.name,i=e.fieldId;return e.name=e.name2,e.fieldId=e.field2Id,e.name2=t,e.field2Id=i,e.value=[e.name],this.fillinTemplate(),!0}),domain.FieldFilterEditor.addMethod("comparisonSelectedHandler",function(e){this.comparisonId=domain.getSelectedOptionId(e.element())}),domain.FilterValueEditor=function(e,t){this.getOriginalValue=e,this.currentComparisonId=t,this.init()},domain.FilterValueEditor.addMethod("init",function(){this.initTemplate(),this.afterTemplateInitialization(),this.initValidators(),this.initEventHandlers(),this.clickHandlersHash=this.createHandlersHash()}),domain.FilterValueEditor.addMethod("initTemplate",function(){this.template=this.createTemplate(),this.initValueElements()}),domain.FilterValueEditor.addMethod("createTemplate",function(){var e=Element.clone(this.valueEditorId,!0);return e.writeAttribute("id","values"),e.removeClassName("hidden"),e}),domain.FilterValueEditor.addMethod("afterTemplateInitialization",function(){}),domain.FilterValueEditor.addMethod("fillinTemplate",function(){this.currentComparisonId===this.getOriginalValue().comparison&&this.setValue(this.getOriginalValue().value),this.setTitle(this.currentComparisonId)}),domain.FilterValueEditor.addMethod("setTitle",function(e){var t=this.getValueElement();!Object.isArray(t)&&(t=[t]),t&&t.each(function(t){(t.up("label")||t).writeAttribute("title",this.getTitleMessage(e))}.bind(this))}),domain.FilterValueEditor.addMethod("getTitleMessage",function(){return domain.getMessage("filter_default_title")}),domain.FilterValueEditor.addMethod("initValidators",function(){this.validators=this.createCommonValidators().concat(this.createValidators())}),domain.FilterValueEditor.addMethod("createCommonValidators",function(){return[{validator:function(){return domain.valueNotEmptyValidator(this.getValue(),domain.getMessage("value_should_be_not_empty"))}.bind(this),element:this.getValueElement()}]}),domain.FilterValueEditor.addMethod("createValidators",function(){return[]}),domain.FilterValueEditor.addMethod("validate",function(){return this.removeMalicious(),ValidationModule.validate(this.validators)}),domain.FilterValueEditor.addMethod("removeMalicious",function(){this.setValue(this.stripValue(this.getValue()))}),domain.FilterValueEditor.handleClick=function(e){var t=_.find(this.clickHandlersHash,function(t,i){return e.match(i)});t&&t.call(this,e)},domain.FilterValueEditor.addMethod("createHandlersHash",function(){return{}}),domain.FilterValueEditor.addMethod("afterDraw",function(){this.fillinTemplate()}),domain.FilterValueEditor.addMethod("initValueElements",function(){}),domain.FilterValueEditor.addMethod("initEventHandlers",function(){}),domain.FilterValueEditor.addMethod("cancel",function(){}),domain.FilterValueEditor.addMethod("getTemplate",function(){return this.template}),domain.FilterValueEditor.addMethod("setValue",function(e){this.getValueElement().setValue(String(e[0]))}),domain.FilterValueEditor.addMethod("getValue",function(){return this.getValueElement().getValue()}),domain.FilterValueEditor.addMethod("stripValue",function(e){var t=function(e){return e?e.strip().stripScripts():""};return Object.isArray(e)?e.collect(t):[t(e)]}),domain.FilterValueEditor.addMethod("isTimestampField",function(){return"Timestamp"===this.getOriginalValue().dataType}),domain.FilterValueEditor.addMethod("isTimeField",function(){return"Time"===this.getOriginalValue().dataType}),domain.FilterValueEditor.addMethod("_getControlName",function(){return this.isTimestampField()?"datetimepicker":this.isTimeField()?"timepicker":"datepicker"}),domain.FilterValueEditor.addMethod("getValueElement",function(){}),domain.SingleDictionaryEditor=function(e,t,i){this.searchParams={limitType:"contains",itemId:e().fieldId,searchWord:""},this.flowExecutionKey=i,domain.FilterValueEditor.apply(this,arguments)},domain.SingleDictionaryEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.SingleDictionaryEditor.addMethod("afterTemplateInitialization",function(){this.retrieveAvailableDictionaryValues(this.searchParams)}),domain.SingleDictionaryEditor.addMethod("initValueElements",function(){this.searchInputElement=this.getTemplate().select(".searchLockup input")[0],this.searchButtonElement=this.getTemplate().select(".searchLockup > .search.button")[0],this.searchClearElement=this.getTemplate().select(".searchLockup .button.searchClear")[0]}),domain.SingleDictionaryEditor.addMethod("initEventHandlers",function(){this.searchInputElement.observe("keyup",this.handleKeyup.bind(this))}),domain.SingleDictionaryEditor.addMethod("handleKeyup",function(e){switch(e.keyCode){case Event.KEY_TAB:case Event.KEY_ESC:case Event.KEY_LEFT:case Event.KEY_UP:case Event.KEY_RIGHT:case Event.KEY_DOWN:case Event.KEY_DELETE:case Event.KEY_HOME:case Event.KEY_END:case Event.KEY_PAGEUP:case Event.KEY_PAGEDOWN:case Event.KEY_INSERT:return!0;case Event.KEY_RETURN:this.doSearch();break;default:this.onCharacterPressed(e)}return!0}),domain.SingleDictionaryEditor.addMethod("createHandlersHash",function(){return{".button.search":function(){this.doSearch()},".button.searchClear":function(){this.onClearButtonClicked(),this.doSearch(this.onClearButtonClicked.bind(this))}}}),domain.SingleDictionaryEditor.addMethod("onCharacterPressed",function(){this.updateSearchClearButtonState()}),domain.SingleDictionaryEditor.addMethod("updateSearchClearButtonState",function(){this.searchInputElement.getValue().blank()?this.searchClearElement.removeClassName(layoutModule.UP_CLASS):this.searchClearElement.addClassName(layoutModule.UP_CLASS)}),domain.SingleDictionaryEditor.addMethod("doSearch",function(e){ValidationModule.hideError(this.getAvailableValueElement()),this.searchParams.itemId=this.getOriginalValue().fieldId,this.searchParams.searchWord=this.searchInputElement.getValue(),this.retrieveAvailableDictionaryValues(this.searchParams,e)}),domain.SingleDictionaryEditor.addMethod("onClearButtonClicked",function(){this.setSearchValue("")}),domain.SingleDictionaryEditor.addMethod("retrieveAvailableDictionaryValues",function(e,t){domain.sendAjaxRequest({flowExecutionKey:this.flowExecutionKey,eventId:"availableValues"},e,this.handleAvailableValuesRetrieved.bindAsEventListener(this,t))}),domain.SingleDictionaryEditor.addMethod("handleAvailableValuesRetrieved",function(e,t){if(!e||"object"!=typeof e){if("INFO:TOO_MANY_ROWS"===e)return ValidationModule.showError(this.getAvailableValueElement(),domain.getMessage("domain.filter.too_many_records")),void this.getAvailableValueElement().update("");e=[]}try{this.updateDictionaryValuesSelect(e),Object.isFunction(t)&&t()}catch(i){throw"Available values response handling error : #{error}".interpolate({error:i})}}),domain.SingleDictionaryEditor.addMethod("initValidators",function(){this.validators=this.createValidators()}),domain.SingleDictionaryEditor.addMethod("setSearchValue",function(e){this.searchInputElement.setValue(e),this.updateSearchClearButtonState()}),domain.SingleDictionaryEditor.addMethod("afterValueSet",function(){this.updateSearchClearButtonState()}),domain.MultipleValuesEditor=function(){domain.SingleDictionaryEditor.apply(this,arguments)},domain.MultipleValuesEditor.prototype=deepClone(domain.SingleDictionaryEditor.prototype),domain.MultipleValuesEditor.addVar("valueEditorId","multipleValues"),domain.MultipleValuesEditor.addMethod("initValueElements",function(){domain.SingleDictionaryEditor.prototype.initValueElements.apply(this,arguments),this.availableValuesElement=this.getTemplate().select("select.availableValues")[0],this.selectedValuesElement=this.getTemplate().select("select.selectedValues")[0]}),domain.MultipleValuesEditor.addMethod("initEventHandlers",function(){domain.SingleDictionaryEditor.prototype.initEventHandlers.apply(this,arguments);var e=isIE()?"click":"mouseup";e=isIPad()?"blur":e;var t=this.getTemplate();t.on(e,"select.availableValues",domain.moveOption.bindAsEventListener(this,function(){return this.selectedValuesElement}.bind(this))),t.on(e,"select.selectedValues",domain.moveOption.bindAsEventListener(this,function(){return this.availableValuesElement}.bind(this)))}),domain.MultipleValuesEditor.addMethod("updateDictionaryValuesSelect",function(e){{var t=domain.getSelectValues(this.selectedValuesElement),i=_.difference(e,t),a=domain.createSelectWithOptions(i,{"class":this.availableValuesElement.readAttribute("class"),multiple:"multiple"});this.availableValuesElement}this.availableValuesElement.replace(a),this.availableValuesElement=this.getTemplate().select("select.availableValues")[0]}),domain.moveOption=domain.MultipleValuesEditor.moveSelectOption=function(e,t){function i(e,i){e.remove();var a=_.find(i.options,function(t){return t.value>e.value});a?$(a).insert({before:new Element("option",{value:e.value,title:e.text}).update(e.text)}):i.insert(new Element("option",{value:e.value,title:e.text}).update(e.text)),t.focus()}var a=e.element(),t=t(),n=a.selectedIndex>-1?$(a.options[a.selectedIndex]):e.element();isIPad()?a.childElements().each(function(e){e.selected&&i(e,t)}):Object.isUndefined(n.selectedIndex)&&i(n,t)},domain.MultipleValuesEditor.addMethod("createValidators",function(){return[{validator:function(){return domain.baseValidator(function(e){return 0===e.options.length}.curry(this.selectedValuesElement),domain.getMessage("value_should_be_not_empty"))}.bind(this),element:this.selectedValuesElement}]}),domain.MultipleValuesEditor.addMethod("removeMalicious",function(){}),domain.MultipleValuesEditor.addMethod("cancel",function(){ValidationModule.hideError(this.selectedValuesElement),this.reloadAvailable=!0}),domain.MultipleValuesEditor.addMethod("setValue",function(e){this.reloadAvailable&&this.afterTemplateInitialization(),domain.setSelectOptions(this.selectedValuesElement,e),this.afterValueSet()}),domain.MultipleValuesEditor.addMethod("getAvailableValueElement",function(){return this.availableValuesElement}),domain.MultipleValuesEditor.addMethod("getValueElement",function(){return this.selectedValuesElement}),domain.MultipleValuesEditor.addMethod("getValue",function(){return domain.getSelectValues(this.selectedValuesElement)}),domain.MultipleValuesEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_multiple_values_title",{comparison:domain.getMessage(e)})}),domain.ComboSelectEditor=function(){domain.SingleDictionaryEditor.apply(this,arguments)},domain.ComboSelectEditor.prototype=deepClone(domain.SingleDictionaryEditor.prototype),domain.ComboSelectEditor.addVar("valueEditorId","comboValues"),domain.ComboSelectEditor.addMethod("initValueElements",function(){domain.SingleDictionaryEditor.prototype.initValueElements.apply(this,arguments),this.availableValuesElement=this.getTemplate().select("select")[0],this.inputElement=this.searchInputElement}),domain.ComboSelectEditor.addMethod("initEventHandlers",function(){domain.SingleDictionaryEditor.prototype.initEventHandlers.apply(this,arguments),this.initValueChangeHandler(),new Field.Observer(this.inputElement,.3,function(e,t){e.writeAttribute("title",t)})}),domain.ComboSelectEditor.addMethod("initValueChangeHandler",function(){this.availableValuesElement.observe("change",this.valueSelectedHandler.bind(this))}),domain.ComboSelectEditor.addMethod("valueSelectedHandler",function(e){this.setValue(e.element().getValue())}),domain.ComboSelectEditor.addMethod("updateDictionaryValuesSelect",function(e){var t=""===e[0]?[]:[""];Event.stopObserving(this.availableValuesElement),this.availableValuesElement.replace(domain.createSelectWithOptions(t,e)),this.availableValuesElement=this.getTemplate().select("select")[0],this.initValueChangeHandler(),this.availableValuesElement.selectedIndex=0}),domain.ComboSelectEditor.addMethod("onCharacterPressed",function(){domain.SingleDictionaryEditor.prototype.onCharacterPressed.call(this),this.availableValuesElement.selectedIndex=0}),domain.ComboSelectEditor.addMethod("onClearButtonClicked",function(){domain.SingleDictionaryEditor.prototype.onClearButtonClicked.call(this),this.availableValuesElement.selectedIndex=0}),domain.ComboSelectEditor.addMethod("setValue",function(e){Object.isArray(e)&&(e=e[0]),this.inputElement.setValue(e),this.afterValueSet()}),domain.ComboSelectEditor.addMethod("getAvailableValueElement",function(){return this.availableValuesElement}),domain.ComboSelectEditor.addMethod("getValueElement",function(){return this.inputElement}),domain.ComboSelectEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_combo_title",{comparison:domain.getMessage(e)})}),domain.StringValueEditor=function(){domain.FilterValueEditor.apply(this,arguments)},domain.StringValueEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.StringValueEditor.addVar("valueEditorId","stringValues"),domain.StringValueEditor.addMethod("initValueElements",function(){this.stringValueElement=this.getTemplate().select("input")[0]}),domain.StringValueEditor.addMethod("createValidators",function(){return[{validator:function(e){return domain.maxLengthValidator(e,1e3,domain.getMessage("too_long_text"))}.bind(this),element:this.getValueElement()}]}),domain.StringValueEditor.addMethod("getValueElement",function(){return this.stringValueElement}),domain.StringValueEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_string_title",{comparison:domain.getMessage(e)})}),domain.NumberValueEditor=function(){domain.StringValueEditor.apply(this,arguments)},domain.NumberValueEditor.prototype=deepClone(domain.StringValueEditor.prototype),domain.NumberValueEditor.addMethod("createValidators",function(){var e=this.getOriginalValue().javaType,t=this.getOriginalValue().dataType,i=domain.getNumberBounds(e)||{min:-1/0,max:1/0};return[{validator:function(a){var n=domain.numberValidator(a,domain.filter.numberFormat,domain.getMessage("wrong_number_format",{value:a}));return n.isValid&&(n=domain.baseValidator(function(){return"Integer"===t&&domain.filter.numberFormat.isInteger(a)},domain.getMessage("domain.filter.incorrect_integer_value")),n.isValid&&(n=domain.numberBoundsValidator(domain.filter.toNumber(a),i,domain.getMessage("number_out_of_bounds",{type:e})))),n},element:this.getValueElement()}]}),domain.NumberValueEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_number_title",{comparison:domain.getMessage(e)})}),domain.ValueRangeEditor=function(){domain.FilterValueEditor.apply(this,arguments)},domain.ValueRangeEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.ValueRangeEditor.addMethod("initValueElements",function(){this.rangeValueElements=_.collect(this.getValueRangeIds(),function(e){return this.getTemplate().select("#"+e.inputId)[0]},this)}),domain.ValueRangeEditor.addMethod("createCommonValidators",function(){return _.collect(this.getValueRangeIds(),function(e,t){return{validator:function(e){return domain.valueNotEmptyValidator(this.getElementValue(e),domain.getMessage("value_should_be_not_empty"))}.bind(this,t),element:this.getElement(t)}},this)}),domain.ValueRangeEditor.addMethod("setValue",function(e){_.each(this.getValueRangeIds(),function(t,i){this.getElement(i).setValue(e[i])},this)}),domain.ValueRangeEditor.addMethod("getElement",function(e){return this.rangeValueElements[e]}),domain.ValueRangeEditor.addMethod("getElementValue",function(e){return this.getElement(e).getValue()}),domain.ValueRangeEditor.addMethod("getValue",function(){return _.collect(this.getValueRangeIds(),function(e,t){return this.getElementValue(t)},this)}),domain.ValueRangeEditor.addMethod("getValueElement",function(){return this.rangeValueElements
}),domain.ValueRangeEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_range_title",{comparison:domain.getMessage(e)})}),domain.NumberRangeEditor=function(e){var t=e().id;this.valueEditorId="numberRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.numberRangeNames=_.collect([1,2],function(e){var i=this.RANGE_INPUT_ID+"_"+e;return{standardInputId:i,inputId:t+"_"+i}},this),domain.ValueRangeEditor.apply(this,arguments)},domain.NumberRangeEditor.prototype=deepClone(domain.ValueRangeEditor.prototype),domain.NumberRangeEditor.addMethod("getValueRangeIds",function(){return this.numberRangeNames}),domain.NumberRangeEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return _.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),domain.NumberRangeEditor.addMethod("createValidators",function(){var e=this.getOriginalValue().javaType,t=domain.getNumberBounds(e)||{min:-1/0,max:1/0},i=this.getOriginalValue().dataType;return _.collect(this.getValueRangeIds(),function(a,n){return{validator:function(a){var n=this.getElementValue(a),o=domain.numberValidator(n,domain.filter.numberFormat,domain.getMessage("wrong_number_format",{value:n}));return o.isValid&&(o=domain.baseValidator(function(){return"Integer"===i&&domain.filter.numberFormat.isInteger(n)},domain.getMessage("domain.filter.incorrect_integer_value")),o.isValid&&(o=domain.numberBoundsValidator(domain.filter.toNumber(n),t,domain.getMessage("number_out_of_bounds",{type:e})))),o}.bind(this,n),element:this.getElement(n)}},this).concat({validator:function(){var e=this.getElementValue(0),t=this.getElementValue(1);return domain.rangeValidator(domain.filter.toNumber(e),domain.filter.toNumber(t),domain.getMessage("number_range_error",{from:e,to:t}))}.bind(this),element:this.getElement(1)})}),domain.DateValueEditor=function(e){"Date"===e().dataType?(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_DATE_FORMAT):"Time"===e().dataType?(this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIME_FORMAT):(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIMESTAMP_FORMAT),this.timeZoneOffset=domain.filter.TIMEZONE_OFFSET,this.valueEditorId="dateValues",this.CALENDAR_INPUT_ID="calendar_input",this.CALENDAR_BUTTON_ID="calendar_button",this.dateInputName=e().id+this.CALENDAR_INPUT_ID,this.dateButtonName=e().id+this.CALENDAR_BUTTON_ID,domain.FilterValueEditor.apply(this,arguments)},domain.DateValueEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.DateValueEditor.addMethod("initValueElements",function(){this.dateValueElement=this.getTemplate().select("#"+this.dateInputName)[0]}),domain.DateValueEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return e.select("#"+this.CALENDAR_INPUT_ID)[0].writeAttribute("id",this.dateInputName),e}),domain.DateValueEditor.addMethod("afterDraw",function(){jQuery("#"+this.dateInputName)[this._getControlName()]({showOn:"button",buttonText:"",dateFormat:this.dateFormat,timeFormat:this.timeFormat,changeYear:!0,changeMonth:!0,showSecond:this.isTimestampField()||this.isTimeField(),showButtonPanel:!0,onChangeMonthYear:null,beforeShow:jQuery.datepicker.movePickerRelativelyToTriggerIcon}).next().addClass("button").addClass("picker"),jQuery("#"+this.dateInputName)[0].getValue=function(){return jQuery(this).val()},this.fillinTemplate()}),domain.DateValueEditor.addMethod("createValidators",function(){return[{validator:function(e){return this.isTimestampField()&&0!==getDateFromFormat(e,domain.filter.FILTER_DATE_FORMAT)&&(e+=" 00:00"),domain.dateValidator(e,this.getOriginalValue().dateFormat,domain.getMessage("wrong_date_format",{value:e}))}.bind(this),element:this.getValueElement()}]}),domain.DateValueEditor.addMethod("getValueElement",function(){return this.dateValueElement}),domain.DateValueEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_date_title",{comparison:domain.getMessage(e)})}),domain.DateRangeEditor=function(e){"Date"===e().dataType?(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,e().dateFormat=domain.filter.FILTER_DATE_FORMAT):"Time"===e().dataType?(this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIME_FORMAT):(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIMESTAMP_FORMAT),this.timeZoneOffset=domain.filter.TIMEZONE_OFFSET;var t=e().id;this.valueEditorId="dateRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.dateRangeNames=_.collect([1,2],function(e){var i=this.RANGE_INPUT_ID+"_"+e,a=i+this.BUTTON_SUFFIX;return{standardInputId:i,inputId:t+"_"+i,standardButtonId:a,buttonId:t+"_"+a}},this),domain.ValueRangeEditor.apply(this,arguments)},domain.DateRangeEditor.prototype=deepClone(domain.ValueRangeEditor.prototype),domain.DateRangeEditor.addMethod("getValueRangeIds",function(){return this.dateRangeNames}),domain.DateRangeEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return _.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),domain.DateRangeEditor.addMethod("afterDraw",function(){_.each(this.getValueRangeIds(),function(e){jQuery("#"+e.inputId)[this._getControlName()]({showOn:"button",buttonText:"",dateFormat:this.dateFormat,timeFormat:this.timeFormat,changeYear:!0,changeMonth:!0,showButtonPanel:!0,showSecond:this.isTimestampField()||this.isTimeField(),onChangeMonthYear:null,beforeShow:jQuery.datepicker.movePickerRelativelyToTriggerIcon}).next().addClass("button").addClass("picker"),jQuery("#"+e.inputId)[0].getValue=function(){return jQuery(this).val()}},this),this.fillinTemplate()}),domain.DateRangeEditor.addMethod("createValidators",function(){return _.collect(this.getValueRangeIds(),function(e,t){return{validator:function(e){var t=this.getElementValue(e);return this.isTimestampField()&&0!==getDateFromFormat(t,domain.filter.FILTER_DATE_FORMAT)&&(t+=" 00:00"),domain.dateValidator(t,this.getOriginalValue().dateFormat,domain.getMessage("wrong_date_format",{value:t}))}.bind(this,t),element:this.getElement(t)}},this).concat({validator:function(){var e=this.getElementValue(0),t=this.getElementValue(1);return domain.rangeValidator(getDateFromFormat(e,this.getOriginalValue().dateFormat),getDateFromFormat(t,this.getOriginalValue().dateFormat),domain.getMessage("date_range_error",{from:e,to:t}))}.bind(this),element:this.getElement(1)})}),domain.TimeRangeEditor=function(e){var t=e().id;this.valueEditorId="numberRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.numberRangeNames=_.collect([1,2],function(e){var i=this.RANGE_INPUT_ID+"_"+e;return{standardInputId:i,inputId:t+"_"+i}},this),domain.ValueRangeEditor.apply(this,arguments)},domain.TimeRangeEditor.prototype=deepClone(domain.ValueRangeEditor.prototype),domain.TimeRangeEditor.addMethod("getValueRangeIds",function(){return this.numberRangeNames}),domain.TimeRangeEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return _.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),domain.BooleanSelectEditor=function(){domain.FilterValueEditor.apply(this,arguments)},domain.BooleanSelectEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.BooleanSelectEditor.addVar("valueEditorId","singleSelectValues"),domain.BooleanSelectEditor.addMethod("initValueElements",function(){this.availableValuesElement=this.getTemplate().select("select")[0],this.setValueList()}),domain.BooleanSelectEditor.addMethod("setValueList",function(){domain.setSelectOptions(this.availableValuesElement,["true","false"])}),domain.BooleanSelectEditor.addMethod("createValidators",function(){return[]}),domain.BooleanSelectEditor.addMethod("getValueElement",function(){return this.availableValuesElement}),domain.FilterModelController=function(e,t,i){domain.filter.init(i),this.PRE_FILTERS_PANEL="preFilters",this.FILTERS_LIST_ID=e,this.FILTER_EDITOR_CANCEL_BUTTON_ID="filterEditorCancel",this.FILTER_EDITOR_OK_BUTTON_ID="filterEditorOk",this.CREATE_MODE="create",this.UPDATE_MODE="update",this.targetHiddenFieldId="slRules",this.initParams=i,this.filterEditor=t,this._filterEditorsMap=null,this._currentFilter=null,this.mode=null},domain.FilterModelController.addMethod("init",function(){if(this._list=new dynamicList.List(this.FILTERS_LIST_ID,{listTemplateDomId:"list_domain_chooser_filter",itemTemplateDomId:"list_domain_chooser_filter:leaf",excludeFromSelectionTriggers:[".leaf *"],excludeFromEventHandling:!0}),isIPad()){var e=$(this.FILTERS_LIST_ID);new TouchController(e,e.up())}try{this._filterEditorsMap=new domain.FilterList,this.initFilters()}catch(t){window.console&&console.error("Filters initialization failed. Error : #{error}".interpolate({error:t}))}finally{this.updateHiddenField(),this._initListEvents(),this.drawList()}}),domain.FilterModelController.addMethod("initFilters",function(){this.initParams.filtersJson.each(function(e){this.addNewToFilterEditorsMap(this.filterEditor.prototype.create(new domain.FilterItem({json:e}),this.initParams.flowExecutionKey))}.bind(this))}),domain.FilterModelController.addMethod("initDropContainer",function(e){var t={onDrop:this.onDropHandler.bind(this)};e&&(t.accept=e),Droppables.add($(this.PRE_FILTERS_PANEL),t)}),domain.FilterModelController.addMethod("onDropHandler",function(e){var t=e.node;if(t){var i=domain.getSelectedTreeNodes(dynamicTree.trees[t.getTreeId()]);try{1===i.length?this.addFilter(new domain.FilterItem({node:t})):2===i.length&&this.addFieldFilter(i)}catch(a){console&&console.error(a)}}}),domain.FilterModelController.addMethod("addNewToFilterEditorsMap",function(e,t){if(e){var i=e.getOriginalValue();this.mode!==this.UPDATE_MODE&&this._updateIdIfFilterPresent(i),this._filterEditorsMap.set(i.id,e,t)}}),domain.FilterModelController.addMethod("_prepareListItem",function(e){var t=new dynamicList.ListItem({cssClassName:layoutModule.LEAF_CLASS,value:e});return t.processTemplate=e.processTemplate,t}),domain.FilterModelController.addMethod("drawList",function(){var e=this._filterEditorsMap.values().collect(this._prepareListItem);this.getList().setItems(e),this.getList().show()}),domain.FilterModelController.addMethod("refreshScroll",function(){var e=layoutModule.scrolls.get(this.PRE_FILTERS_PANEL);e&&e.refresh()}),domain.FilterModelController.addMethod("addFieldFilter",function(e){if(domain.areNodesFromSameIsland(e)){var t=e.collect(function(e){return new domain.FilterItem({node:e})}),i=t.first();i.type===t[1].type&&(i.initFieldFilterItem(t[1]),this.addFilter(i))}}),domain.FilterModelController.addMethod("addFilter",function(e){try{this.cancelPreviousEditing(),this._updateIdIfFilterPresent(e);var t=this.filterEditor.prototype.create(e,this.initParams.flowExecutionKey),i=this._prepareListItem(t);this.setCurrentFilter(i),this.getList().insertItems(0,[i]),this.getList().refresh(),$(this.FILTERS_LIST_ID).up().scrollTop=0,this.editMode(i),this.mode=this.CREATE_MODE}catch(a){throw this.setCurrentFilter(null),"Unknown filter creation error: #{error}".interpolate({error:a})}}),domain.FilterModelController.addMethod("editFilter",function(e){this.cancelPreviousEditing(),e.getValue().resetToCurrentEditor(),this.editMode(e),this.mode=this.UPDATE_MODE}),domain.FilterModelController.addMethod("cancelPreviousEditing",function(){if(this._currentFilter){var e=this._currentFilter.getValue();e.cancel();var t=e.getOriginalValue();this._filterEditorsMap.get(t.id)?(this._setItemClassName(this._currentFilter,""),this._currentFilter.refresh()):this.getList().removeItems([this._currentFilter]),this.setCurrentFilter(null)}}),domain.FilterModelController.addMethod("removeFilter",function(e){if(e){var t=e.getValue();t.beforeRemove(),this._filterEditorsMap.unset(t.getOriginalValue().id),this.getList().removeItems([e]),this.refreshScroll(),this.updateHiddenField()}}),domain.FilterModelController.addMethod("editMode",function(e){this.setCurrentFilter(e),this._setItemClassName(e,"editMode"),e.getValue().afterDraw(),this.refreshScroll(),enableSelection($(document.body))}),domain.FilterModelController.addMethod("saveFilter",function(e){var t=e.getValue();t.validate()&&(t.applyEditorValue(),this.addNewToFilterEditorsMap(t,0),this.cancelPreviousEditing(),this.updateHiddenField())}),domain.FilterModelController.addMethod("getList",function(){return this._list}),domain.FilterModelController.addVar("listEventFactory",{"item:click":function(e){Event.stop(e);var t=Event.extend(e.memo.targetEvent),i=t.element(),a=e.memo.item,n=[i].concat(i.ancestors().slice(0,2)),o=_.any(this._editorElementsMap,function(e,i){return Selector.findElement(n,i,0)?(Event.stop(t),e.call(this,a),!0):!1},this);if(!o){var r=a.getValue();r.handleClick(i)}}}),domain.FilterModelController.addVar("_editorElementsMap",{"#filterEditorOk":function(e){this.saveFilter(e)},"#filterEditorCancel":function(){this.cancelPreviousEditing()},".change":function(e){this.editFilter(e)},".remove":function(e){this.removeFilter(e)}}),domain.FilterModelController.addVar("treeEventFactory",{"leaf:dblclick":function(e){var t=e.memo.node;if(Event.stop(e),t){var i=domain.getSelectedTreeNodes(dynamicTree.trees[t.getTreeId()]);try{2===i.length?this.addFieldFilter(i):this.addFilter(new domain.FilterItem({node:t}))}catch(e){console&&console.error(e)}}}}),domain.FilterModelController.addMethod("setCurrentFilter",function(e){this._currentFilter=e}),domain.FilterModelController.addMethod("_setItemClassName",function(e,t){e.setCssClassName(t),e.refreshStyle()}),domain.FilterModelController.addMethod("_initListEvents",function(){for(var e in this.listEventFactory)this._list.observe(e,this.listEventFactory[e].bindAsEventListener(this))}),domain.FilterModelController.addMethod("_updateIdIfFilterPresent",function(e){var t=this._filterEditorsMap.get(e.id);return t&&e.updateIndex(++t.getOriginalValue().index),e}),domain.FilterModelController.addMethod("updateHiddenField",function(){var e=Object.toJSON(this._filterEditorsMap.collect(function(e){return e.getOriginalValue()}));$$("#"+this.targetHiddenFieldId)[0].writeAttribute("value",e)}),domain.setSelectOptions=function(e,t){if(!Object.isElement(e)||!t||!Object.isArray(t))return e;var i=new Date;e.update("");var a=[];return domain.appendOptions(a,t),e.update(a.join("")),isIE()&&(e.className=e.className),window.console&&window.console.log("Select input update time : "+(new Date-i)+" ms."),e},domain.createSelectWithOptions=function(){var e=new Date,t=arguments[arguments.length-1],i="";_.isArray(t)||"object"!=typeof t||(i=_.reduce(t||{},function(e,t,i){return e+=i+'="'+t+'" '},""));for(var a=["<select "+i+">"],n=0;n<arguments.length;n++){var o=arguments[n];o&&_.isArray(o)&&domain.appendOptions(a,o)}return a.push("</select>"),window.console&&window.console.log("String conversion time : "+(new Date-e)+" ms."),a.join("")},domain.appendOptions=function(e,t){for(var i,a,n=0;n<t.length;n++)i=a=null!==t[n]?t[n].replace(/'/g,"&#39;"):domain.getMessage("filter_null_value"),""===t[n]&&(i=domain.getMessage("filter_empty_string")),e.push("<option title='"+i+"' value='"+a+"'>"+i+"</option>")},domain.getSelectValues=function(e){return _.map(e.options,function(e){return e.readAttribute("value")})},domain.getSelectedOptionId=function(e){if(!Object.isElement(e))return null;var t=e.options[e.selectedIndex];return t.readAttribute("id")},domain.getSelectedTreeNodes=function(e){var t=e.selectedNodes;if(Object.isArray(t))return t.findAll(function(e){return!e.isParent()})};