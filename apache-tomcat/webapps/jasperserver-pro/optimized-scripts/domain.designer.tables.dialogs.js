dd_tables.manageDataSourceDialog={_OK_BUTTON_ID:"ok",_DIALOG_DOM_ID:"manageDataSource",_DATA_SOURCE_ALIAS_ID:"dataSourceAlias",_SELECT_SCHEMAS_ID:"selectSchemas",_dialog:null,_callback:null,_selectSchema:null,_getSchemas:null,_dataSourceUri:null,_dataSourceId:null,_selectedDataSourceProperties:null,_dataSourcePropertiesCache:{},_doNotSelectSchema:!0,_visible:!1,init:function(e){dd_tables.manageDataSourceDialog._init.bind(dd_tables.manageDataSourceDialog,e)()},show:function(e,t){dd_tables.manageDataSourceDialog._showInternal.bind(dd_tables.manageDataSourceDialog,e,t)()},_init:function(e){this._dialog=$(this._DIALOG_DOM_ID),this._callback=e.callback,this._selectSchema=e.selectSchema,this._getSchemas=e.getSchemas,this._dataSourceUri=e.dataSourceUri,this._hasSchemas=e.hasSchemas,e.onSelectNode=function(){domain.enableButton(this._OK_BUTTON_ID,!1),buttonManager.disable($(this._SELECT_SCHEMAS_ID))}.bind(this),e.selectDataSource=this._selectDataSource.bind(this),e.isVisible=this._isVisible.bind(this),e.getDataSourceId=this._getDataSourceId.bind(this),e.getAlias=this._getDataSourceAlias.bind(this),this.dataSourceTree.initialize(e),domain.registerClickHandlers([this._clickEventHandler.bind(this)])},_showInternal:function(e,t){if(this._doNotSelectSchema=!0,this._dataSourceUri=e.uri,this._dataSourceId=e.id,$(this._DATA_SOURCE_ALIAS_ID).value=e.name,this._selectedDataSourceProperties=t[e.name],this._selectedDataSourceProperties||(this._selectedDataSourceProperties={}),!this._dataSourcePropertiesCache[this._dataSourceUri]){var i=function(e){this._handleDataSourceProperties(this._getSelectedDataSource(),!1,e),this._enableSelectSchemas(this._dataSourcePropertiesCache[this._dataSourceUri])}.bind(this);this._getSchemas(this._getSelectedDataSource(),i)}this._show(),this.dataSourceTree.selectFolder(this._dataSourceUri),domain.enableButton(this._OK_BUTTON_ID,!0)},_clickEventHandler:function(e){var t=!1;return this.clickHandlerFactory.each(function(i){if(domain.elementClicked(e,i.key))throw i.value.bind(this)(),t=!0,$break}.bind(this)),t},_show:function(){this._visible=!0,dialogs.popup.show(this._dialog,!0)},_hide:function(){dialogs.popup.hide(this._dialog),this._visible=!1},_selectDataSource:function(e){return this._doNotSelectSchema?(this._doNotSelectSchema=!1,void this._enableSelectSchemas(this._dataSourcePropertiesCache[this._dataSourceUri])):(domain.enableButton(this._OK_BUTTON_ID,!1),void this._selectSchema({dataSource:e,initialChange:!1,callback:this._schemaSelectedCallback.bind(this,e),handleDsProps:this._handleDataSourceProperties.bind(this,e,!0),dsProps:this._buildDataSourcePropertiesFromCache(e),selectedSchemas:this._selectedDataSourceProperties.schemas,hideDialog:this._hide.bind(this),showDialog:this._show.bind(this)}))},_buildDataSourcePropertiesFromCache:function(e){var t=null;return this._dataSourcePropertiesCache[e.uri]&&(t={},t[e.name]=this._dataSourcePropertiesCache[e.uri]),t},_schemaSelectedCallback:function(e,t){this._selectedDataSourceProperties=t[e.name],this._dataSourceUri=e.uri,this._dataSourceId=e.id,this._enableSelectSchemas(this._dataSourcePropertiesCache[this._dataSourceUri]),domain.enableButton(this._OK_BUTTON_ID,!0)},_handleDataSourceProperties:function(e,t,i){this._hasSchemas(i,e.name)&&t&&this._hide(),this._dataSourcePropertiesCache[e.uri]=i[e.name]},_onOk:function(){this._isDataValid()&&(dd.setUnsavedChangesPresent(!0),this._callback&&this._callback(this._getSelectedDataSource(),this._getSelectedDataSourceProperties()),this._hide())},_onCancel:function(){ValidationModule.hideError($(this._DATA_SOURCE_ALIAS_ID)),this._hide()},_enableSelectSchemas:function(e){e&&e.schemas&&e.schemas.first()?buttonManager.enable($(this._SELECT_SCHEMAS_ID)):buttonManager.disable($(this._SELECT_SCHEMAS_ID))},_selectSchemas:function(){var e=this._getSelectedDataSource();this._hide();var t=function(t){this._show(),this._schemaSelectedCallback(e,t)}.bind(this);this._selectSchema({dataSource:e,initialChange:!1,callback:t,handleDsProps:null,dsProps:this._buildDataSourcePropertiesFromCache(e),selectedSchemas:this._selectedDataSourceProperties.schemas})},_isDataValid:function(){return ValidationModule.validate([{validator:function(e){return{isValid:!!e,errorMessage:domain.getMessage("manageDataSource.emptyName")}},element:$(this._DATA_SOURCE_ALIAS_ID)}])},_getSelectedDataSource:function(){return{id:this._dataSourceId,name:this._getDataSourceAlias(),uri:this._dataSourceUri}},_getSelectedDataSourceProperties:function(){var e={};return e[this._getDataSourceAlias()]=this._selectedDataSourceProperties,e},_getDataSourceAlias:function(){return $F(this._DATA_SOURCE_ALIAS_ID)},_getDataSourceId:function(){return this._dataSourceId},_isVisible:function(){return this._visible}};var mds_dialog=dd_tables.manageDataSourceDialog;mds_dialog.dataSourceTree={_TREE_ID:"selectDataSourceTree",_PROVIDER_ID:"dataSourceTreeDataProvider",_organizationId:null,_publicFolderUri:null,_uri:null,_tree:null,_onSelectNode:null,_selectDataSource:null,_isVisible:null,_getDataSourceId:null,_getAlias:null,initialize:function(e){mds_dialog.dataSourceTree._initialize.bind(mds_dialog.dataSourceTree,e)()},selectFolder:function(e){mds_dialog.dataSourceTree._selectFolder.bind(mds_dialog.dataSourceTree,e)()},_initialize:function(e){this._uri=e.dataSourceUri,this._organizationId=e.organizationId,this._publicFolderUri=e.publicFolderUri,this._onSelectNode=e.onSelectNode,this._selectDataSource=e.selectDataSource,this._isVisible=e.isVisible,this._getDataSourceId=e.getDataSourceId,this._getAlias=e.getAlias,this._tree=dynamicTree.createRepositoryTree(this._TREE_ID,{providerId:this._PROVIDER_ID,rootUri:"/",organizationId:this._organizationId,publicFolderUri:this._publicFolderUri});for(var t in this.treeEventHandlerFactory)this._tree.observe(t,this.treeEventHandlerFactory[t].bindAsEventListener(this));this._tree.showTreePrefetchNodes(this._uri)},_selectFolder:function(e){this._uri=e,this._tree.openAndSelectNode(e)},_childrenPrefetchedLoaded:function(){this._isVisible()&&this._tree.openAndSelectNode(this._uri)},_treeLoaded:function(){this._isVisible()&&this._tree.openAndSelectNode(this._uri)},_leafSelected:function(e){var t={id:this._getDataSourceId(),name:this._getAlias(),uri:e.memo.node.param.uri};this._selectDataSource(t)},_nodeSelected:function(){this._onSelectNode()}},dd_tables.selectSchemasDialog={_SELECT_DIALOG_DOM_ID:"select",_SCHEMA_DIALOG_LIST_DOM_ID:"schemasList",_SELECT_DIALOG_OK_BUTTON_ID:"selectDialogOk",_LIST_TEMPLATE:"list_responsive_collapsible_fields",_LIST_ITEM_TEMPLATE:"list_responsive_collapsible_fields:fields",_dialog:null,_callback:null,_standalone:!0,_list:null,_listItems:null,_selectedSchemas:null,_dataSource:null,_findInvalidFields:null,_fixSchemaPrefixesValidate:null,init:function(e,t){dd_tables.selectSchemasDialog._init.bind(dd_tables.selectSchemasDialog,e,t)()},show:function(e){dd_tables.selectSchemasDialog._show.bind(dd_tables.selectSchemasDialog,e)()},_init:function(e,t){this._dialog=$(this._SELECT_DIALOG_DOM_ID),this._findInvalidFields=e,this._fixSchemaPrefixesValidate=t,this._list=new dynamicList.List(this._SCHEMA_DIALOG_LIST_DOM_ID,{listTemplateDomId:this._LIST_TEMPLATE,itemTemplateDomId:this._LIST_ITEM_TEMPLATE,multiSelect:!0,items:[]}),this._list.observe("item:click",this._listClickHandler.bindAsEventListener(this)),domain.registerClickHandlers([this._clickeventHandler.bind(this)])},_show:function(e){this._callback=e.callback,this._selectedSchemas=e.selectedSchemas?e.selectedSchemas:[],this._dataSource=e.dataSource,this._standalone=e.standalone,this._initList(e.schemasList,e.selectedSchemas),this._standalone&&domain.enableButton(this._SELECT_DIALOG_OK_BUTTON_ID,!1),dialogs.popup.show(this._dialog,!0)},_clickeventHandler:function(e){var t=!1;return this.clickEventHandlerFactory.each(function(i){if(domain.elementClicked(e,i.key))throw i.value.bind(this)(),t=!0,$break}.bind(this)),t},_listClickHandler:function(){domain.enableButton(this._SELECT_DIALOG_OK_BUTTON_ID,this._list.getSelectedItems().first())},_hide:function(){dialogs.popup.hide(this._dialog)},_onOk:function(){this._hide(),this._fixSchemaPrefixesValidate(this._findInvalidFields,this._findInvalidFieldsCallback.bind(this),this._getSelectedSchemasList(),this._dataSource)},_getSelectedSchemasList:function(){return this._list.getSelectedItems().collect(function(e){return e.getValue()})},_findInvalidFieldsCallback:function(){this._callback&&this._callback(this._getSelectedSchemasList())},_onCancel:function(){this._standalone?domain.submitForm(dd.formDomId,{_eventId:"cancel",_flowExecutionKey:dd.flowExecutionKey,flowId:dd.FLOW_ID},dd.fillForm):(this._hide(),this._callback&&this._callback(this._selectedSchemas))},_initList:function(e,t){this._items&&this._list.removeItems(this._items);var i=[];this._items=e.collect(function(e){var a=new dynamicList.ListItem({label:e,value:e});if(t&&t.first()){var s=t.find(function(t){return t===e});!!s&&i.push(a)}return a}),this._list.setItems(this._items),this._list.show(),i.first()&&i.each(function(e){e.select()})}};var ss_dialog=dd_tables.selectSchemasDialog;mds_dialog.clickHandlerFactory=$H({"#ok":mds_dialog._onOk,"#cancel":mds_dialog._onCancel,"#selectSchemas":mds_dialog._selectSchemas}),mds_dialog.dataSourceTree.treeEventHandlerFactory={"server:error":domain.treeErrorHandler,"childredPrefetched:loaded":mds_dialog.dataSourceTree._childrenPrefetchedLoaded,"tree:loaded":mds_dialog.dataSourceTree._treeLoaded,"leaf:selected":mds_dialog.dataSourceTree._leafSelected,"node:selected":mds_dialog.dataSourceTree._nodeSelected},ss_dialog.clickEventHandlerFactory=$H({"#selectDialogOk":ss_dialog._onOk,"#selectDialogCancel":ss_dialog._onCancel});