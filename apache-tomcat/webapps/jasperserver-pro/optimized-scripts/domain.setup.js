domain.wizard={securityFile:null,bundles:null,bundleList:null,bundleExtention:".properties",selectSecurityDialog:null,selectBundleDialog:null,isDataSourceValid:!0,organizationId:null,publicFolderUri:null,STEP_DISPLAY_FORM:"pageForm",INPUT_DS:"dataSourceInput",LAUNCH_DD:"launchDD",CREATE_RADIO:"schemaCreateRadio",UPLOAD_RADIO:"schemaUploadRadio",BROWSER_BUTTON:"browser_button",DATA_SOURCE_BROWSER_BUTTON:"ds_browser_button",SCHEMA_UPLOAD:"schemaUpload",LAUNCHER:"launcher",RESOURCE_ALREADY_EXISTS:"resource already exists",ADD_BUNDLE_LEAF:"addBundleLeaf",INPUT_SL_NAME:"slName",INPUT_SL_RESOURCE_ID:"slResourceID",SCHEMA_DESCRIPTION:"slDescription",SCHEMA_LOCATION:"schemaLocation",SCHEMA_LOCATION_HIDDEN:"slLocation",BUTTON_SAVE:"done",BUTTON_CANCEL:"cancel_button",_canGenerateId:!0,initialize:function(){function e(){null!=domain.wizard.securityFile&&domain.wizard.updateSecurityFileUI()}function i(){for(var e=[],i=0;i<domain.wizard.bundles.length;i++)e.push(new dynamicList.ListItem({label:domain.wizard.bundles[i],value:domain.wizard.bundles[i],respondOnItemEvents:!1}));e.each(function(e){e.processTemplate=function(e){return e.select("p.one > a")[0].update(this._value),e.select("p.two > a")[0].update(domain.getMessage("CSLD_CHANGE_LINK")),e.select("p.two > a")[1].update(domain.getMessage("CSLD_REMOVE_LINK")),e}}),domain.wizard.bundleList=new dynamicList.List("bundlesList",{listTemplateDomId:"list_domain_bundles",itemTemplateDomId:"list_domain_bundles:leaf",items:e}),domain.wizard.bundleList.show()}if(webHelpModule.setCurrentContext("domain"),domain.confirmDialog.init(),domain.detailsDialog.init(),this._label=$(this.INPUT_SL_NAME),this._resourceId=$(this.INPUT_SL_RESOURCE_ID),this._description=$(this.SCHEMA_DESCRIPTION),this._label.validator=resource.labelValidator.bind(this),this._resourceId.validator=resource.resourceIdValidator.bind(this),this._description.validator=resource.descriptionValidator.bind(this),this._isEditMode="edit"==domain.wizard.mode,$(this.STEP_DISPLAY_FORM).observe("keyup",function(e){var i=e.element(),t=[this._label,this._resourceId,this._description];t.include(i)&&(ValidationModule.validate(resource.getValidationEntries([i])),i==this._resourceId&&this._resourceId.getValue()!=resource.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),i==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(resource.generateResourceId(this._label.getValue())),ValidationModule.validate(resource.getValidationEntries([this._resourceId]))))}.bindAsEventListener(this)),$(this.STEP_DISPLAY_FORM).observe("click",function(e){var i=e.element(),t=matchAny(i,[layoutModule.BUTTON_PATTERN],!0);if(t){if(t.match("#"+this.BUTTON_SAVE)&&!t.hasAttribute(layoutModule.DISABLED_ATTR_NAME))return this.saveSchema(),void e.stop();if(t.match("#"+this.BUTTON_CANCEL))return this.exit(),void e.stop()}if(i.match("#"+this.LAUNCH_DD)&&!i.hasAttribute(layoutModule.DISABLED_ATTR_NAME))return void this.launchDomainDesigner();if(i.match("#"+this.CREATE_RADIO))return this.disableUploadSchema(),void this.enableCreateLink();if(i.match("#"+this.UPLOAD_RADIO))return domain.wizard.enableUploadSchema(),void domain.wizard.disableCreateLink();if(i.match("a#addSecurityLink"))return void this.addSecurityFile();if(i.match("p.one > a")){if(matchMeOrUp(i,"#securityFileLeaf"))return void this.downloadSecurityFile();if(matchMeOrUp(i,"#bundlesList"))return void this.downloadBundle(i.up("li"))}return i.match("p.two > a")?void(matchMeOrUp(i,"#securityFileLeaf")?i.previous("a")?this.removeSecurityFile():this.changeSecurityFile():matchMeOrUp(i,"#bundlesList")&&(i.previous("a")?this.removeBundle(i.up("li")):this.changeBundle(i.up("li")))):void(i.match("a#addBundleLink")&&this.addBundle())}.bindAsEventListener(this)),jQuery("#"+this.STEP_DISPLAY_FORM).on("submit",function(e){e.preventDefault()}),$(this.INPUT_SL_NAME).observe("change",this.onNameChange.bind(this)),$(this.SCHEMA_LOCATION).observe("change",this.onLocationChange.bind(this)),$(this.INPUT_DS).observe("change",this.updateDataSourceUri.bind(this)),$(this.SCHEMA_UPLOAD).observe("change",this._uploadSchema.bind(this)),!this.firstLoad){var t=$(this.INPUT_DS);this.selectedDatasourcesUri.length>0&&(t.value=this.selectedDatasourcesUri[0])}this.dataSourceSelector=new picker.FileSelector({treeId:"addResourceTreeRepoLocation",providerId:"repositoryTreeDatasourceProvider",uriTextboxId:this.INPUT_DS,browseButtonId:this.DATA_SOURCE_BROWSER_BUTTON,onOk:this.updateDataSourceUri.bind(this),title:domain.getMessage("CSLD_SELECT_DS_FROM_REPO"),selectLeavesOnly:!0,suffix:"_DataSourcePicker",treeOptions:{organizationId:this.organizationId,publicFolderUri:this.publicFolderUri}}),this.selectSecurityDialog=new SelectFileDialog({idSuffix:"_security"}),this.selectBundleDialog=new SelectFileDialog({idSuffix:"_bundle"}),this.folderSelector=new picker.FileSelector({treeId:"addResourceTreeRepoLocation",providerId:"repositoryTreeFoldersProvider",uriTextboxId:this.SCHEMA_LOCATION,browseButtonId:this.BROWSER_BUTTON,onOk:this.onLocationChange.bind(this),title:domain.getMessage("CSLD_SAVE_DS_DIALOG_TITLE"),disabled:"create"!==this.mode,suffix:"_LocationPicker",treeOptions:{organizationId:this.organizationId,publicFolderUri:this.publicFolderUri}}),$H({repositoryTreeSecurityProvider:this.selectSecurityDialog,repositoryTreeBundleProvider:this.selectBundleDialog}).each(function(e){e.value.tree=dynamicTree.createRepositoryTree(e.value.treeLocationId,{providerId:e.key,organizationId:this.organizationId,publicFolderUri:this.publicFolderUri}),e.value.tree.showTree(1)}.bind(this)),e(),i(),this.refreshSchemaArea(),this.refreshSaveButton()},onNameChange:function(){ValidationModule.hideError($(this.INPUT_SL_NAME)),this.refreshSaveButton()},onLocationChange:function(){ValidationModule.hideError($(this.SCHEMA_LOCATION)),$(this.SCHEMA_LOCATION_HIDDEN).setValue($F(this.SCHEMA_LOCATION)),this.refreshSaveButton()},refreshSaveButton:function(){var e=this.getDataSource();$(this.INPUT_SL_NAME).getValue().length>0&&$(this.SCHEMA_LOCATION).getValue().length>0&&e&&e.uri.length>0&&this.isSchemaSet&&this.isDataSourceValid?domain.enableButton(this.BUTTON_SAVE,!0):domain.enableButton(this.BUTTON_SAVE,!1)},getDataSource:function(){var e=$F(this.INPUT_DS);return!e.length>0?{uri:"",name:""}:e.startsWith("/")&&e.split("/").last()?{uri:e,name:e.split("/").last()}:!1},checkDataSource:function(e,i){var t=function(e){"success"===e?(this.isDataSourceValid=!0,i&&i()):(ValidationModule.showError($(this.INPUT_DS),domain.getMessage("CSLD_DATA_SOURCE_IS_INVALID")),this.isDataSourceValid=!1,this.refreshSchemaArea(),this.refreshSaveButton())}.bind(this),a={datasources:"['"+e.uri+"']"};this._sendInfo("checkDataSource",a,t)},updateDataSourceUri:function(){var e=function(e){this._sendInfo("convertTablesToVds",{prependSubDsId:e},function(){dialogs.systemConfirm.show(domain.getMessage("CSLD_SCHEMA_PREFIXES_UPDATED"))})}.bind(this),i=function(e){this._sendInfo("convertTablesFromVds",{removeSubDsId:e},function(){dialogs.systemConfirm.show(domain.getMessage("CSLD_SCHEMA_PREFIXES_UPDATED"))})}.bind(this),t=this.getDataSource();if(ValidationModule.hideError($(this.INPUT_DS)),this.refreshSchemaArea(),this.refreshSaveButton(),!t)return void ValidationModule.showError($(this.INPUT_DS),domain.getMessage("CSLD_DATA_SOURCE_IS_INVALID"));if(t.uri){var a=function(){var a={datasources:"['"+t.uri+"']",mappedDatasources:"[{'"+t.name+"':'"+t.uri+"'}]"},o=function(a){a.prependSubDsId?domain.confirmDialog.show("convertPrefixToVdsConfirmMessage",function(){e(a.prependSubDsId)},null,null,domain.confirmDialog.MODE_YES_NO):a.removeSubDsId&&domain.confirmDialog.show("convertPrefixFromVdsConfirmMessage",function(){i(a.removeSubDsId)},null,null,domain.confirmDialog.MODE_YES_NO),a.isSchemaSet&&(this.isSchemaSet=!0),this.selectedDatasourcesUri=[t.uri],dialogs.systemConfirm.show(domain.getMessage("CSLD_DATA_SOURCE_IS_SET")),this.refreshSchemaArea(),this.refreshSaveButton()}.bind(this);this._sendInfo("setDatasources",a,o)}.bind(this);this.checkDataSource(t,a)}},enableSchemaArea:function(){$(domain.wizard.CREATE_RADIO).removeAttribute(layoutModule.DISABLED_ATTR_NAME),$(domain.wizard.UPLOAD_RADIO).removeAttribute(layoutModule.DISABLED_ATTR_NAME),$(domain.wizard.LAUNCH_DD).removeAttribute(layoutModule.DISABLED_ATTR_NAME),$(domain.wizard.UPLOAD_RADIO).checked&&$(domain.wizard.SCHEMA_UPLOAD).removeAttribute(layoutModule.DISABLED_ATTR_NAME)},disableSchemaArea:function(){$(domain.wizard.CREATE_RADIO).setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME),$(domain.wizard.UPLOAD_RADIO).setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME),$(domain.wizard.LAUNCH_DD).setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME),$(domain.wizard.SCHEMA_UPLOAD).setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME)},refreshSchemaArea:function(){var e=this.getDataSource();e&&e.uri.length>0&&this.isDataSourceValid?this.enableSchemaArea():this.disableSchemaArea()},enableCreateLink:function(){$(domain.wizard.LAUNCH_DD).removeClassName(layoutModule.DISABLED_CLASS).addClassName(domain.wizard.LAUNCHER)},disableCreateLink:function(){$(domain.wizard.LAUNCH_DD).removeClassName(domain.wizard.LAUNCHER).addClassName(layoutModule.DISABLED_CLASS)},enableUploadSchema:function(){$(domain.wizard.SCHEMA_UPLOAD).removeAttribute(layoutModule.DISABLED_ATTR_NAME)},disableUploadSchema:function(){$(domain.wizard.SCHEMA_UPLOAD).setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME)},launchDomainDesigner:function(){var e=$(domain.wizard.STEP_DISPLAY_FORM);e.action="flow.html?_flowId=createSLDatasourceFlow",e.method="post",e.enctype="multipart/form-data",e._eventId.value=domain.wizard.isSchemaSet?"editSchema":"createSchema",e.submit()},addSecurityFile:function(){domain.wizard.showSelectResourceFromRepository({fileType:"security",mode:"add"})},downloadSecurityFile:function(){var e={securityFile:domain.wizard.securityFile,_flowExecutionKey:domain.wizard.flowExecutionKey,_eventId:"downloadFile"},i="flow.html?"+Object.toQueryString(e);ajaxIframeDownload(i)},changeSecurityFile:function(){domain.wizard.showSelectResourceFromRepository({fileType:"security",mode:"edit"})},removeSecurityFile:function(){var e={securityUri:domain.wizard.securityFile},i=function(e){e.result?(domain.wizard.securityFile=null,dialogs.systemConfirm.show(domain.getMessage("CSLD_SECURITY_FILE_IS_REMOVED")),$("securityFileLeaf").addClassName("hidden"),$("noSecurityFileLeaf").removeClassName("hidden")):dialogs.systemConfirm.show(domain.getMessage("error"))}.bind(this);domain.wizard._sendInfo("deleteSecurity",e,i)},updateSecurityFileUI:function(){var e=$("securityFileLeaf");e.removeClassName("hidden"),$("noSecurityFileLeaf").addClassName("hidden"),e.select("p.one > a")[0].update(domain.wizard.securityFile),e.select("p.two > a")[0].update(domain.getMessage("CSLD_CHANGE_LINK")),e.select("p.two > a")[1].update(domain.getMessage("CSLD_REMOVE_LINK"))},addBundle:function(){domain.wizard.showSelectResourceFromRepository({fileType:"bundle",mode:"add"})},changeBundle:function(e){domain.wizard.showSelectResourceFromRepository({fileType:"bundle",mode:"edit",oldUri:e.listItem.getValue(),oldId:e.listItem.getId()})},downloadBundle:function(e){var i={bundle:e.listItem.getValue(),_flowExecutionKey:domain.wizard.flowExecutionKey,_eventId:"downloadFile"},t="flow.html?"+Object.toQueryString(i);ajaxIframeDownload(t)},removeBundle:function(e){var i=e.listItem.getValue(),t=[];t.push(i);var a={deletedBundles:"['"+t.join("','")+"']"},o=function(i){if(i.result){for(var t=e.listItem.getValue(),a=0;a<domain.wizard.bundles.length;a++)if(t==domain.wizard.bundles[a]){domain.wizard.bundles.splice(a,1);break}e.listItem.remove(),dialogs.systemConfirm.show(domain.getMessage("CSLD_BUNDLE_REMOVED"))}else dialogs.systemConfirm.show(domain.getMessage("error"))}.bind(this);domain.wizard._sendInfo("deleteBundle",a,o)},showSelectResourceFromRepository:function(e){var i,t,a=null;"security"==e.fileType?(t=domain.getMessage("add"==e.mode?"CSLD_ADD_SECURITY_FILE":"CSLD_CHANGE_SECURITY_FILE"),i=domain.wizard.selectSecurityDialog,a=domain.wizard._uploadSecurity):"bundle"==e.fileType&&(t=domain.getMessage("add"==e.mode?"CSLD_ADD_BUNDLE_FILE":"CSLD_CHANGE_BUNDLE_FILE"),i=domain.wizard.selectBundleDialog,a=domain.wizard._uploadBundle),i.title.update(t),i.filePath.value="",i.tree._deselectAllNodes(),i.fromLocalRadio.checked=!0,ValidationModule.hideError(i.filePath),ValidationModule.hideError(i.fromRepoRadio),this.fromLocalHandler(i),i.show(),i.selectedFileClickSelect=function(){a(this,e)&&i.hide()}},fromLocalHandler:function(e){"local"!==e.mode&&(e.mode="local",e.filePath.removeAttribute(layoutModule.DISABLED_ATTR_NAME),e.lastSelectedNode=e.tree.selectedNodes.first(),e.tree._deselectAllNodes(),e.tree._getElement().setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME),e.fromLocalRadio.checked=!0)},fromRepoHandler:function(e){"repo"!==e.mode&&(e.mode="repo",e.tree._getElement().removeAttribute(layoutModule.DISABLED_ATTR_NAME),e.lastSelectedNode&&e.lastSelectedNode.select(),e.filePath.setAttribute(layoutModule.DISABLED_ATTR_NAME,layoutModule.DISABLED_ATTR_NAME),e.fromRepoRadio.checked=!0)},isCorrectBundle:function(e){var i;return e.endsWith(this.bundleExtention)?domain.wizard.bundles.length>0&&(i=domain.wizard.getFileName(domain.wizard.bundles[0]),!domain.wizard.isSameBaseName(i,e))?domain.getMessage("notSameBaseName"):null:domain.getMessage("notCorrectBundleFileType")},isSameBaseName:function(e,i){var t,a=this.getBundleSuffix(e),o=this.getBundleSuffix(i);t=e.length-a.length-this.bundleExtention.length;var s=e.substr(0,t);t=i.length-o.length-this.bundleExtention.length;var d=i.substr(0,t);return s==d},getBundleSuffix:function(e){var i=new RegExp(".*(?:(?:[_])([a-z][a-z]))(?:[_]){0,1}([A-Z][A-Z]){0,1}(?:(?:[_])([^_]*)){0,1}.properties"),t=i.exec(e);if(t){var a="_"+t[1],o=t[2]?"_"+t[2]:"",s=t[3]?"_"+t[3]:"";return a+o+s}return""},getFileName:function(e){for(var i,t=["\\","/"],a=0;a<t.length&&(i=e.lastIndexOf(t[a]),-1==i);a++);var o=e.substr(-1==i?0:i+1,e.length);return 0==o.length?e:o},saveSchema:function(){this.isValidateNameAndDescription($(this.INPUT_SL_NAME),$(this.SCHEMA_DESCRIPTION))&&this.validateAndSave()},isValidateNameAndDescription:function(e,i){return ValidationModule.hideError(e),ValidationModule.hideError(i),ValidationModule.validate([{validator:function(e){return domain.maxLengthValidator(e,100,domain.getMessage("tooLongName"))},element:e},{validator:function(e){return domain.maxLengthValidator(e,250,domain.getMessage("tooLongDescription"))},element:i}])},validateAndSave:function(e){var i=function(i){if(i.result)this.RESOURCE_ALREADY_EXISTS===i.message&&"create"==this.mode?ValidationModule.showError($(this.INPUT_SL_RESOURCE_ID),domain._messages.resourceIdDuplicate):e?dialogs.systemConfirm.show(domain.getMessage("CSLD_SCHEMA_UPLOADED")):this._doSave(!1);else{e&&(domain.wizard.isSchemaSet||(domain.enableButton(this.BUTTON_SAVE,!1),$(this.LAUNCH_DD).update(domain.getMessage("CSLD_CREATE_WITH_DD"))),dialogs.systemConfirm.show(domain.getMessage("CSLD_SCHEMA_UPLOAD_ERROR"),5e3));var t,a;i.message?(a=domainUtil.getUsedResourcesList(i.message,domain._messages.ITEM_BEING_USED_BY_RESOURCE),t=a.length||domainUtil.indexOfNoAccessMessage(i.message,domain._messages.resourcesWithNoAccess)>-1?domainUtil.getUsedResourcesFormattedMessage(a,i.message,{"resource.label":domain._messages["resource.label"],"field.label":domain._messages["field.label"],ITEM_BEING_USED_BY_RESOURCE:domain._messages.ITEM_BEING_USED_BY_RESOURCE,resourcesWithNoAccess:domain._messages.resourcesWithNoAccess}):i.message):t=domain.getMessage("CSLD_DOMAIN_VALIDATION_ERROR"),domain.wizard.allowDesignerCloseWithValidationErrors&&(a.length||domainUtil.indexOfNoAccessMessage(i.message,domain._messages.resourcesWithNoAccess)>-1)?domain.confirmDialog.show("invalidDesignConfirmMessage",_.bind(function(){this._doSave(!1)},this),function(){},_.bind(function(e){this._showAffectedResources(e,t)},this),domain.confirmDialog.MODE_YES_NO):domain.detailsDialog.show(t)}}.bind(this),t={slName:$F(this.INPUT_SL_NAME),slResourceID:$F(this.INPUT_SL_RESOURCE_ID),slLocation:$F(this.SCHEMA_LOCATION)};ValidationModule.hideError($(this.INPUT_DS)),ValidationModule.hideError($(this.INPUT_SL_NAME)),ValidationModule.hideError($(this.SCHEMA_LOCATION)),this._sendInfo("validateAndCheckIfExists",t,i)},_showAffectedResources:function(e,i){return domain.elementClicked(e,"#designDetails")?(domain.detailsDialog.show(i),!0):void 0},_doSave:function(e){var i=function(e){e.result?(dialogs.systemConfirm.show(domain.getMessage("CSLD_DOMAIN_SAVED")),setTimeout(this.exit,500)):"folder does not exists"===e.message?ValidationModule.showError($(this.SCHEMA_LOCATION),domain.getMessage("CSLD_FOLDER_DOESNT_EXIST")):"Access is denied"===e.message?ValidationModule.showError($(this.SCHEMA_LOCATION),domain.getMessage("CSLD_ACCESS_DENIED")):dialogs.systemConfirm.show(e.message?e.message:domain.getMessage("error"))}.bind(this),t={slName:$F(this.INPUT_SL_NAME),slResourceID:$F(this.INPUT_SL_RESOURCE_ID),slDescription:$F(this.SCHEMA_DESCRIPTION),slLocation:$F(this.SCHEMA_LOCATION),mode:this.mode,overwrite:e};ValidationModule.hideError($(this.SCHEMA_LOCATION)),domain.wizard._sendInfo("save",t,i)},exit:function(){var e=$(domain.wizard.STEP_DISPLAY_FORM);e.action="flow.html?_flowId=createSLDatasourceFlow",e._eventId.value="cancel",e.submit()},_uploadSchema:function(e){if(ValidationModule.hideError($(this.UPLOAD_RADIO)),e.target.getValue().endsWith(".xml")){var i=function(e){"string"==typeof e&&(e=e.evalJSON()),e.result?(this.isSchemaSet=!0,this.wasDesignResetted=!0,$(this.LAUNCH_DD).update(domain.getMessage("CSLD_EDIT_WITH_DD")),this.refreshSaveButton()):(ValidationModule.showError($(this.UPLOAD_RADIO),domain.getMessage("CSLD_SCHEMA_UPLOAD_ERROR")),e.message&&domain.detailsDialog.show(e.message)),this.validateAndSave(!0)}.bind(this),t=function(){this._fileUpload($("schemaUpload"),{fileType:"schema"},i)}.bind(this),a=function(){e.target.setValue(""),$(this.CREATE_RADIO).click()}.bind(this);"edit"===this.mode?domain.confirmDialog.show("uploadSchemaConfirmMessage",t,a,null,domain.confirmDialog.MODE_OK_CANCEL):t()}else ValidationModule.showError($(this.UPLOAD_RADIO),domain.getMessage("notCorrectSecurityFileType"))},_uploadSecurity:function(e,i){function t(i){e.filePath=e._dom.select("#filePath"+e.idSuffix)[0],"string"==typeof i&&(i=i.evalJSON()),i.result?(domain.wizard.securityFile=i.fileName,domain.wizard.updateSecurityFileUI(),ValidationModule.hideError($("securityFileError").select("div > p")[0]),dialogs.systemConfirm.show(domain.getMessage("CSLD_SECURITY_FILE_IS_SET"))):(ValidationModule.showError($("securityFileError").select("div > p")[0],domain.getMessage("securityUploadError")),i.message&&domain.detailsDialog.show(i.message))}var a=e.filePath.hasAttribute(layoutModule.DISABLED_ATTR_NAME),o=a?e.selectedURI:e.filePath.getValue();return a||o.endsWith(".xml")?(a?(i.securityUri=o,domain.wizard._sendInfo("addSecurityFromRepo",i,t)):domain.wizard._fileUpload(e.filePath,i,t),!0):(ValidationModule.showError(e.filePath,domain.getMessage("notCorrectSecurityFileType")),!1)},_uploadBundle:function(e,i){function t(t){if(e.filePath=e._dom.select("#filePath"+e.idSuffix)[0],"string"==typeof t&&(t=t.evalJSON()),t.result){if(i.oldUri)for(var a=domain.wizard.bundleList.getItems(),o=0;o<a.length;o++){var s=a[o];s.getId()==i.oldId&&(s.setValue(t.fileName),s.setLabel(t.fileName)),domain.wizard.bundles[o]==i.oldUri&&(domain.wizard.bundles[o]=t.fileName)}else{var d=new dynamicList.ListItem({label:t.fileName,value:t.fileName,respondOnItemEvents:!1});d.processTemplate=function(e){return e.select("p.one > a")[0].update(this._value),e.select("p.two > a")[0].update(domain.getMessage("DOMAIN_WIZARD_CHANGE_DATASOURCE")),e.select("p.two > a")[1].update(domain.getMessage("DOMAIN_WIZARD_REMOVE_DATASOURCE")),e},domain.wizard.bundleList.addItems([d]),domain.wizard.bundles.push(d.getValue())}domain.wizard.bundleList.refresh(),ValidationModule.hideError($("bundleError").select("div > p")[0]),dialogs.systemConfirm.show(domain.getMessage("CSLD_BUNDLE_IS_SET"))}else{var n=t.message?t.message:domain.getMessage("bundleUploadError");ValidationModule.showError($("bundleError").select("div > p")[0],n)}}function a(){o?(i.bundleUri=s,domain.wizard._sendInfo("addBundleFromRepo",i,t)):domain.wizard._fileUpload(e.filePath,i,t)}var o=e.filePath.hasAttribute(layoutModule.DISABLED_ATTR_NAME),s=o?e.selectedURI:e.filePath.getValue(),d=domain.wizard.getFileName(s),n=domain.wizard.isCorrectBundle(d);if(n){var r=o?e.fromRepoRadio:e.filePath;return ValidationModule.showError(r,n),!1}for(var l=!1,u=0;u<domain.wizard.bundles.length;u++)if(existBundle=domain.wizard.getFileName(domain.wizard.bundles[u]),existBundle==d){l=!0;break}if(l){var r=o?e.fromRepoRadio:e.filePath;return ValidationModule.showError(r,""),setTimeout(function(){domain.confirmDialog.show("resourceExistsConfirmMessage",function(){domain.wizard.selectBundleDialog.hide(),a()},function(){pageDimmer.show()},null,domain.confirmDialog.MODE_OK_CANCEL)},300),!1}return a(),!0},_sendInfo:function(e,i,t){var a={flowId:"createSLDatasourceFlow",flowExecutionKey:domain.wizard.flowExecutionKey,eventId:e};domain.sendAjaxRequest(a,i,t)},_fileUpload:function(e,i,t){i._eventId="upload",i._flowExecutionKey=domain.wizard.flowExecutionKey,fileSender.upload(e,"createSLDatasourceFlow",i,t)}},"undefined"==typeof require&&document.observe("dom:loaded",domain.wizard.initialize.bind(domain.wizard));