var adhocReentrance={TEMPLATE_ID:"selectFields",TREE_TEMPLATE_DOM_ID:"list_responsive_collapsible_type_sets",OK_PATTERN:"#selectFieldsOk",CANCEL_PATTERN:"#selectFieldsCancel",ajaxBuffer:"ajaxbuffer",callbackCalled:!1,initialize:function(){this._dialog=$(this.TEMPLATE_ID),this.actionHash={"#selectFieldsOk":function(){dc_fields.fillForm(),adhocReentrance.callbackCalled=!0;var e=function(e){adhocDesigner.generalDesignerCallback(),adhocDesigner.filtersController.setFilters(e)};designerBase.sendRequest("co_setAdhocFields",["selectedModel="+encodeText($("selectedModel").value)],e,{bPost:!0}),this.close()},"#selectFieldsCancel":function(){this.close()}},this.getAction=function(e){for(var t in this.actionHash)if(e.match(t))return this.actionHash[t];return doNothing},this._dialog.observe("click",function(e){var t=e.element(),d=matchAny(t,[this.OK_PATTERN,this.CANCEL_PATTERN],!0);d&&this.getAction(d).bind(this)(e),e.stop()}.bindAsEventListener(this))},launchDialog:function(){designerBase.sendRequest("co_loadSchemaPos",[],adhocReentrance.init,{target:adhocReentrance.ajaxBuffer,bpost:!0,mode:AjaxRequester.prototype.EVAL_JSON})},init:function(e){e=e[0],dc_fields.mode=dc_fields.RE_ENTRANCE_MODE,dc_fields.TREE_TEMPLATE_DOM_ID=adhocReentrance.TREE_TEMPLATE_DOM_ID,dc_fields.NODE_CLASS=adhocReentrance.ReentranceNode,domain.setMessage("disabledFolderTooltip",disabledFolderTooltip),dc_fields.disableNodesInAdhocReEntrance=function(){adhocReentrance.disableNode(dynamicTree.trees[dc_fields.DESTINATION_FIELDS_DOM_ID].rootNode,e.disabledNodes)},dc_fields.updateReEntrantControls=function(e){var t=$$(adhocReentrance.OK_PATTERN);t.size()&&"undefined"!=typeof e.destTreeHasVisibleNodes&&domain.enableButton(t[0],e.destTreeHasVisibleNodes)},delete domain._bodyClickEventHandlers,dc_fields.init(),dialogs.popup.show($("selectFields")),designerBase.updateMainOverlay("hidden")},disableNode:function(e,t){var d=$H(t).keys().detect(function(t){return e.param.id==t});d&&e.disable(t[d]),e.childs.each(function(e){adhocReentrance.disableNode(e,t)});for(var n=e.parent;n&&n!=dynamicTree.trees[e.getTreeId()].rootNode;){var i=n.childs.findAll(function(e){return e.disabled});n.childs.length>0&&n.childs.length==i.length&&n.disable(disabledFolderTooltip),n=n.parent}},close:function(){dialogs.popup.hide($("selectFields")),adhocReentrance.callbackCalled||adhocDesigner.generalDesignerCallback(),adhocReentrance.callbackCalled=!1}};adhocReentrance.ReentranceNode=function(e){domain.ItemNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType"),Leaf:new dynamicTree.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_sets:sets"},adhocReentrance.ReentranceNode.prototype=deepClone(domain.ItemNode.prototype);