define(["require","adhoc/designer"],function(e){var t=e("adhoc/designer");return t.ajaxActionPrefix={table:"co",crosstab:"cr",olap_crosstab:"cr",chart:"ch",ichart:"ich",olap_ichart:"ich"},t.getControllerPrefix=function(){return t.ajaxActionPrefix[localContext.getMode()]},t.loadState=function(){designerBase.sendRequest(t.getControllerPrefix()+"_loadState",[],function(e){localContext.setMode(e.viewType),adhocControls.initialize(e),t.render(e),t.filtersController.setFilters(e,{reset:!0})})},t.updateTrees=function(){isDesignView&&designerBase.sendRequest(t.getControllerPrefix()+"_updateAvailableTree",[],function(){t.dimensionsTree.showTree(t._AVAILABLE_TREE_DEPTH),t.measuresTree.showTree(t._AVAILABLE_TREE_DEPTH)})},t.undo=function(){localContext.state.modeOnUndo&&!localContext.state.modeOnUndo.blank()&&localContext.state.modeOnUndo!=localContext.getMode()?(localContext.hide&&localContext.hide(),t.switchMode(localContext.state.modeOnUndo,"undo")):designerBase.sendRequest("co_undo",[],t.undoAndRedoCallback)},t.undoAll=function(){localContext.state.undoModeNames.length>0&&localContext.state.undoModeNames[0]!==localContext.getMode()?(localContext.hide&&localContext.hide(),t.switchMode(localContext.state.undoModeNames[0],"undoAll")):designerBase.sendRequest("co_undoAll",[],t.undoAndRedoCallback)},t.redo=function(){localContext.state.modeOnRedo&&!localContext.state.modeOnRedo.blank()&&localContext.state.modeOnRedo!=localContext.getMode()?(localContext.hide&&localContext.hide(),t.switchMode(localContext.state.modeOnRedo,"redo")):designerBase.sendRequest("co_redo",[],t.undoAndRedoCallback)},t.switchMode=function(e,o){var n=["_mode="+e];o&&n.push("undoOrRedo="+o);var a=function(e){var n=e.viewType;o&&t.selectDisplayModeTab(n),t.initComponents(n),t.undoAndRedoCallback(e)};localContext.cleanupOnSwitch&&localContext.cleanupOnSwitch(),designerBase.sendRequest(t.getControllerPrefix()+"_switchMode",n,a)},t.selectDisplayModeTab=function(e){jQuery("#displayMode > li").each(function(){jQuery(this).attr("id").startsWith(e)?jQuery(this).addClass("selected"):jQuery(this).removeClass("selected")})},t.updateReportTitle=function(e){e=e.replace(/<\/?[^>]+(>|$)/g,"");var o=t.getControllerPrefix();e.blank()?designerBase.sendRequest(o+"_setTitle",["l=_null"]):designerBase.sendRequest(o+"_setTitle",["l="+encodeText(e)])},t.toggleTitleBar=function(){designerBase.sendRequest(t.getControllerPrefix()+"_toggleTitleBar",[])},t.setShowDisplayManager=function(e){var t=function(){};designerBase.sendRequest("co_toggleDisplayManager",new Array("name=showDisplayManager","value="+e),t,null)},t.toggleAdhocDataSetSize=function(e){var o=!1,n="datasize="+e;if(e.startsWith("full")&&1!=localContext.state.isShowingFullData?o=!0:e.startsWith("sample")&&1!=localContext.state.isShowingSampleData?o=!0:e.startsWith("nodata")&&1!=localContext.state.isShowingNoData&&(o=!0),o){var a=function(e){t.render(e),this.checkMaxRowsLimit()}.bind(t);designerBase.sendRequest("co_toggleAdhocDataSetSize",[n],a)}},t.tryToKeepServerAlive=function(){var e=function(e){localContext.standardOpCallback(e)};designerBase.sendRequest("co_tryToKeepServerAlive",[],e,null)},t.setProperty=function(e,t,o){designerBase.sendRequest("co_setProperty",["name="+e,"value="+t],o)},t.changeFieldAttributeOrMeasure=function(e,t){designerBase.sendRequest("co_changeFieldAttributeOrMeasure",["name="+encodeText(e),"type="+t])},t.setFilter=function(e){designerBase.sendRequest("co_setFilter",["testFilter="+e])},t.setSorting=function(e,o){localContext.state.sortFields=e;var n=Object.toJSON(e),a=function(e){t.render(e),o()};designerBase.sendRequest("ta_resort",["so="+n],a)},t.pivot=function(){localContext.pivot?localContext.pivot():designerBase.sendRequest(t.getControllerPrefix()+"_pivot",[])},t.undoAndRedoCallback=function(e){t.updateTrees(),t.render(e),t.filtersController.setFilters(e,{reset:!0})},t});