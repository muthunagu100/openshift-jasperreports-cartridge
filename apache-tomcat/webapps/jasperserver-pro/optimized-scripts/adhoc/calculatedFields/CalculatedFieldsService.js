define(["require","common/util/classUtil","jquery","common/config/requestSettings","components.dialogs","jrs.configs","report.execution.count"],function(e){var t=e("common/util/classUtil"),n=e("jquery"),s=e("common/config/requestSettings"),i=e("components.dialogs"),r=e("jrs.configs"),a=e("report.execution.count"),o=t.extend({constructor:function(e){this.clientKey=e.clientKey},createRestUrl:function(e){return"rest_v2/metadata/_temp/"+this.clientKey+e},_request:function(e,t,r){t="undefined"==typeof t?!0:t,r=r||o.defaultCallbacks;var a=n.ajax(_.defaults(e,s)).done(r.done||o.defaultCallbacks.done).fail(r.fail||o.defaultCallbacks.fail).always(r.always||o.defaultCallbacks.always);return t&&setTimeout(function(){"pending"===a.state()&&i.popup.show(n("#loading")[0],!1)},o.SLOW_REQUEST_TIMEOUT),a},fetchFieldsList:function(){return this._request({url:this.createRestUrl("/fields"),type:"GET",dataType:"json"})},fetchFunctionsList:function(){return this._request({url:this.createRestUrl("/functions"),type:"GET",dataType:"json"})},validate:function(e){return this._request({url:this.createRestUrl("/action/validate"),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},get:function(e){return this._request({url:this.createRestUrl("/fields/"+e),type:"GET",dataType:"json"})},add:function(e){return this._request({url:this.createRestUrl("/fields"),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},update:function(e,t){return this._request({url:this.createRestUrl("/fields/"+t),type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},remove:function(e){return this._request({url:this.createRestUrl("/fields/"+e),type:"DELETE",contentType:"application/json"})}});return o.defaultCallbacks={done:function(){r.isFreeOrLimitedEdition&&a.check()},fail:function(e,t,n){if(401==e.status||e.getResponseHeader("LoginRequested"))document.location=r.urlContext;else if(e.getResponseHeader("adhocException"))i.errorPopup.show(e.getResponseHeader("adhocException"));else if(500==e.status||e.getResponseHeader("JasperServerError")&&!e.getResponseHeader("SuppressError")){var s=JSON.parse(e.responseText),a="<p>"+n+"</p><p>"+s.message+"</p><p>"+s.parameters[0]+"</p>";i.errorPopup.show(a)}},always:function(){i.popup.hide(n("#loading")[0])}},o.SLOW_REQUEST_TIMEOUT=2e3,window.CalculatedFieldsService=o,o});