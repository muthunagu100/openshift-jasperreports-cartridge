define(["require","common/util/classUtil","underscore","jquery","json3","components.dialogs","jrs.configs","report.execution.count"],function(e){var t={table:"adhoc/table.html",crosstab:"adhoc/crosstab.html",olap_crosstab:"adhoc/crosstab.html",ichart:"adhoc/intelligentChart.html",olap_ichart:"adhoc/intelligentChart.html"},i=e("common/util/classUtil"),r=e("underscore"),n=e("jquery"),l=e("json3"),s=e("components.dialogs"),a=e("jrs.configs"),o=e("report.execution.count"),c=i.extend({constructor:function(e){this.clientKey=e.clientKey,this.mode=e.mode},createUrl:function(e,i){return(i||t[this.mode()])+"?action="+e},_request:function(e,t,i){t="undefined"==typeof t?!0:t,i=i||c.defaultCallbacks;var r=n.ajax(e).done(i.done||c.defaultCallbacks.done).fail(i.fail||c.defaultCallbacks.fail).always(i.always||c.defaultCallbacks.always);return t&&setTimeout(function(){"pending"===r.state()&&s.popup.show(n("#loading")[0],!1,{focus:!1})},c.SLOW_REQUEST_TIMEOUT),r},get:function(){return this._request({url:this.createUrl("generateFilterPanel"),data:{clientKey:this.clientKey}})},add:function(e){return this._request({url:this.createUrl("addAdhocFilter"),type:"POST",data:{addAdhocFilterFields:e,clientKey:this.clientKey}})},addOlapFilter:function(e,i){return this._request({url:this.createUrl("addOLAPFilter",t.olap_crosstab),type:"POST",data:{dim:e,child:i,clientKey:this.clientKey}})},addSlice:function(e,i,n){return this._request({url:this.createUrl("addQuickSliceFilter",t.crosstab),type:"POST",data:{axis:e,includeOrExclude:i,pathList:l.stringify(r.map(n,function(e){return encodeURIComponent(e)})),clientKey:this.clientKey}})},update:function(e,t){return this._request({url:this.createUrl("editAdhocFilter"),type:"POST",data:{filterId:e,editAdhocFilter:l.stringify(t),clientKey:this.clientKey}})},remove:function(e){return this._request({url:this.createUrl("deleteAdhocFilter"),type:"POST",data:{filterId:e,clientKey:this.clientKey}})},removeAll:function(){return this._request({url:this.createUrl("deleteAllAdhocFilters"),type:"POST",data:{clientKey:this.clientKey}})},reorder:function(e,t){return this._request({url:this.createUrl("reorderFilters"),type:"POST",data:{oldIndex:e,newIndex:t,clientKey:this.clientKey}})},toggleVisibility:function(e){return this._request({url:this.createUrl("toggleFilterPodState"),type:"POST",data:{filterId:e,clientKey:this.clientKey}})},minimizeAll:function(){return this._request({url:this.createUrl("minimizeAllAdhocFilterPods"),type:"POST",data:{clientKey:this.clientKey}})},maximizeAll:function(){return this._request({url:this.createUrl("maximizeAllAdhocFilterPods"),type:"POST",data:{clientKey:this.clientKey}})},fetchValues:function(e,t,i){return this._request({url:this.createUrl("getFieldValues"),data:r.extend({fieldName:encodeURIComponent(e),clientKey:this.clientKey},t)},i)},applyFiltersAndExpression:function(e,t){return this._request({url:this.createUrl("applyAdhocFiltersAndExpression"),type:"POST",data:{complexFilterExpression:t,adhocFilters:l.stringify(e),clientKey:this.clientKey}})},getMaxMinValues:function(e){return this._request({url:this.createUrl("getMaxMinValues"),data:{fieldName:encodeURIComponent(e),clientKey:this.clientKey}})}});return c.defaultCallbacks={done:function(){a.isFreeOrLimitedEdition&&o.check()},fail:function(e){e.getResponseHeader("LoginRequested")?document.location=a.urlContext:e.getResponseHeader("adhocException")?s.errorPopup.show(e.getResponseHeader("adhocException")):(500==e.status||e.getResponseHeader("JasperServerError")&&!e.getResponseHeader("SuppressError"))&&s.errorPopup.show(e.responseText)},always:function(){s.popup.hide(n("#loading")[0])}},c.SLOW_REQUEST_TIMEOUT=2e3,window.FilterService=c,c});