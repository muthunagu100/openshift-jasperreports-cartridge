define(["require","adhoc/designer"],function(e){var t=e("adhoc/designer");return t.observePointerEvents=function(){document.observe(layoutModule.ELEMENT_CONTEXTMENU,t.contextMenuHandler),jQuery("#dataSizeSelector").change(function(){t.toggleAdhocDataSetSize(jQuery(this).val())}).val(),jQuery("#dataModeSelector").change(function(){var e=localContext.getMode(),o=jQuery(this).val();if(e!==o){if(!(e!==designerBase.CROSSTAB&&e!=designerBase.OLAP_CROSSTAB&&e!==designerBase.TABLE||o!==designerBase.ICHART&&o!==designerBase.OLAP_ICHART)){var n=e===designerBase.CROSSTAB||e==designerBase.OLAP_CROSSTAB?AdHocCrosstab.state:AdHocTable.state;if(!t.switchModeEventCheck(n))return t.updateModeLabelSelection(e),void dialogs.systemConfirm.show(t.getMessage("ADH_1214_ICHARTS_NO_SWITCHMODE_DELETED_SUMMARIES"),5e3)}localContext.hide&&localContext.hide(),t.switchMode(o,null)}}),Event.observe(document.body,isSupportsTouch()?"touchend":"click",function(e){var o=e.element();matchAny(o,["li.node","li.leaf","ul#"+t.MEASURES_TREE_DOM_ID,"ul#"+t.DIMENSIONS_TREE_DOM_ID],!0)||(this.unSelectAvailableTreeNodes(),isSupportsTouch()&&(localContext.clickid==o.identify()&&e.timeStamp-localContext.clicktime<700&&(e.isEmulatedRightClick=!0,document.fire(layoutModule.ELEMENT_CONTEXTMENU,{targetEvent:e,node:o})),localContext.clicktime=e.timeStamp,localContext.clickid=o.identify()));var n=matchAny(o,[this.CANVAS_PATTERN,layoutModule.MENU_LIST_PATTERN,this.COLUMN_OVERLAY_PATTERN,this.SUMMARY_OVERLAY_PATTERN,this.ROW_GROUP_OVERLAY_PATTERN,this.COLUMN_GROUP_OVERLAY_PATTERN,this.ROW_GROUP_OVERLAY_PATTERN,this.COLUMN_GROUP_OVERLAY_PATTERN,this.XTAB_MEASURE_HEADER_OVERLAY_PATTERN,this.XTAB_MEASURE_OVERLAY_PATTERN,this.XTAB_GROUP_HEADER_PATTERN,this.ROW_GROUP_MEMBER_PATTERN,this.COLUMN_GROUP_MEMBER_PATTERN,this.XTAB_GROUP_HEADER_OVERLAY_PATTERN,this.GROUP_OVERLAY_PATTERN,this.MENU_PATTERN,this.FILTER_OPERATOR_MENU_PATTERN,this.FILTER_ITEM_MENU_PATTERN,this.FILTER_GENERAL_MENU_PATTERN],!0);n||(localContext.getMode()===designerBase.CROSSTAB&&crossTabMultiSelect&&crossTabMultiSelect.deselectAllGroupMembers(),(localContext.getMode()===designerBase.TABLE||localContext.getMode()===designerBase.CROSSTAB||localContext.getMode()===designerBase.CHART)&&localContext.deselectAllSelectedOverlays()),!isRightClick(e)&&!e.isEmulatedRightClick&&!n&&actionModel.hideMenu()}.bind(t))},t.switchModeEventCheck=function(e){if(e.columnGroups&&e.columnGroups.length>0)for(var t=0;t<e.columnGroups.length;t++)if("NULL Dimension"!==e.columnGroups[t].dimensionName&&e.columnGroups[t].isShowingSummary===!1)return!1;if(e.rowGroups&&e.rowGroups.length>0)for(var t=0;t<e.rowGroups.length;t++)if("NULL Dimension"!==e.rowGroups[t].dimensionName&&e.rowGroups[t].isShowingSummary===!1)return!1;return!0},t.observeKeyEvents=function(){document.stopObserving("key:save").observe("key:save",function(e){actionModel.hideMenu(),localContext.canSaveReport()&&designerBase.handleSave(),Event.stop(e.memo.targetEvent)}.bind(this)),document.stopObserving("key:undo").observe("key:undo",function(e){actionModel.hideMenu(),localContext.state.canUndo&&!buttonManager.isDisabled($("undo"))&&this.undo(),Event.stop(e.memo.targetEvent)}.bind(this)),document.stopObserving("key:redo").observe("key:redo",function(e){actionModel.hideMenu(),localContext.state.canRedo&&!buttonManager.isDisabled($("redo"))&&this.redo(),Event.stop(e.memo.targetEvent)}.bind(this)),document.stopObserving("key:escape").observe("key:escape",function(){actionModel.hideMenu();var e=Object.values(this.dialogESCFunctions);e.each(function(e){var t=$(e);t&&dialogs.popup.hide(t)}.bind(this)),localContext.getMode()==designerBase.CHART&&localContext.currentlyDragging&&(Event.stopObserving(document.body,"mousemove"),localContext.resizeChart(),localContext.currentlyDragging=!1)}.bind(this))},t.observeCustomEvents=function(){jQuery("body").on({layout_update:function(e,t){var o=jQuery("#adhocCanvasContainer"),n=o.prev(),i=parseInt(o.css("margin-top"))||0,s=n.height()-100,a=s-i;o.css("top",a+"px"),t&&t.elem&&"filters"==t.elem.id&&localContext.getMode().indexOf("ichart")>=0&&("panel-maximize"==t.type?AIC.ui.controls.dataLevelSelector.dock():AIC.ui.controls.dataLevelSelector.undock()),localContext.getMode().indexOf("ichart")>=0&&AIC.chart&&AIC.redraw()},report_name_update:function(e,o){t.ui.header_title.html(o)}}),jQuery("body").on({"actionmodel-mouseout":function(){jQuery("#tableOptions").removeClass("over").css("z-index",9)}}),jQuery(window).resize(function(){var e=jQuery("#adhocCanvasContainer");if(e.length){var t=e.prev(),o=parseInt(e.css("margin-top"))||0,n=t.height()-100,i=n-o;e.css("top",i+"px")}})},t.observeTableContainerEvents=function(){$("mainTableContainer").observe(isSupportsTouch()?"touchstart":"mousedown",function(e){localContext.mouseDownHandler(e)}),$("mainTableContainer").observe(isSupportsTouch()?"touchend":"mouseup",function(e){localContext.mouseUpHandler(e),t.adhocTitleEdit.call(this,e)}.bind(this)),$("mainTableContainer").observe("mouseover",function(e){localContext.mouseOverHandler(e)}),$("mainTableContainer").observe("mouseout",function(e){localContext.mouseOutHandler(e)}),$("mainTableContainer").observe("click",function(e){localContext.mouseClickHandler(e)}),Event.observe($("mainTableContainer"),isSupportsTouch()?"touchmove":"scroll",function(){localContext.getMode()===designerBase.TABLE&&localContext.tableScrolled(),actionModel.hideMenu()})},t.observeTreeEvents=function(e,o){e.observe("leaf:dblclick",function(t){if(this.isCrosstabMode){var o=localContext.getMode()==designerBase.ICHART||localContext.getMode()==designerBase.OLAP_ICHART?AdhocIntelligentChart:AdHocCrosstab;"dimension"==e.dragClasses?o.canAddLevelAsRowGroup()?o.appendDimensionToRowAxisWithLevel():o.canAddLevelAsColumnGroup()&&o.appendDimensionToColumnAxisWithLevel():o.canAddLevelAsColumnGroup()?o.appendMeasureToColumn():o.canAddLevelAsRowGroup()&&o.appendMeasureToRow()}else{var n=t.memo.targetEvent;this.addFieldToCanvas(n)}}.bind(this)),e.observe("leaf:selected",function(e){var t=e.memo.node,n=e.memo.targetEvent;o._deselectAllNodes(),this.selectFromAvailableFields(n,t)}.bind(this)),e.observe("node:selected",function(e){var t=e.memo.node,n=e.memo.targetEvent;o._deselectAllNodes(),this.selectFromAvailableFields(n,t)}.bind(this)),e.observe("leaf:unselected",function(e){var t=e.memo.node;this.isCrosstabMode&&this.removeSelectedObject(t),this.selectFromAvailableFields(e.memo.targetEvent,t)}.bind(this)),e.observe("node:unselected",function(e){var t=e.memo.node;this.isCrosstabMode&&this.removeSelectedObject(t),this.selectFromAvailableFields(e.memo.targetEvent,t)}.bind(this)),e.observe("items:unselected",function(){designerBase.unSelectAll()}.bind(this)),e.observe("node:dblclick",function(e){this._availableTreeLastOpened=e.memo.node.param.uri,new JSCookie(this._cookieName,this._availableTreeLastOpened,this._cookieTime)}.bind(this)),e.observe("node:click",function(e){this._availableTreeLastOpened=e.memo.node.param.uri,new JSCookie(this._cookieName,this._availableTreeLastOpened,this._cookieTime)}.bind(this)),e.observe("tree:loaded",function(){e.openAndSelectNode(this._availableTreeLastOpened,function(){this.updateAllFieldLabels()}.bind(this))}.bind(this)),e.observe("node:mouseup",function(e){localContext.treeMenuHandler(e)}),e.observe("leaf:mouseup",function(e){localContext.treeMenuHandler(e)}),e.observe("key:contextMenu",function(e){var o=e.memo.node,n=getBoxOffsets(o,!0);t.showDynamicMenu(e,designerBase.FIELD_MENU_LEVEL,{menuLeft:n[0]+100,menuTop:n[1]+20}),Event.stop(e)})},t.observeDisplayManagerEvents=function(){var e=jQuery("#"+t.DISPLAY_MANAGER_ID);e.unbind("lm:addItem"),e.unbind("lm:addItems"),e.unbind("lm:removeItem"),e.unbind("lm:moveItem"),e.unbind("lm:measureReorder"),e.unbind("lm:switchItem"),e.unbind("lm:contextMenu"),e.bind("lm:addItem",function(e,t){t=_.extend({index:-1,levelIndex:-1},t),localContext.lmHandlersMap[t.axis].addItem(t.dimensionId,t.index,t.level,t.levelIndex,t.isMeasure,t.uri,t.hierarchyName)}),e.bind("lm:removeItem",function(e,t){localContext.lmHandlersMap[t.axis].removeItem(t.item,t.index)}),e.bind("lm:addItems",function(e,t){localContext.lmHandlersMap.addItems(t.levels,t.index,t.axis)}),e.bind("lm:moveItem",function(e,t){localContext.lmHandlersMap[t.axis].moveItem(t.item,t.from,t.to)}),e.bind("lm:switchItem",function(e,t){localContext.lmHandlersMap[t.axis].switchItem(t.item,t.from,t.to)}),e.bind("lm:measureReorder",function(e,t){localContext.lmHandlersMap.measureReorder(t.measure,t.to)}),e.bind("lm:contextMenu",function(e,t){localContext.lmHandlersMap[t.extra.axis].contextMenu(e,t)})},t.observeCrossDocumentMessages=function(){window.addEventListener?(removeEventListener("message",t.crossDocumentListener),addEventListener("message",t.crossDocumentListener,!1)):(detachEvent("onmessage",t.crossDocumentListener),attachEvent("onmessage",t.crossDocumentListener))},t.observeCloseDesignerEvent=function(){jQuery("#closeDesigenr").on("mouseup",t.handleCancel)},window.addEventListener&&window.addEventListener("orientationchange",function(){t.hideOnePanel()}),t});