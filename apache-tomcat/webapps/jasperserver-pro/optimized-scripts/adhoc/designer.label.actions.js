define(["require","adhoc/designer"],function(e){var t=e("adhoc/designer");return t.editDataHeader=function(e,n){var l=null,i=null,a=null,o=null,d=null,r=null,u=null,s=$("editLabel"),c=100,p=function(){t.initPreventBrowserSelection($("designer"))};if(this.initEnableBrowserSelection($("designer")),"title"===n)t.prevTitle=jQuery("#titleCaption").html(),editor=new InPlaceEditor(e),editor.oldTitle=editor.value.strip(),editor.makeEditable({onMouseup:t.returnToNormalReportTitle,onTab:t.returnToNormalReportTitle,onEnter:t.returnToNormalReportTitle,onEsc:t.returnToNormalReportTitle}),jQuery("#mainTableContainer").scrollLeft(0);else if(s){if(d=s.down("button#cancelEditBtn"),o=s.down("button#editLabelBtn"),"legend"===n){var b=designerBase.getSelectedObject();b&&(r=b.index,l=b.userName,i=s.down("input#editLabelInput"),i&&(i.value=l.strip(),a=function(){u=i.value,u=u.replace(/<\/?[^>]+(>|$)|["]/g,""),localContext.updateLegendLabel(u,r)}))}else if("column"===n){var g=t.getSelectedColumnOrGroup();g&&(l=getInnerText(g.header),c=$(g.header).getWidth(),r=g.index,i=s.down("input#editLabelInput"),i&&(i.value=l.strip(),a=function(){u=i.value,u=u.replace(/<\/?[^>]+(>|$)|["]/g,""),localContext.updateColumnHeaderRequest(u,r,c)}))}else if("tableGroup"===n){var v=t.getSelectedColumnOrGroup();if(v){var f=v.index;l=v.label,i=s.down("input#editLabelInput"),i&&(i.value=l.strip(),a=function(){u=i.value,u=u.replace(/<\/?[^>]+(>|$)|["]/g,""),localContext.updateGroupLabel(u,f)})}}if(i){$(d).observe("click",function(e){$(o).stopObserving("click"),p(),dialogs.popup.hide(s),Event.stop(e)}),$(o).observe("click",function(e){a(),p(),$(o).stopObserving("click"),dialogs.popup.hide(s),Event.stop(e)}),$(i).observe("key:enter",function(e){a(),p(),$(o).stopObserving("click"),$(i).stopObserving("key:enter"),dialogs.popup.hide(s),Event.stop(e)}),$(i).observe("keypress",function(e){e=e?e:window.event,"legend"===n&&(62==e.keyCode||60==e.keyCode||38==e.keyCode||61==e.keyCode||62==e.charCode||60==e.charCode||38==e.charCode||61==e.charCode)&&Event.stop(e)}),dialogs.popup.show(s);var m=500,C=function(){i.focus(),i.select()};isIE8()?setTimeout(C,m):C()}}},t.addColumnLabel=function(){if(1==selObjects.length){var e=designerBase.getSelectedObject(),n=e.header;n.hasClassName("deletedHeader")&&t.editDataHeader(n,"column")}},t.deleteColumnLabel=function(){if(1==selObjects.length){var e=designerBase.getSelectedObject(),t=e.header;t.hasClassName("deletedHeader")||(t.addClassName("deletedHeader"),t.innerHTML=t.readAttribute("data-fieldName")),localContext.removeColumnHeaderRequest()}},t.selectAndEditLabel=function(e){var n=null,l=$("legendOverlay_"+e);l&&(n={id:l.identify(),legendName:l.readAttribute("data-legendName"),index:l.readAttribute("data-index"),defaultName:l.readAttribute("data-defaultName"),userName:l.readAttribute("data-userName")},designerBase.unSelectAll(),localContext.deselectAllSelectedOverlays(),designerBase.addToSelected(n),buttonManager.select(l),t.editLegendLabel())},t.editLegendLabel=function(){if(1==selObjects.length){var e=designerBase.getSelectedObject(),n=$(e.id);n&&t.editDataHeader(n,"legend")}},t.editColumnLabel=function(){if(1==selObjects.length){var e=designerBase.getSelectedObject(),n=e.header;t.editDataHeader(n,"column")}},t.adhocTitleEdit=function(e){var t=e.element();!isNotNullORUndefined(editor)&&matchMeOrUp(t,"#titleCaption")&&(this.editDataHeader($("titleCaption"),"title"),Event.stop(e))},t.returnToNormalReportTitle=function(e){if(editor)if(e=e?e:window.event,e.keyCode==Event.KEY_ESC)editor.revertEdit(),editor=null,t.initPreventBrowserSelection($("designer"));else{editor.makeNonEditable(!0);var n=editor.elem.innerHTML;editor.oldTitle!=n?(t.updateReportTitle(n),t.initPreventBrowserSelection($("designer"))):"table"==localContext.getMode()&&jQuery("#titleCaption").html(t.prevTitle),editor=null}},t.addGroupLabel=function(){localContext.editGroupLabel()},t.deleteGroupLabel=function(){localContext.removeGroupLabel()},t.editGroupLabel=function(){localContext.editGroupLabel()},t});