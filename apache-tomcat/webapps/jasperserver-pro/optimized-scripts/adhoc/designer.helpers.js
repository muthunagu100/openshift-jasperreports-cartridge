define(["require","adhoc/designer"],function(e){var t=e("adhoc/designer");return t.setDragStartState=function(e,n,i,a){var r=[Event.pointerX(a),Event.pointerY(a)],s=i.element,o=i.element=new Element("LI").update(s.innerHTML);o.classNames().set(s.classNames()),o.writeAttribute("fieldname",t.getFieldName()),o.setStyle({"z-index":s.getStyle("z-index")}),o.hide(),s.parentNode.appendChild(o),Element.clonePosition(o,s),Position.absolutize(o),s.remove(),dynamicTree.Tree.prototype.setDragStartState.apply(e,Array.prototype.slice.call(arguments,1)),i.draw(r),o.show()},t.deSelectAllPressedNavMuttons=function(){var e=$$("UL#navigationOptions li");e&&e.each(function(e){buttonManager.out($(e),function(e){return $(e).down(layoutModule.LIST_ITEM_WRAP_PATTERN)})})},t.hideAllDialogsAndMenus=function(){actionModel.hideMenu();var e=Object.values(this.dialogESCFunctions);e.each(function(e){var t=$(e);t&&dialogs.popup.hide(t)}.bind(this))},t.initPreventBrowserSelection=function(e){disableSelectionWithoutCursorStyle($(e))},t.initEnableBrowserSelection=function(e){enableSelection($(e))},t.isNoDataToDisplay=function(){return localContext.getMode()===designerBase.TABLE?jQuery("#nothingToDisplay").is(":visible"):void 0},t.checkMaxRowsLimit=function(){if(localContext.state.hitMaxRows&&!this.isNoDataToDisplay()){var e=rowLimitMessage.replace("{0}",localContext.state.maxDataRowsCount);dialogs.systemConfirm.show(e,5e3)}},t.isOnlyFieldsSelected=function(){var e=function(e){return e.hasChilds()};return null==this.getSelectedTreeNodes().detect(e)},t.showButtonMenuMouseOut=function(e){actionModel.hideMenu(),Event.stopObserving($(e),"mouseleave",t.showButtonMenuMouseOut)},t.isSelectedFieldCustom=function(){if(1==selObjects.length){var e=designerBase.getSelectedObject();if(e.model)return e.model.isCustomField;var n=t.findFieldByName(t.getNameForSelected(e));return n&&n.isCustomField}},t.isSelectFieldsAllowed=function(){return isDomainType},t.isDeleteAllowed=function(){if(1!=selObjects.length)return!1;var e=designerBase.getSelectedObject()?designerBase.getSelectedObject().param.id:null,n=t.findFieldByName(e);return null!=n&&n.isCustomField&&!n.isUsed&&!t.isInUse(e)},t.isUsedInRowsOrColumns=function(e){return _.find(localContext.state.fieldsInUse,function(t){return t===e})},t.canMoveToDimensions=function(){var e=selObjects.find(function(e){var n=t.findFieldByName(t.getNameForSelected(e));return n&&n.isCustomField&&n.aggregateField}),n=selObjects.find(function(e){return e.param.id===designerBase.SPACER_NAME||!e.param.extra.isMeasure||t.isUsedInRowsOrColumns(e.param.extra.id)});return!n&&!e},t.canMoveToMeasures=function(){var e=selObjects.find(function(e){return e.param.id===designerBase.SPACER_NAME||e.param.extra.isMeasure||t.isUsedInRowsOrColumns(e.param.extra.id)});return!e},t.getMessage=function(e,n){var i=t.messages[e];return i?new Template(i).evaluate(n?n:{}):""},t.registerTemplate=function(e,t){if(!e||!t)throw"Some of required params to register template are missing";return e[t]||(e[t]=_.template(jQuery("#"+t).html(),null,{evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,escape:/\{\{-([\s\S]+?)\}\}/g})),e[t]},t.createTemplate=function(e){if(!e)throw"Some of required params to register template are missing";var t=_.templateSettings;_.templateSettings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,escape:/\{\{-([\s\S]+?)\}\}/g};var n=_.template(jQuery("#"+e).html());return _.templateSettings=t,n},t.updateTrees=function(){isDesignView&&designerBase.sendRequest("co_updateAvailableTree",[],function(){t.dimensionsTree.showTree(t._AVAILABLE_TREE_DEPTH),t.measuresTree.showTree(t._AVAILABLE_TREE_DEPTH)})},t.hideOnePanel=function(){if(0===window.orientation){var e,t=document.getElementById("filters"),n=document.getElementById("fields"),i=jQuery("#filter-container").find("div.panel.pane.filter").filter(":visible").length,a=t.className.indexOf("minimized")>=0;a||(e=i?n:t,layoutModule.minimize(e))}},t.defaultFieldJSONBuilder=function(e){return{dimensionId:e.param.extra.dimensionId,name:e.param.extra.id}},t.getListOfSelectedFields=function(e){var n=t.getSelectedTreeNodes();if(this.isOlapMode())return e=Object.isFunction(e)?e:t.defaultFieldJSONBuilder,n.collect(function(t){if(t.isParent()){var n=t.childs.detect(function(e){return localContext.canAddFilter(e)});return n.collect(e)}return localContext.canAddFilter(t)?e(t):null}).compact().flatten();for(var i=[],a=0;a<n.length;a++){var r=n[a];if(r.isParent()){for(var s=r.childs,o=0;o<s.length;o++){var l=s[o].param.id;localContext.canAddFilter(s[o])&&i.push(l)}if(0===i.length)continue}else{if(!localContext.canAddFilter(r))continue;i.push(r.param.id)}}return _.map(i,function(e){return{name:e}})},t.generateAvailableSummaryCalculationsMenu=function(e,t,n){var i=_.chain(localContext.state.fieldAvailableSummaries[e]).filter(function(e){return"None"!==e}).sortBy().value();i.unshift("None"),t.children=_.map(i,function(e){return actionModel.createMenuElement("optionAction",_.extend({text:e,actionArgs:[e],isSelectedTestArgs:[e]},n))})},t});