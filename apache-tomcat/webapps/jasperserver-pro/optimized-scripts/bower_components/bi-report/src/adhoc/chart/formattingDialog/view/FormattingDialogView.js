define(["require","underscore","jquery","backbone","bundle!adhoc_messages","adhoc/chart/formattingDialog/model/FormattingDialogModel","text!adhoc/chart/formattingDialog/template/FormattingDialogTemplate.htm","text!adhoc/chart/formattingDialog/template/AxisSectionTemplate.htm","text!adhoc/chart/formattingDialog/template/LabelsSectionTemplate.htm","text!adhoc/chart/formattingDialog/template/DataSectionTemplate.htm"],function(e){var t=e("underscore"),i=e("jquery"),a=e("backbone"),l=e("bundle!adhoc_messages"),s=(e("adhoc/chart/formattingDialog/model/FormattingDialogModel"),e("text!adhoc/chart/formattingDialog/template/FormattingDialogTemplate.htm")),d=e("text!adhoc/chart/formattingDialog/template/AxisSectionTemplate.htm"),o=e("text!adhoc/chart/formattingDialog/template/LabelsSectionTemplate.htm"),n=e("text!adhoc/chart/formattingDialog/template/DataSectionTemplate.htm");return a.View.extend({template:t.template(s),el:"#chartFormatDialog",initialize:function(){this.render(),this.model.on("change",this._renderFields,this)},events:{"click .applyButton":"_apply","click .okButton":"_ok","click .cancelButton":"_cancel","click ul.tabSet .tab":"_switchTab","change select#legend":"_disableLegendBorderControl","change input#showSingleMeasuresLabels":"_disableMeasureNamesControl"},render:function(){return this.$el.empty(),this.$el.html(this.template({i18n:l})),this.$el.find("#axisSection").html(t.template(d)({i18n:l})),this.$el.find("#labelsSection").html(t.template(o)({i18n:l})),this.$el.find("#dataSection").html(t.template(n)({i18n:l})),this._renderFields(),this},_renderFields:function(){this.inputFields={},t.each(this.model.attributes,function(e,t){var i=this.$el.find("#"+t);"checkbox"==i.attr("type")?(this.inputFields[t]=i.prop("checked",e),"showMeasureOnValueAxis"===t&&(this.model.get("showSingleMeasuresLabels")?this.inputFields[t].prop("disabled",!1).parent().removeClass("disabled"):this.inputFields[t].prop("disabled",!0).parent().addClass("disabled"))):this.inputFields[t]=i.val(e)},this)},_updateModel:function(){var e=this._extractData();return this.model.set(e,{validate:!0}),this.$el.find(".error").removeClass("error"),this.model.isValid()?!0:(t.each(this.model.validationError,function(e,t){this.$el.find("#"+t).val(this.model.get(t))},this),this._updateModel())},_apply:function(){this._updateModel(),this.model.applyModel()},_ok:function(){this._updateModel(),this.model.applyModel(),this._switchToFirstTab(),dialogs.popup.hide(this.el)},_cancel:function(){this.model.set(this.model._savedAttributes,{silent:!0}),this._renderFields(),this._switchToFirstTab(),dialogs.popup.hide(this.el)},_switchTab:function(e){if(this._updateModel()){var t=this.$el.find("ul.tabSet li.tab");t.removeClass("selected");var i=this.$el.find(e.currentTarget);i.addClass("selected"),i.children("a").removeClass("over");var a=i.attr("id"),l=a.substring(0,a.indexOf("Tab"));this.$el.find("div.body.section.noTitle").addClass("hidden"),this.$el.find("#"+l+"Section").removeClass("hidden")}},_switchToFirstTab:function(){var e=this.$el.find("ul.tabSet li.tab");e.removeClass("selected");var t=this.$el.find("ul.tabSet li.tab.first");t.addClass("selected");var i=t.attr("id"),a=i.substring(0,i.indexOf("Tab"));this.$el.find("div.body.section.noTitle").addClass("hidden"),this.$el.find("#"+a+"Section").removeClass("hidden")},_extractData:function(){var e={};return t.each(this.model.attributes,function(t,i){var a=this.inputFields[i];a.length&&(e[i]="checkbox"==a.attr("type")?a.prop("checked"):a.val())},this),e},_disableMeasureNamesControl:function(e){var t=this.$el.find("input#showMeasureOnValueAxis");i(e.currentTarget).is(":checked")?t.prop("checked",this._tmpPreviousStateShowMeasureOnValueAxis).prop("disabled",!1).parent().removeClass("disabled"):(this._tmpPreviousStateShowMeasureOnValueAxis=t.prop("checked"),t.prop("checked",!1).prop("disabled",!0).parent().addClass("disabled"))},_disableLegendBorderControl:function(e){var t=this.$el.find("input#legendBorder");"none"===i(e.currentTarget).val()?t.prop("disabled",!0).parent().addClass("disabled"):t.prop("disabled",!1).parent().removeClass("disabled")}})});