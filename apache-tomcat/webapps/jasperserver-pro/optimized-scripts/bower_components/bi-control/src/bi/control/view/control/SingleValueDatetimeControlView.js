define(["require","exports","module","jquery.timepicker.addon","../BaseInputControlView","jquery","underscore","logger","text!../../template/singleValueDatetimeTemplate.htm","text!../../template/calendarIconSpanTemplate.htm","settings!dateTimeSettings","common/util/parse/date"],function(e,t,a){function i(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}e("jquery.timepicker.addon");var n=e("../BaseInputControlView"),o=e("jquery"),r=e("underscore"),s=(e("logger").register(a),e("text!../../template/singleValueDatetimeTemplate.htm")),l=e("text!../../template/calendarIconSpanTemplate.htm"),m=e("settings!dateTimeSettings"),p=e("common/util/parse/date");return n.extend({template:s,initialize:function(){this.renderStructure(),this.renderState(),this.model.get("visible")&&(this.setupCalendar(),this.bindCustomEventListeners())},setupCalendar:function(){var e=this.$el.find("input");e.datetimepicker({showOn:"button",dateFormat:m.datepicker.timeFormat,timeFormat:m.timepicker.timeFormat,showSecond:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0,disabled:e[0].disabled,onSelect:r.bind(this.updateState,this),onChangeMonthYear:null,beforeShow:o.datepicker.movePickerRelativelyToTriggerIcon,constrainInput:!1}),e.change(r.bind(function(e){e.stopPropagation();var t=o(e.target),a=i(t.val());t.val(a),this.updateState(a)},this)),e.after("&nbsp;");var t=this.$el.find("button");t.wrap(l).empty()},updateValue:function(e){var t=p.isoTimestampToLocalizedTimestamp(e);this.$el.find("input").attr("value",t)},updateState:function(e){this.model.changeState(p.localizedTimestampToIsoTimestamp(e))},bindCustomEventListeners:function(){this.listenTo(this.model.state,"change:value",function(e,t){this.updateValue(t)},this)},remove:function(){this.$el.off("change","input").datetimepicker("destroy"),n.prototype.remove.call(this)}})});