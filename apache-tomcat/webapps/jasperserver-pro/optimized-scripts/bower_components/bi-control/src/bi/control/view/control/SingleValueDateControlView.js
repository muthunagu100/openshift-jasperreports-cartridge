define(["require","exports","module","common/jquery/extension/datepickerExt","../BaseInputControlView","jquery","underscore","logger","text!../../template/singleValueDateTemplate.htm","text!../../template/calendarIconSpanTemplate.htm","settings!dateTimeSettings","common/util/parse/date"],function(e,t,a){function n(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}e("common/jquery/extension/datepickerExt");var i=e("../BaseInputControlView"),o=e("jquery"),r=e("underscore"),s=(e("logger").register(a),e("text!../../template/singleValueDateTemplate.htm")),l=e("text!../../template/calendarIconSpanTemplate.htm"),u=e("settings!dateTimeSettings"),d=e("common/util/parse/date");return i.extend({template:s,initialize:function(){this.renderStructure(),this.renderState(),this.model.get("visible")&&(this.setupCalendar(),this.bindCustomEventListeners())},setupCalendar:function(){var e=this.$el.find("input");e.datepicker({showOn:"button",dateFormat:u.datepicker.dateFormat,changeMonth:!0,changeYear:!0,showButtonPanel:!0,disabled:e[0].disabled,onSelect:r.bind(this.updateState,this),onChangeMonthYear:null,beforeShow:o.datepicker.movePickerRelativelyToTriggerIcon,constrainInput:!1}),e.change(r.bind(function(e){e.stopPropagation();var t=o(e.target),a=n(t.val());t.val(a),this.updateState(a)},this)),e.after("&nbsp;");var t=this.$el.find("button");t.wrap(l).empty()},updateValue:function(e){var t=d.isoDateToLocalizedDate(e);this.$el.find("input").attr("value",t)},updateState:function(e){this.model.changeState(d.localizedDateToIsoDate(e))},bindCustomEventListeners:function(){this.listenTo(this.model.state,"change:value",function(e,t){this.updateValue(t)},this)},remove:function(){this.$el.off("change","input").datepicker("destroy"),i.prototype.remove.call(this)}})});