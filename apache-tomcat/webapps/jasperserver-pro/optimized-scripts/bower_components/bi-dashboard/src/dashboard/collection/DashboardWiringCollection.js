define(["require","jquery","underscore","backbone","../dashboardSettings","./autowiring/CascadeInputControlsAutowiringStrategy","./autowiring/OwnControlsAutowiringStrategy","./autowiring/RunReportAutowiringStrategy","../model/DashboardWiringModel"],function(n){var e=n("jquery"),t=n("underscore"),i=n("backbone"),r=(n("../dashboardSettings"),n("./autowiring/CascadeInputControlsAutowiringStrategy")),o=n("./autowiring/OwnControlsAutowiringStrategy"),s=n("./autowiring/RunReportAutowiringStrategy"),a=n("../model/DashboardWiringModel");return i.Collection.extend({model:a,initialize:function(){var n=this;t.bindAll(this,"register","unregister"),this.handlers={},this.on("add",function(n){n.consumers.each(t.bind(this.attachHandler,this,n))}),this.on("remove",function(n){n.consumers.set([])}),this.on("reset",function(e,i){t.each(i.previousModels,function(n){n.consumers.set([])}),this.each(function(e){e.consumers.each(t.bind(n.attachHandler,n,e))})}),this.on("add:consumers",this.attachHandler),this.on("remove:consumers",this.detachHandler),this.on("reset:consumers",function(e,i,r){t.each(r.previousModels,t.bind(n.detachHandler,n,e)),i.each(t.bind(n.attachHandler,n,e))}),this.autowiring=[],this.autowiring.push(new o),this.autowiring.push(new r),this.autowiring.push(new s)},register:function(n,i){var r=this,o=r.add(t.map(i.signals,function(e){return{name:e,producer:n.get("id")+":"+e,component:n.get("id")}}),{silent:!0,component:n,consumers:[]});for(var s in i.slots){var a=n.get("id")+":"+s;this.handlers[a]||(this.handlers[a]=new e.Deferred),this.handlers[a].resolve(i.slots[s])}this.autowiringEnabled&&t.invoke(this.autowiring,"autowire",this,n,i);for(var u=0,d=o.length;d>u;u++)(n=o[u]).trigger("add",n,this)},unregister:function(n){var e=this,i=n.get("id")+":";this.remove(this.filter(function(n){return 0===n.get("producer").indexOf(i)})),this.each(function(n){var r=n.consumers.filter(function(n){return 0===n.get("consumer").indexOf(i)});t.each(r,function(t){n.consumers.remove(t),delete e.handlers[t.get("consumer")]})}),t.invoke(this.autowiring,"unwire",n)},enableAutowiring:function(){this.autowiringEnabled=!0},disableAutowiring:function(){this.autowiringEnabled=!1},askForHandler:function(n){return this.handlers[n]||(this.handlers[n]=new e.Deferred),this.handlers[n].promise()},attachHandler:function(n,e){this.askForHandler(e.get("consumer")).done(function(e){n.listenTo(n.component,n.get("name"),e),n.value&&e(n.value,n.component)})},detachHandler:function(n,e){this.askForHandler(e.get("consumer")).done(function(e){n.stopListening(n.component,n.get("name"),e),n.value&&e(void 0,n.component)})}})});