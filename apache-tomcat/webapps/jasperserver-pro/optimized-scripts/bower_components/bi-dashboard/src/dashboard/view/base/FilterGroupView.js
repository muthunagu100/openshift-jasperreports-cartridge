define(["require","jquery","underscore","backbone","bundle!CommonBundle","dashboard/dashboardSettings","text!../../template/filterGroupButtonsTemplate.htm","domReady"],function(t){var e=t("jquery"),i=t("underscore"),s=t("backbone"),o=t("bundle!CommonBundle"),n=(t("dashboard/dashboardSettings"),t("text!../../template/filterGroupButtonsTemplate.htm")),r=(t("domReady"),{APPLY:"applyButton",RESET:"resetButton",FILTERS_PER_ROW:"filtersPerRow",BUTTONS_POSITION:"buttonsPosition"}),h="filterRow",l="fluid",a="fixed",u="right",d="oneButton";return s.View.extend({initialize:function(){this.listenTo(this.model,"change",this._onPropertiesChange)},render:function(){this.$footer=this.$el.parent().append(i.template(n,{i18n:o})).find(".filterGroupButtons"),this.$applyButton=this.$footer.find("> ."+r.APPLY),this.$resetButton=this.$footer.find("> ."+r.RESET),this.$applyButton.on("click",i.bind(this.model.notify,this.model,!0)),this.$resetButton.on("click",i.bind(this._onResetClick,this)),this._setButtonsVisibility()},remove:function(){return this.$applyButton&&this.$applyButton.off("click"),this.$resetButton&&this.$resetButton.off("click"),s.View.prototype.remove.apply(this,arguments)},resizeInputControlsWidth:function(){var t=this.model.get(r.FILTERS_PER_ROW),e=this.$el.width()/this.$el.outerWidth()*100,i=Math.floor(e/t)+"%";this.$el.find(".inputControlWrapper").css({width:i})},wrapInputControls:function(){var t=this.model.get(r.FILTERS_PER_ROW),i=this.$el.find(".inputControlWrapper"),s=i.length;this.removeEmptyRows(),this.unwrapInputControls(i);for(var o=0;s>o;o+=t){var n=e("<div/>",{"class":h}),l=i.filter(function(e){return e>=o&&o+t>e});l.wrapAll(n)}},refresh:function(){this.wrapInputControls(),this.refreshFilterGroupLayout(this.model.get(r.BUTTONS_POSITION))},unwrapInputControls:function(t){t=t||this.$el.find(".inputControlWrapper"),i.each(t,function(t){e(t).parent().hasClass(h)&&e(t).unwrap()})},removeEmptyRows:function(){var t=this.$el.find("."+h);i.each(t,function(t){!e(t).children().length&&e(t).remove()})},refreshFilterGroupLayout:function(t){var e=this.$el.find("."+h),i=this.$el.parent().height(),s=this.$el.css("padding");t===u&&this.$footer.is(":visible")?(e.addClass(l),this.$footer.addClass(a),this.$el.css({"float":"left",height:i-2*s+"px"}),this.model.get(r.APPLY)&&this.model.get(r.RESET)?(this.$footer.removeClass(d),e.removeClass(d)):(this.$footer.addClass(d),e.addClass(d))):(e.removeClass(l).removeClass(d),this.$footer.removeClass(d).removeClass(a),this.$el.css({"float":"none",height:this.$footer.is(":visible")?i-this.$footer.outerHeight(!0)+"px":i}))},enableButtons:function(){this.$applyButton&&this.$applyButton.removeAttr("disabled"),this.$resetButton&&this.$resetButton.removeAttr("disabled")},disableButtons:function(){this.$applyButton&&this.$applyButton.attr("disabled","disabled"),this.$resetButton&&this.$resetButton.attr("disabled","disabled")},_onResetClick:function(){var t=this.model.id;i.each(this.componentViews,function(e){var i=e.model.getParent();i&&i.id===t&&e.reset()}),this.model.notify(!0)},_onPropertiesChange:function(){var t=this.model.changedAttributes();t&&((r.APPLY in t||r.RESET in t)&&(this._setButtonsVisibility(),this.refreshFilterGroupLayout(this.model.get(r.BUTTONS_POSITION))),r.FILTERS_PER_ROW in t&&(this.resizeInputControlsWidth(),this.refresh()),r.BUTTONS_POSITION in t&&this.refreshFilterGroupLayout(t[r.BUTTONS_POSITION]))},_setButtonsVisibility:function(){i.each(r,function(t){this["$"+t]&&this._setButtonVisibility(t)},this),this.model.get(r.APPLY)||this.model.get(r.RESET)?this.$footer.show():this.$footer.hide()},_setButtonVisibility:function(t){var e=this["$"+t];this.model.get(t)?e.show():e.hide()}})});