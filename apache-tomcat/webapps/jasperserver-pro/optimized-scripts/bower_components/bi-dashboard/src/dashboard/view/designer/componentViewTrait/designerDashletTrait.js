define(["require","exports","module","../../base/componentViewTrait/dashletTrait","dashboard/dashboardSettings","dashboard/view/designer/propertiesDialog/PropertiesDialogController","dashboard/enum/dashboardComponentTypes","common/component/menu/ContextMenu","underscore","jquery","logger"],function(e,t,o){function i(e,t){var o=["x","y","width","height"];r.each(o,function(o){e.attr("data-"+o,t.get(o))}),e.attr(n.COMPONENT_ID_ATTRIBUTE,t.id)}var s=e("../../base/componentViewTrait/dashletTrait"),n=e("dashboard/dashboardSettings"),a=(e("dashboard/view/designer/propertiesDialog/PropertiesDialogController"),e("dashboard/enum/dashboardComponentTypes")),r=(e("common/component/menu/ContextMenu"),e("underscore")),h=e("jquery"),d=e("logger").register(o);return r.extend({},s,{_onViewInitialize:function(){s._onViewInitialize.apply(this,arguments),this.listenTo(this.model,"change:x change:y",this._onComponentMove),this.listenTo(this.model,"change:width change:height",this._onComponentResize)},_onViewRemove:function(){s._onViewRemove.apply(this,arguments),this.$content.off("mousedown")},_onPropertiesChange:function(){var e=this.model.changedAttributes();e&&("showTitleBar"in e||"showRefreshButton"in e||"showMaximizeButton"in e)&&this._setDashletToolbarVisualAppearance(e),this._onComponentPropertiesChange&&this._onComponentPropertiesChange()},_onComponentResize:function(){this.$el.parent().css(this.model.getCssPosition()),i(this.$el.parent(),this.model),this.resize(),d.debug("resized dashlet "+this.model.id)},_onComponentMove:function(){this.$el.parent().css(this.model.getCssPosition()),i(this.$el.parent(),this.model),d.debug("moved dashlet "+this.model.id)},_onDashboardPropertiesChange:function(e){var t=e.changedAttributes();t&&("showDashletBorders"in t||"dashletPadding"in t||"dashletMargin"in t)&&(this._setDashletVisualAppearance(),this.resize())},_addOverlay:function(){this.model.get("type")!==a.FILTER_GROUP&&(this.$overlay||(this.$overlay=h("<div></div>").addClass("overlay"),this.$dashlet.prepend(this.$overlay),this.$content.on("mousedown",function(e){e.stopPropagation()})),this._fitOverlay())},_fitOverlay:function(){this.$overlay.height(this.$dashlet.outerHeight(!0)),this.$overlay.width(this.$dashlet.outerWidth(!0));try{var e=parseInt(this.$el.css("padding-left"),10),t=parseInt(this.$dashlet.css("border-width"),10);this.$overlay.css({"margin-left":(isNaN(e)?0:e)+(isNaN(t)?0:t)+"px"})}catch(o){}},_toggleDashletToolbarButtons:function(){this.toolbar&&(this.toolbar.getOptionView("refresh").disable(),this.toolbar.getOptionView("maximize").disable())}})});