define(["require","exports","module","backbone","underscore","jquery","xregexp","backbone.validation","common/validation/ValidationErrorMessage","../../enum/dashboardComponentTypes","../../dashboardSettings"],function(e){function t(e,t){var n,i,r=e.length;for(n=0;r>n;n++)if(i=t(e[n]))return i}function n(e){return e=o.trim(e),e.match(u)?e.replace(l,"_"):null}function i(e,t,n){return o.trim(e)+(t>1?(n||"_")+t:"")}var r=e("backbone"),o=e("underscore"),s=e("jquery"),a=(e("xregexp"),e("backbone.validation")),d=e("common/validation/ValidationErrorMessage"),c=e("../../enum/dashboardComponentTypes"),h=e("../../dashboardSettings"),u=new RegExp(h.DASHLET_ID_VALID_WORD_PATTERN),l=new RegExp(h.DASHLET_ID_BLACK_LIST_CHARS_PATTERN,"g"),g=r.Model.extend({defaults:{id:void 0,type:void 0,name:void 0,resource:void 0},validation:{name:[{required:!0,msg:new d("dashboard.component.error.name.required")},{fn:function(e,t,n){return this.collection.find(function(t){return t.get("name")==e&&t.get("id")!==n.id})},msg:new d("dashboard.component.error.name.duplication")}]},componentName:"Component",initialize:function(e,t){this.get("name")||this.set("name",this.generateName()),this.get("id")||this.set("id",this.generateId()),t||(t={}),t.resource&&(this.resource=t.resource)},getChildren:function(){var e=this;return this.collection.filter(function(t){return t.get("parentId")===e.get("id")})},getParent:function(){return this.has("parentId")?this.collection.findWhere({id:this.get("parentId")}):void 0},generateName:function(e){var t,r=e||o.trim(this.get("label"))||this.componentName,s=n(this.get("type")===c.INPUT_CONTROL&&this.has("resourceId")?this.get("resourceId"):r);return s||(s=this.componentName,this.set("id",this.generateId(s))),t=this.generateIndex(r,"name"," "),i(r,t," ")},generateId:function(e){var r=t([e,this.get(this.get("type")===c.INPUT_CONTROL&&this.has("resourceId")?"resourceId":"name"),this.componentName,this.get("type")],n),o=this.generateIndex(r,"id","_");return i(r,o)},generateIndex:function(e,t,n){if(!this.collection)return 1;for(var i=1;;){var r=e+(i>1?n+i:""),o={};if(o[t]=r,!this.collection.findWhere(o))break;i++}return i},isVisualization:function(){return this.get("type")===c.REPORT||this.get("type")===c.WEB_PAGE_VIEW||this.get("type")===c.ADHOC_VIEW||this.get("type")===c.TABLE||this.get("type")===c.CHART||this.get("type")===c.CROSSTAB},isVisible:function(){return!0},isAutoRefreshable:function(){return this.has("autoRefresh")&&this.has("refreshInterval")&&this.has("refreshIntervalUnit")},acceptWiringVisitor:function(e){this._getWiringMetadata().done(e.register)},_getWiringMetadata:function(){var e=new s.Deferred;return e.resolve(this,{signals:[],slots:{}}),e.promise()},clone:function(){var e=r.Model.prototype.clone.call(this);return e.collection=this.collection,e},toJSON:function(){var e=r.Model.prototype.toJSON.apply(this,arguments);return delete e.selected,e}});return o.extend(g.prototype,a.mixin),g});