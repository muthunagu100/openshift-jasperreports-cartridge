define(["require","backbone","underscore","common/model/RepositoryResourceModel","./RepositoryJsonFileModel","./RepositoryComponentsFileModel","./RepositoryHtmlFileModel","../enum/dashboardResourceReferenceTypes","../enum/dashboardResourceTypes","common/enum/repositoryResourceTypes","../dashboardSettings"],function(e){function r(e){u.FILE in e?(this.resourceReferenceType=u.FILE,this.resource=this.get("type")===T.COMPONENTS?new n(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH}):this.get("type")===T.LAYOUT?new i(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH}):new c(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH})):u.ADHOC_VIEW in e?(this.resourceReferenceType=u.ADHOC_VIEW,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.ADHOC_DATA_VIEW})):u.REPORT in e?(this.resourceReferenceType=u.REPORT,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.REPORT_UNIT})):u.INPUT_CONTROL in e?(this.resourceReferenceType=u.INPUT_CONTROL,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.INPUT_CONTROL})):u.RESOURCE_REFERENCE in e&&(this.resourceReferenceType=u.RESOURCE_REFERENCE,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.RESOURCE_LOOKUP}))}var o=e("backbone"),s=e("underscore"),t=e("common/model/RepositoryResourceModel"),c=e("./RepositoryJsonFileModel"),n=e("./RepositoryComponentsFileModel"),i=e("./RepositoryHtmlFileModel"),u=e("../enum/dashboardResourceReferenceTypes"),T=e("../enum/dashboardResourceTypes"),R=e("common/enum/repositoryResourceTypes"),p=e("../dashboardSettings"),h=o.Model.extend({idAttribute:"name",defaults:{name:void 0,type:void 0,resource:void 0},initialize:function(){this.updateResource(),this.on("change:resource",this.updateResource)},updateResource:function(){var e=this.get("resource");e&&s.isObject(e)&&(this.resource&&this.resourceReferenceType in e?this.resource.set(e[this.resourceReferenceType]):r.call(this,e))},toJSON:function(e){var r=o.Model.prototype.toJSON.apply(this,arguments);return r.resource={},this.resourceReferenceType!==u.FILE?this.resource.isNew()||e===!0?r.resource[this.resourceReferenceType]=this.resource.toJSON():r.resource[u.RESOURCE_REFERENCE]={uri:this.resource.get("uri")}:(r.resource[u.FILE]=this.resource.toJSON(),delete r.resource[u.FILE].version,delete r.resource[u.FILE].uri,delete r.resource[u.FILE].permissionMask,delete r.resource[u.FILE].creationDate,delete r.resource[u.FILE].updateDate),r}});return h.createDashboardResource=function(e,r){var o={};return e.resourceType===R.ADHOC_DATA_VIEW?o[u.ADHOC_VIEW]=e:e.resourceType===R.REPORT_UNIT?o[u.REPORT]=e:e.resourceType===R.INPUT_CONTROL&&(o[u.INPUT_CONTROL]=e),new this({resource:o,type:e.resourceType,name:e.uri},{contextPath:r})},h});