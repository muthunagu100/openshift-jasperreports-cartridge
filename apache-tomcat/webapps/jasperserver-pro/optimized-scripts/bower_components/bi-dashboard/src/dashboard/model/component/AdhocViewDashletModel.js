define(["require","exports","module","jquery","underscore","logger","common/transport/request","json3","bundle!DashboardBundle","./VisualizationDashletModel","dashboard/dashboardSettings","dashboard/enum/dashboardComponentTypes","common/util/identityUtil"],function(e,r,t){function o(e){return p.EMBEDDED_ADHOC_VIEW_TEMP_LOCATION+"/"+e}var n=e("jquery"),i=e("underscore"),s=e("logger").register(t),a=e("common/transport/request"),u=e("json3"),d=e("bundle!DashboardBundle"),c=e("./VisualizationDashletModel"),p=e("dashboard/dashboardSettings"),h=e("dashboard/enum/dashboardComponentTypes"),l=e("common/util/identityUtil"),m={};return c.extend({componentName:d["dashboard.component.adHoc.view.component.name"],getReportResourceUri:function(){var e=m[this.resource.resource.get("uri")]||m[this.get("resource")];if(i.isUndefined(e)){if(!this.componentInitializedDfd._running){this.componentInitializedDfd._running=!0,s.debug("Started checking of report existence for "+this.resource.resource.get("uri"));var r=this,t=this.resource.temporary?o(this.resource.resource.get("name")):this.resource.resource.get("uri");a({type:"POST",headers:{Accept:"application/json"},processData:!1,contentType:"application/json; charset=UTF-8",dataType:"json",data:u.stringify({dataSourceUri:t,label:"dashboardReport"}),url:p.CONTEXT_PATH+"/rest_v2/reportGenerators/custom-template"}).fail(function(e,t,o){r.componentInitializedDfd.reject(e,t,o)}).done(function(e){s.debug("Report for "+r.resource.resource.get("uri")+" is generated successfully"),m[r.resource.resource.get("uri")]=e.uri,r.componentInitializedDfd.resolve(e.uri)})}}else this.componentInitializedDfd.resolve(e);return this.componentInitializedDfd.promise()},resetCaching:function(){this.componentInitializedDfd=new n.Deferred},getDesignerUri:function(){var e=this.isNew()?o(l.generateUniqueName("tmpAdv_")):encodeURIComponent(this.resource.resource.get("uri")),r={_flowId:"adhocFlow",decorate:"no",embeddedDesigner:"true",saveAsUri:e,saveAsOverwrite:!0,reportType:this.get("type")};return this.isNew()||(r.embeddedName=encodeURIComponent(this.get("name"))),this.resource&&(r.resource=encodeURIComponent(this.resource.resource.get("uri"))),p.CONTEXT_PATH+"/flow.html?"+n.param(r)},isNew:function(){return"undefined"==typeof this.resource},_getDataSourceUri:function(){var e=[h.CROSSTAB,h.CHART,h.TABLE];return i.indexOf(e,this.get("type"))>=0?this.resource&&this.resource.resource.get("dataSourceUri")||this.get("dataSourceUri"):c.prototype._getDataSourceUri.call(this)}})});