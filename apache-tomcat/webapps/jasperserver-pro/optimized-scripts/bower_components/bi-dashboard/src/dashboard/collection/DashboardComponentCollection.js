define(["require","exports","module","backbone","logger","underscore","../dashboardSettings","../model/component/DashletModel","../enum/dashboardComponentTypes","../factory/dashboardComponentModelFactory"],function(e,t,n){function o(e){for(var t,n=new RegExp(h.DASHLET_TEMPLATE,"g"),o=[];t=n.exec(e);)o.push(t[0]);return o}function r(e){if(e.isVisualization()&&e.get("type")!==d.WEB_PAGE_VIEW){var t=e.get("resource"),n=this.where({ownerResourceId:t}),o=this.where({resource:t,type:e.get("type")});c.each(n,function(e){o.length||this.remove(e)},this)}}var i=e("backbone"),s=e("logger").register(n),c=e("underscore"),h=e("../dashboardSettings"),a=e("../model/component/DashletModel"),d=e("../enum/dashboardComponentTypes"),u=e("../factory/dashboardComponentModelFactory");return i.Collection.extend({model:u,initialize:function(){this.on("remove",c.bind(r,this))},getSelectedComponent:function(){return this.findWhere({selected:!0})},selectComponent:function(e){var t=this.get(e);this.forEach(function(e){e!==t&&e.set("selected",!1)}),t&&t.set("selected",!0)},setPositionFromHtml:function(e){try{var t=o(e),n=c.map(t,function(e){return a.htmlToPositionObject(e)});this.forEach(function(e){var t=c.findWhere(n,{id:e.id});t&&e.set(t,{silent:!0})})}catch(r){s.error(r)}},toHTML:function(e){var t="";return this.forEach(function(n){n instanceof a&&(t+=n.toHTML(e))}),t},getDashboardPropertiesComponent:function(){return this.findWhere({type:d.DASHBOARD_PROPERTIES})},isOutOfCanvasBounds:function(e){return e.x<0||e.y<0||e.x+e.width>h.GRID_WIDTH||e.y+e.height>h.GRID_HEIGHT},overlaps:function(e,t){return this.some(function(n){return n instanceof a?t===n.get("id")?!1:!(n.get("x")>=e.x+e.width||n.get("x")+n.get("width")<=e.x||n.get("y")>=e.y+e.height||n.get("y")+n.get("height")<=e.y):!1})}})});