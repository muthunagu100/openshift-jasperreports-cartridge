define(["require","exports","module","backbone","../base/ComponentView","dashboard/dashboardMessageBus","dashboard/enum/dashboardMessageBusEvents","dashboard/dashboardSettings","dashboard/view/designer/propertiesDialog/PropertiesDialogController","dashboard/enum/dashboardComponentTypes","common/component/menu/ContextMenu","underscore","jquery","bundle!DashboardBundle"],function(e){var o=e("backbone"),t=e("../base/ComponentView"),n=e("dashboard/dashboardMessageBus"),i=e("dashboard/enum/dashboardMessageBusEvents"),s=(e("dashboard/dashboardSettings"),e("dashboard/view/designer/propertiesDialog/PropertiesDialogController")),r=(e("dashboard/enum/dashboardComponentTypes"),e("common/component/menu/ContextMenu")),a=e("underscore"),l=e("jquery"),d=e("bundle!DashboardBundle");return t.extend({events:a.extend({},t.prototype.events,{click:"_selectComponent",dblclick:"_showPropertiesDialog",contextmenu:"_showContextMenu"}),initialize:function(){t.prototype.initialize.apply(this,arguments),this._initContextMenu(),this.on("componentRendered",a.bind(this._addOverlay,this)),this.on("componentRendered",a.bind(this._onComponentRendered,this)),this.listenTo(this.model,"change:selected",this._onComponentSelect),this.listenTo(this.model,"change",this._onPropertiesChange),this.listenTo(n,i.TOGGLE_PREVIEW_MODE,a.bind(this._onTogglePreviewMode,this)),this.listenTo(this.dashboardProperties,"change",this._onDashboardPropertiesChange)},resize:function(){t.prototype.resize.apply(this,arguments),this.$overlay&&this._fitOverlay()},remove:function(){this.propertiesDialogController&&this.propertiesDialogController.remove(),t.prototype.remove.apply(this,arguments)},_initContextMenu:function(){var e=[{label:d["dashboard.context.menu.option.properties"],action:"properties"},{label:d["dashboard.context.menu.option.delete"],action:"delete"}];this.additionalContextMenuOptions&&(e=e.concat(this.additionalContextMenuOptions)),this.contextMenu=new r(e),this.listenTo(this.contextMenu,"option:properties",this._showPropertiesDialog),this.listenTo(this.contextMenu,"option:delete",this._deleteComponent),this._initComponentSpecificContextMenuEvents&&this._initComponentSpecificContextMenuEvents()},_onTogglePreviewMode:function(e){if(this.propertiesDialogController&&this.propertiesDialogController.dialog){var o=this.propertiesDialogController.dialog,t=this.propertiesDialogController.lastCoordinates;this.propertiesDialogController.dialogIsOpened&&!e?o.open(a.extend({silent:!0},t)):o.close({silent:!0})}},_onComponentRendered:function(){},_onPropertiesChange:function(){this._onComponentPropertiesChange&&this._onComponentPropertiesChange()},_onComponentSelect:function(){this.model.get("selected")?this.$el.addClass("selected"):(this.$el.removeClass("selected"),this.contextMenu.hide())},_onDashboardPropertiesChange:function(){},_deleteComponent:function(){this.trigger("delete",this.model)},_selectComponent:function(e){e&&e.stopPropagation&&e.stopPropagation(),this.model&&this.model.collection&&this.model.collection.selectComponent(l(e.target).attr("id")||this.model.id)},_showPropertiesDialog:function(e){var t={};if(e instanceof o.View){var n=e.$el.offset();t={top:n.top,left:n.left}}else e.stopPropagation&&e.stopPropagation(),t={top:e.pageY,left:e.pageX};this.contextMenu.hide(),this.propertiesDialogController||(this.propertiesDialogController=new s(this.model),this.listenTo(this.propertiesDialogController.dialog,"properties:dialog:select",this._selectComponent)),this.propertiesDialogController.lastCoordinates=t,this.propertiesDialogController.dialog.open(a.extend({renderContent:!1},t))},_showContextMenu:function(e){e.preventDefault(),this._selectComponent(e),this.contextMenu.show({left:e.pageX,top:e.pageY},this.$el)},_addOverlay:function(){},_fitOverlay:function(){}})});