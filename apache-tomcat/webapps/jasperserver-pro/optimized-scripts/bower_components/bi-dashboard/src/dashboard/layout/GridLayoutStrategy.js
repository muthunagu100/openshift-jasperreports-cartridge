define(["require","underscore","jquery","dashboard/dashboardSettings","./helper/MoveHelper","./helper/ResizeHelper","./helper/EmptySpaceDropHelper","./helper/SplitDropHelper"],function(e){var t=e("underscore"),r=e("jquery"),n=e("dashboard/dashboardSettings"),o=e("./helper/MoveHelper"),i=e("./helper/ResizeHelper"),h=e("./helper/EmptySpaceDropHelper"),s=e("./helper/SplitDropHelper"),l=function(e){this.model=e,this.helpers=t.map([o,i,h,s],function(e){return new e(this)},this)};return l.prototype={coordsToCell:function(e,t,r){return{x:t!==e.width()?Math.floor(t/(e.width()/n.GRID_WIDTH)):n.GRID_WIDTH,y:r!==e.height()?Math.floor(r/(e.height()/n.GRID_HEIGHT)):n.GRID_HEIGHT}},preciseCoordsToCell:function(e,t,r){return{x:parseInt(t*n.GRID_WIDTH/e.width()),y:parseInt(r*n.GRID_HEIGHT/e.height())}},cellToCoord:function(e,t){return{x:100*e/n.GRID_WIDTH,y:100*t/n.GRID_HEIGHT}},gridSize:function(e){return{x:e.width()/n.GRID_WIDTH,y:e.height()/n.GRID_HEIGHT}},cellCSS:function(e){var t=this.cellToCoord(e.x,e.y),r=this.cellToCoord(e.width,e.height);return{left:t.x+"%",top:t.y+"%",width:r.x+"%",height:r.y+"%"}},onDashletDragStart:function(e,r){t.each(this.helpers,function(t){t.start&&t.start(r,e)},this)},onDashletDrag:function(e,r){t.each(this.helpers,function(t){t.drag&&t.drag(r,e)},this)},onDashletDragStop:function(e,r){t.each(this.helpers,function(t){t.stop&&t.stop(r,e)},this)},onDashletDrop:function(e,r,n,o){var i;i=o[0].getBoundingClientRect(),i=this.coordsToCell(o,r.clientX-i.left,r.clientY-i.top),i.width=i.height=1,t.each(this.helpers,function(t){t.drop&&t.drop(r,n,i,e.id)},this),i&&this.updateLayout(e.id,i)},initVisualHelpers:function(e){t.each(this.helpers,function(t){t.init&&t.init(e)},this)},updateLayout:function(e,t){var r=this.model.currentFoundation.components.get(e);r&&r.set(t)},getDashletDropTarget:function(e){var t=r(e.toElement||e.originalEvent.target);return t.hasClass("dragHelper")?t=this.lastTarget:this.lastTarget=t,t=t.parents("["+n.COMPONENT_ID_ATTRIBUTE+"]"),t&&t.length?t:void 0},calculateEmptyArea:function(e,r){var n,o;if(e=t.clone(e),n=function(e,r){var n=t.clone(r);return 1&e&&n.x--,2&e&&n.y--,4&e&&n.width++,8&e&&n.height++,n},this.overlapsOrIsOutOfBounds(e,r))return!1;for(var i=15;i;i--)for(;!this.overlapsOrIsOutOfBounds(o=n(i,e),r);)e=o;return e},overlapsOrIsOutOfBounds:function(e,t){return this.model.currentFoundation.components.isOutOfCanvasBounds(e)?!0:this.model.currentFoundation.components.overlaps(e,t)},remove:function(){t.each(this.helpers,function(e){e.deinit&&e.deinit()},this)}},l});