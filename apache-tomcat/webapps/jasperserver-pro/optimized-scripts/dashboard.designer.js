var localContext={messages:{},DASHBOARD_DOM_ID:"dashboardDesigner",DASHBOARD_TREE_CONTAINER_ID:"dashboardFolderContainer",repoTree:null,specialContentTree:null,standardControlNode:null,CUSTOM_URL_CANCEL_BTN_PATTERN:"button#customURLCancel",CUSTOM_URL_OK_BTN_PATTERN:"button#customURLOk",CUSTOM_URL_NO_PARAMS_CLS:"noParams",SPECIAL_TREE_DOM_ID:"dashboardSpecialContentTree",SPECIAL_TREE_LEAF_PATTERN:"ul#dashboardSpecialContentTree",REPO_TREE_LEAF_PATTERN:"ul#dashboardRepoTree",REPO_TREE_DOM_ID:"dashboardRepoTree",REPOSITORY_TREE_PROVIDER:"dashboardRepositoryTreeFoldersProvider",TREE_FOLDER_TYPE_CLASS:"com.jaspersoft.jasperserver.api.metadata.common.domain.Folder",TREE_NODE_TYPE_CLASS:"com.jaspersoft.jasperserver.api.metadata.common.domain.NewNode",TREE_NODE_CONTROL_TYPE:"controlFrameType",ACTION_MODEL_TAG:"dashboardActionModel",CUSTOM_URL_DOM_ID:"customURL",CUSTOM_URL_INPUT_DOM_ID:"customURLInput",DASHBOARD_VIEWER_PARAM:"&dashboardViewer=true",SESSION_ATTRIBUTE_MISSING_EXCEPTION:"sessionAttributeMissingException",currentCustomFrame:null,customURLDialog:{isEditMode:!1,isVisible:!1},currentEditingTextFrame:null,currentHoveredOverlay:null,contextLevels:{context:"dashboardDashboardLevel",content:"dashboardContentFrameLevel",control:"dashboardControlFrameLevel",text:"dashboardTextFrameLevel",clickable:"dashboardClickableFrameLevel",repo:"dashboardRepoTreeLeafLevel",special:"dashboardSpecialContentTreeLeafLevel"},typeToView:{"com.jaspersoft.ji.adhoc.AdhocReportUnit":"viewAdhocReportFlow&viewAsDashboardFrame=true&dashboardViewer=true&reportUnit=","com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.ReportUnit":"viewReportFlow&viewAsDashboardFrame=true&dashboardViewer=true&reportUnit=","com.jaspersoft.ji.adhoc.DashboardResource":"dashboardRuntimeFlow&viewAsDashboardFrame=true&dashboardViewer=true&dashboardResource="},frameTypes:[],framesByType:[],controlTypes:["singleReport","multiReport","other"],nextFrameSrc:null,unansweredAddRequests:0,regexForBeginningNums:new RegExp("^\\d+"),regexForEndingNums:new RegExp("\\d+$"),regexForFrameName:new RegExp("\\_[A-Za-z]+$"),fontSizeTester:null,CUSTOM_URL_IFRAME_TIMEOUT:1e4,ALL_CONTENT_PARENT_DOM_ID:"dashboardFrameParent",CONTENT_FRAME_DOM_ID:"contentFrameTemplate",CONTAINER_ID_STUB:"Container",CONTROL_FRAME:"controlFrame",CONTENT_FRAME:"contentFrame",TEXT_FRAME:"textFrame",CLICKABLE_FRAME:"clickableFrame",CUSTOM_RESOURCE_TYPE:"customResourceType",CONTENT_FRAME_PATTERN:"div.componentContainer.iframe",CONTENT_FRAME_OVERLAY_PATTERN:"div.componentContainer.iframe>.overlay.button",CONTROL_FRAME_PATTERN:"div.componentContainer.control",CONTROL_FRAME_OVERLAY_PATTERN:"div.componentContainer.control>.overlay.button",CLICKABLE_FRAME_PATTERN:"div.componentContainer.actionButton",CLICKABLE_FRAME_OVERLAY_PATTERN:"div.componentContainer.actionButton>.overlay.button",TEXT_FRAME_PATTERN:"div.componentContainer.displayText",TEXT_FRAME_OVERLAY_PATTERN:"div.componentContainer.displayText>.overlay.button",EDITABLE_TEXT_PATTERN:"div.displayText>.read",EDITING_TEXT_PATTERN:"div.displayText>input.edit",CUSTOM_URL_INPUTCONTROLS_PATTERN:"#customURL div.control.fillParent > div.content div.body",TITLE:"#title",DELETED_TITLE_CSS:"deletedTitle",SCROLL_ENABLED:"yes",SIZER_PATTERN:"div.sizer",DROP_ZONE:"dashboardDropZone",REAL_DROP_ZONE:"DZone",dragStartCoordinates:{left:null,top:null},draggableFrame:null,justDragged:!1,selectedFrameOverlays:[],OVERLAY_PREFIX:"containerOverlay_",NODE_CLICKABLE_PREFIX:"button",PARAM_MAPPER_CHECKBOX_PREFIX:"paramMapperCheckbox_",PARAM_MAPPER_INPUT_PREFIX:"paramMapperInput_",CONTROL_PREFIX:"input_",patternToId:{"this.CONTENT_FRAME_PATTERN":"contentFrameContainer_","this.CONTROL_FRAME_PATTERN":"controlFrameContainer_","this.CLICKABLE_FRAME_PATTERN":"clickableFrameContainer_","this.TEXT_FRAME_PATTERN":"textFrameContainer_"},patternToAddAction:{},buttonIdToAction:{},toolbarActionMap:{},marqueeMovePosition:{x:0,y:0},marqueeStartPosition:{x:0,y:0},draggingMarquee:!1,boundHandlerMethod:null,titleEditing:!1,adjustingFontSize:!1,RUN_URL_PREFIX:"flow.html?_flowId=dashboardRuntimeFlow&runTempDashboard=true&clientKey=",rightCoordinates:[],bottomCoordinates:[],shouldReplace:!1,replacingFrameName:null,hackPadding:2,collectionOfOpenDialogs:[],dialogESCFunctions:{},controlsController:null,customUrlLoadingTimeouts:{},getMode:function(){return designerBase.DASHBOARD},initAll:function(){layoutModule.resizeOnClient("folders","canvas"),webHelpModule.setCurrentContext("legacy_dashboard"),this._updateAllStates(),this.initRepoTree(),this.initSpecialContentTree(),this.initContentFrames(),this._updateInputControlsNodes(),this.oneTimeInit(),this._setDashboardDropZone(),this._createDashboardScroll(),this.dashboardSpecificEvents(),this._updateScroll()},oneTimeInit:function(){this._updateConstantState(),this.initDashboardGeneralEvents(),this.initFrameTypes(),this.initPatternToActionFunctions(),this.initPreventBrowserSelection($("dashboardDesigner")),this.initControlsController(),JRS.reportExecutionCounter.check()},initContentFrames:function(){var e=this;_.each(this.framesByType[this.CONTENT_FRAME],function(t){var o=e._constructIframeSrc(t),a=e._getIFrameByName(t.name);$(a).observe("load",function(){e._updateIFrameLoadingStatus(e.OVERLAY_PREFIX+t.name,t.hasScrollBars?"yes":"no")}),e.loadIframe(a,o,t.resourceType===e.CUSTOM_RESOURCE_TYPE)})},loadIframe:function(e,t,o){var a=jQuery(e);if(a.attr("src",t),o){var r=this._getIFrameNameFromIFrame(e),n=a.parent().parent(),i=this;n.removeClass("hideLoadingAnimation"),n.find(".externalUrlEmbeddingError").remove(),this.customUrlLoadingTimeouts[r]&&clearTimeout(this.customUrlLoadingTimeouts[r]),this.customUrlLoadingTimeouts[r]=setTimeout(function(){var e=jQuery("<div></div>");e.html(i.DASHBOARD_CUSTOM_URL_ERROR.replace("\n","<br>")).addClass("externalUrlEmbeddingError"),n.addClass("hideLoadingAnimation").prepend(e)},this.CUSTOM_URL_IFRAME_TIMEOUT)}},_constructIframeSrc:function(e){var t=e.resourceType===this.CUSTOM_RESOURCE_TYPE,o=t?"":__jrsConfigs__.contextPath,a=o+e.source+e.uri;return 0!==e.source.indexOf("http://")&&(a+="&embedded=true"),a.replace("/&","?")},_getAllControlsInformation:function(){return _.map(localContext.controlFrames,function(e){return this._getControlInformation(e)},this)},_getControlInformation:function(e){var t="controlFrameContainer_"+e.name;return{controlId:e.paramName,controlFrameId:t,controlValue:e.paramValue}},initControlsController:function(){this.controlsController=new JRS.Controls.DashboardController({reportUri:"/dashboard/designer/"+clientKey,viewModel:new JRS.Controls.DashboardViewModel}),JRS.Controls.listen({"viewmodel:values:changed":_.bind(function(){var e=this.controlsController.getViewModel().get("selection");this.updateInputControlParams(e)},this)});var e=this._getAllControlsInformation(),t=_.bind(function(){this.controlFrames.length>0&&this._updateAllIFramesSRCParam()},this);e&&0!=e.length?this.controlsController.addControls(e).always(t):t&&t()},initPreventBrowserSelection:function(e){var t=null,o=$(e);o&&(isIE()?jQuery(e).on("onselectstart",function(e){var t=e.srcElement.tagName;"INPUT"!=t&&"TEXTAREA"!=t&&(e.returnValue=!1)}):isWebKitEngine()?(t=$(o).readAttribute("style"),t.include("webkit-user-select:none")||(t+=";-webkit-user-select:none",$(o).writeAttribute("style",t))):isMozilla()&&(t=o.readAttribute("style"),t.include("moz-user-select:-moz-none")||(t+=";-moz-user-select:-moz-none",$(o).writeAttribute("style",t))))},initFrameTypes:function(){this.frameTypes.push(localContext.CONTENT_FRAME,localContext.CONTROL_FRAME,localContext.TEXT_FRAME,localContext.CLICKABLE_FRAME)},initFramesByType:function(){this.framesByType[localContext.CONTENT_FRAME]=localContext.contentFrames,this.framesByType[localContext.CONTROL_FRAME]=localContext.controlFrames,this.framesByType[localContext.TEXT_FRAME]=localContext.textFrames,this.framesByType[localContext.CLICKABLE_FRAME]=localContext.clickableFrames},initPatternToActionFunctions:function(){this.patternToAddAction={"this.CONTENT_FRAME_OVERLAY_PATTERN":this.addContentFrameToSelection,"this.CONTROL_FRAME_OVERLAY_PATTERN":this.addControlFrameToSelection,"this.CLICKABLE_FRAME_OVERLAY_PATTERN":this.addClickableFrameToSelection,"this.TEXT_FRAME_OVERLAY_PATTERN":this.addTextFrameToSelection},this.buttonIdToAction={submit:this.updateInputControlParams.bind(this),reset:this.resetInputControlParams.bind(this),print:this.printDashboard.bind(this)},this.toolbarActionMap={presentation:this.runDashboard.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},this.dialogESCFunctions={save:designerBase.cancelSaveDialog,customUrl:this._cancelCustomURLPrompt.bind(this)}},hideAllDialogsAndMenus:function(){actionModel.hideMenu();var e=Object.values(this.dialogESCFunctions);e.each(function(e){e()}.bind(this))},enablePreviewAndSave:function(){localContext.contentFrames.length||localContext.textFrames.length?($("presentation")&&buttonManager.enable($("presentation")),$("save")&&buttonManager.enable($("save"))):($("presentation")&&buttonManager.disable($("presentation")),$("save")&&buttonManager.disable($("save")))},initRepoTree:function(){this.repoTree=this.getRepositoryTree(),this.repoTree.showTree(1)},initSpecialContentTree:function(){this.specialContentTree=this.getSpecialContentTree(),this.specialContentTree.renderTree()},initDesignBaseVars:function(){TIMEOUT_INTERVAL=1e3*serverTimeoutInterval,DASHBOARD_SESSION_TIMEOUT_MESSAGE=dashBoardSessionExpireCode,DASHBOARD_EXIT_MESSAGE=dashBoardExitConfirmation,toolbarButtonModule.ACTION_MODEL_TAG="dashboardActionModel"},_updateAllIFramesSRCParam:function(e){if(e){var t=this._getContentFrameByName(e);this._updateIFramesSRCParam(t)}else localContext.contentFrames.each(function(e){this._updateIFramesSRCParam(e)}.bind(this))},_updateIFramesSRCParam:function(e){var t="",o=null,a=null,r=null,n=null,i=null,s="";e&&(o=e.name,a=this._getIFrameByName(o),r=e.resourceType==localContext.CUSTOM_RESOURCE_TYPE?"":localContext.URL_CONTEXT_PATH,i=""==r&&""==e.uri?"":"&fid=contentFrame_"+o,s=e.source.indexOf(localContext.DASHBOARD_VIEWER_PARAM)>-1?"":localContext.DASHBOARD_VIEWER_PARAM,n=removeTrailingSlash(r+e.source+e.uri+i+s),t="",localContext.controlFrames.each(function(o){var a=e[o.paramName];if(a){var r=this._getSelectedValuesForControlFrame(o),i=this._formatParamValue(a,r),s=getSymbolToAppendNextParam(n+t);t=t+s+i}}.bind(this)),t&&(isIPad()||(document.getElementById("contentFrameContainer_"+o).style.backgroundImage="url(themes/default/images/wait_animation_large.gif)"),a.className="hidden",this.loadIframe(a,n+t,e.resourceType===this.CUSTOM_RESOURCE_TYPE)))},_getSelectedValuesForControlFrame:function(e){var t=this.controlsController.getViewModel().get("selection")[e.paramName];return void 0!=t?t:e.paramValue},_updateState:function(){evaluateScript("dashboardDesignerState"),this.initFramesByType(),this.initDesignBaseVars(),this._updateTitleClass(localContext.titleShowing),this.fontSizeTester=$("fontSizeTester"),designerBase.updateSessionWarning(),this.enablePreviewAndSave()},_updateScroll:function(){if(this.scroll){var e=this.scroll.wrapper.down(),t=$("sizeGuide").getDimensions();e.setStyle({width:t.width+40+"px",height:t.height+40+"px"}),this.scroll.refresh()}designerBase.updateIFrameScrolls()},_updateBaseState:function(){evaluateScript("baseState")},_updateConstantState:function(){evaluateScript("dashboardDesignerConstantState")},_updateAllStates:function(){this._updateState(),this._updateBaseState(),this._updateConstantState()},_setDashboardDropZone:function(){var e=$(this.DROP_ZONE).up("div.content"),t="realDropZone";$(e).writeAttribute("id",t),Droppables.remove(t),Droppables.add(t,{accept:["componentContainer","iframe","wrap"],onDrop:localContext.dragNDropOfFrameObject})},_createDashboardScroll:function(){isSupportsTouch()&&(this.scroll=layoutModule.createScroller($(this.DROP_ZONE)))},getRepositoryTree:function(){var e=dynamicTree.createRepositoryTree(this.REPO_TREE_DOM_ID,{providerId:this.REPOSITORY_TREE_PROVIDER,rootUri:"/",organizationId:organizationId,publicFolderUri:publicFolderUri,urlGetNode:"flow.html?_flowId=adhocTreeFlow&method=getNode",urlGetChildren:"flow.html?_flowId=adhocTreeFlow&method=getChildren",dragPattern:".leaf>.draggable",selectOnMousedown:!isIPad(),regionID:designerBase.DASHBOARD_REPO_TREE_LEVEL,treeErrorHandlerFn:function(){alert("error loading tree")}});return e},getSpecialContentTree:function(){function e(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("com.jaspersoft.jasperserver.api.metadata.common.domain.Folder"),NewNode:new dynamicTree.TreeNode.Type("com.jaspersoft.jasperserver.api.metadata.common.domain.NewNode")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_folders_specialContent:leaf"}e.prototype=deepClone(dynamicTree.TreeNode.prototype);var t=new dynamicTree.TreeSupport(this.SPECIAL_TREE_DOM_ID,{bShowRoot:!1,providerId:"",dragPattern:".leaf>.draggable",nodeClass:e,selectOnMousedown:!isIPad(),regionID:designerBase.DASHBOARD_SPECIAL_CONTENT_TREE_LEVEL,templateDomId:"list_responsive_collapsible_folders_specialContent"}),o={id:"root",label:"Dashbaord Root",type:this.TREE_FOLDER_TYPE_CLASS,uri:"/"},a=t.processNode(o);t.setRootNode(a),t.sortNodes=!1,a.isloaded=!0,a.editable=!1;var r={id:"fakeRoot",label:localContext.SPECIAL_CONTENT_LABEL,type:this.TREE_FOLDER_TYPE_CLASS,uri:"/special_content",cssClass:"specialContent"},n=t.processNode(r),i=t.getRootNode();n.isloaded=!0,n.editable=!1,i.addChild(n);var s=this.getCustomControlNodes().concat(this.getControlFolderNodes());return this.appendChildNodeToParent(t,n,s),s=this.getStandardControlNodes(),this.appendChildNodeToParent(t,this.standardControlNode,s),t},_checkIfDraggingFromTree:function(){return Draggables.dragging==designerBase.DASHBOARD_SPECIAL_CONTENT_TREE_LEVEL||Draggables.dragging==designerBase.DASHBOARD_REPO_TREE_LEVEL},appendChildNodeToParent:function(e,t,o){for(var a=o.length,r=0;a>r;r++){var n=e.processNode(o[r]);n.isloaded=!0,n.editable=!1,"otherCtlsFolder"==o[r].id&&(this.standardControlNode=n),t.addChild(n)}},getCustomControlNodes:function(){var e=[],t={id:"custom_URL",uri:"/special_content/custom_URL",type:this.TREE_NODE_TYPE_CLASS,label:localContext.CUSTOM_URL_LABEL},o={id:"free_text",uri:"/special_content/free_text",type:this.TREE_NODE_TYPE_CLASS,label:localContext.FREE_TEXT};return e.push(t,o),e},getControlFolderNodes:function(){var e=[],t={id:"srCtlsFolder",children:[],uri:"/special_content/srCtlsFolder",type:this.TREE_FOLDER_TYPE_CLASS,label:localContext.SINGLE_REPORT_CONTROL_LABEL},o={id:"mrCtlsFolder",children:[],uri:"/special_content/mrCtlsFolder",type:this.TREE_FOLDER_TYPE_CLASS,label:localContext.MULTIPLE_REPORT_CONTROL_LABEL},a={id:"otherCtlsFolder",children:[],uri:"/special_content/otherCtlsFolder",type:this.TREE_FOLDER_TYPE_CLASS,label:localContext.STANDARD_REPORT_CONTROL_LABEL};return e.push(t,o,a),e},getStandardControlNodes:function(){var e=[],t={id:"button_submit",children:null,uri:"/special_content/otherCtlsFolder/button_submit",type:this.TREE_NODE_TYPE_CLASS,extra:"submit",label:localContext.SUBMIT_BUTTON_LABEL},o={id:"button_reset",children:null,uri:"/special_content/otherCtlsFolder/button_reset",type:this.TREE_NODE_TYPE_CLASS,extra:"reset",label:localContext.RESET_BUTTON_LABEL},a={id:"button_print",children:null,uri:"/special_content/otherCtlsFolder/button_print",type:this.TREE_NODE_TYPE_CLASS,extra:"print",label:localContext.PRINT_BUTTON_LABEL},r={id:"text_label",children:null,uri:"/special_content/otherCtlsFolder/text_label",type:this.TREE_NODE_TYPE_CLASS,label:localContext.TEXT_LABEL};return e.push(t,o,a,r),e},_getSpecialContentTreeRoot:function(){return this.specialContentTree.getRootNode()?this.specialContentTree.getRootNode().getFirstChild():null},_updateInputControlsNodes:function(){var e=[],t=this._getSpecialContentTreeRoot();if(t){var o=this.specialContentTree.findNodeChildByMetaName(t,"srCtlsFolder");o.resetChilds(),localContext.controls.singleReport.each(function(t,o){var a={id:"sr_"+o,label:t.label,uri:"/special_content/srCtlsFolder/sr_"+o,type:localContext.TREE_NODE_CONTROL_TYPE,extra:t.name};e.push(a)}),this.appendChildNodeToParent(this.specialContentTree,o,e),e.clear();var a=this.specialContentTree.findNodeChildByMetaName(t,"mrCtlsFolder");a.resetChilds(),localContext.controls.multiReport.each(function(t,o){var a={id:"mr_"+o,label:t.label,uri:"/special_content/mrCtlsFolder/mr_"+o,type:localContext.TREE_NODE_CONTROL_TYPE,extra:t.name};e.push(a)}),this.appendChildNodeToParent(this.specialContentTree,a,e)}this.specialContentTree.renderTree()},initDashboardGeneralEvents:function(){isSupportsTouch()||($("dashboardCanvasArea").observe("mouseover",function(e){var t=e.element();matchMeOrUp(t,layoutModule.BUTTON_PATTERN)&&!relatedTargetInElementSubtree(e,t)&&buttonManager.over(t),Event.stop(e)}),$("dashboardCanvasArea").observe("mouseout",function(e){var t=e.element();matchMeOrUp(t,layoutModule.BUTTON_PATTERN)&&!relatedTargetInElementSubtree(e,t)&&buttonManager.out(t),Event.stop(e)})),document.observe(layoutModule.ELEMENT_CONTEXTMENU,function(e){var t=null,o=!0,a=null,r=e.memo.node,n=e.memo.targetEvent;if(t=matchAny(r,[this.SPECIAL_TREE_LEAF_PATTERN,this.REPO_TREE_LEAF_PATTERN],!0)){var i=matchAny(r,[this.REPO_TREE_LEAF_PATTERN],!0),s=i?this.repoTree:this.specialContentTree;if(a=i?"repo":"special",r=s.getTreeNodeByEvent(e.memo.targetEvent),s.isNodeSelected(r)){if(designerBase.isInSelection(r)){var l=this.contextLevels[a];return void this.showDynamicMenu(n,l,null)}this._addTreeLeafToSelection(r,i)}}if(t=matchAny(r,[this.CONTENT_FRAME_OVERLAY_PATTERN,this.CONTROL_FRAME_OVERLAY_PATTERN,this.CLICKABLE_FRAME_OVERLAY_PATTERN,this.TEXT_FRAME_OVERLAY_PATTERN],!1),matchAny(t,[this.CONTENT_FRAME_OVERLAY_PATTERN],!1)&&(o=this._isIFrameContentLoaded(t)),t&&o){var d=null,c=null;if(r.match(this.CONTENT_FRAME_OVERLAY_PATTERN))d=designerBase.DASHBOARD_CONTENT_FRAME_MENU_LEVEL,c="this.CONTENT_FRAME_OVERLAY_PATTERN";else if(r.match(this.CLICKABLE_FRAME_OVERLAY_PATTERN))d=designerBase.DASHBOARD_CLICKABLE_FRAME_MENU_LEVEL,c="this.CLICKABLE_FRAME_OVERLAY_PATTERN";else if(r.match(this.TEXT_FRAME_OVERLAY_PATTERN))d=designerBase.DASHBOARD_TEXT_FRAME_MENU_LEVEL,c="this.TEXT_FRAME_OVERLAY_PATTERN";else{if(!r.match(this.CONTROL_FRAME_OVERLAY_PATTERN))throw"unknown pattern!";d=designerBase.DASHBOARD_CONTROL_FRAME_MENU_LEVEL,c="this.CONTROL_FRAME_OVERLAY_PATTERN"}designerBase.isObjectInSelection(r,"id")||this.patternToAddAction[c].apply(this,[r,e]),this.showDynamicMenu(n,d,null)}}.bind(this)),document.observe("key:delete",function(){this.customURLDialog.isVisible||(actionModel.hideMenu(),this.deleteSelectedFrames())}.bind(this)),document.observe("key:enter",function(e){var t=e.memo.node,o=matchAny(t,["input.edit"],!0);actionModel.hideMenu(),o&&(this._deselectAllSelectedDashboardFrames(),Event.stop(e.memo.targetEvent))}.bind(this)),document.observe("key:selectAll",function(e){actionModel.hideMenu(),this._deselectAllSelectedDashboardFrames(),this._selectAllDashboardFrameObjects(e.memo.targetEvent),Event.stop(e.memo.targetEvent)}.bind(this)),document.observe("key:save",function(e){actionModel.hideMenu(),this.canSaveDashboard()&&(this._deselectAllSelectedDashboardFrames(),designerBase.handleSave(),Event.stop(e.memo.targetEvent))}.bind(this)),document.observe("key:escape",function(e){var t=null,o=null,a=null;if(this.hideAllDialogsAndMenus(),this.draggingMarquee&&(Event.stopObserving(document.body,"mousemove"),this._deleteMarquee(),this.draggingMarquee=!1),o=e.element(),t=o.match(this.EDITING_TEXT_PATTERN)){var r=$(o).previousSiblings()[0];o.value=$(r).innerHTML,a=$(o).up("DIV.editMode"),$(a).removeClassName("editMode")}}.bind(this)),document.observe("keydown",function(e){var t=null,o=null;if(this.selectedFrameOverlays.length>0&&!this.customURLDialog.isVisible&&(t=this._getNewFrameCoordinates(e),this._moveFramesByKeys(t)),e.keyCode==Event.KEY_TAB&&!this.titleEditing&&(o=e.element(),"INPUT"==o.nodeName&&$(o).hasClassName("edit"))){var a=$(o).up("DIV");$(a)&&$(a).hasClassName("editMode")&&this._deselectAllSelectedDashboardFrames()}this.titleEditing&&(e.keyCode==Event.KEY_ESC&&this._revertToBackHeaderTitle(),e.keyCode==Event.KEY_TAB&&this._revertDashboardTitleFromEditMode(e))}.bind(this)),document.observe("keyup",function(e){this.selectedFrameOverlays.length>0&&!this.customURLDialog.isVisible&&(e.keyCode==Event.KEY_LEFT||e.keyCode==Event.KEY_RIGHT||e.keyCode==Event.KEY_UP||e.keyCode==Event.KEY_DOWN)&&this.notifyServerMoveFrames()}.bind(this)),document.observe("dragger:sizer",function(e){this.adjustingFontSize=!1;var t=null,o=(e.memo.targetEvent,e.memo.element),a=$(o).up("DIV");a&&($(a).hasClassName("free")&&(t=this._adjustFontForSelectedTextFrames(),this.adjustingFontSize=!0,this.notifyServerResizeFrames(this.adjustingFontSize,t),this._deselectAllSelectedDashboardFrames()),a.match(this.CONTROL_FRAME_PATTERN)&&this._updateAllSelectedControlFrameCoordinates(),a.match(this.CONTENT_FRAME_PATTERN)&&this._updateAllSelectedContentFrameCoordinates())}.bind(this)),jQuery("#customURL").on("click","#customURLCancel",function(){this.currentCustomFrame&&!this.customURLDialog.isEditMode&&$(this.currentCustomFrame).remove(),this._hideCustomURLPrompt()}.bind(this)),jQuery("#customURL").on("click","#customURLOk",function(){$("customURLInput").value.blank()?this._invalidCustomURLError():($(this.currentCustomFrame).removeClassName("hidden"),this._processCustomURLPromptInput())}.bind(this)),$("customURL").observe("key:enter",function(){$("customURLInput").value.blank()?this._invalidCustomURLError():($(this.currentCustomFrame).removeClassName("hidden"),this._processCustomURLPromptInput())}.bind(this)),$(this.DASHBOARD_DOM_ID).observe("mouseover",function(e){var t=null,o=e.element();if(t=matchAny(o,[this.CONTENT_FRAME_OVERLAY_PATTERN,this.CONTENT_FRAME_PATTERN],!0),t&&this._checkIfDraggingFromTree()){var a=null;a=t.match(this.CONTENT_FRAME_OVERLAY_PATTERN)?t.identify():$(t).down("DIV.overlay").identify(),Effect.Pulsate(a,{pulses:5,duration:2})}}.bind(this)),jQuery(this.TITLE).on(isSupportsTouch()?"touchstart":"mousedown",function(e){this._deselectAllSelectedDashboardFrames(),this.editDashboardTitle(),e.preventDefault(),e.stopPropagation()}.bind(this)),$(this.DROP_ZONE).observe(isSupportsTouch()?"touchstart":"mousedown",function(e){var t=e.element(),o=matchAny(t,[this.EDITABLE_TEXT_PATTERN],!0);o&&this._deselectAllSelectedDashboardFrames()}.bind(this)),$("dashboardCanvasArea").observe(isSupportsTouch()?"touchstart":"mousedown",function(e){var t=null,o=getTouchedElement(e);t=matchAny(o,[this.CONTENT_FRAME_PATTERN,this.CONTROL_FRAME_PATTERN],!0),t||(this._deselectAllSelectedDashboardFrames(),e.touches&&1==e.touches.length?isSupportsTouch()&&this._deleteMarquee():(this._createMarquee(e),this.marqueeMovePosition={x:e.pointerX(),y:e.pointerY()},this.marqueeStartPosition={x:e.pointerX(),y:e.pointerY()},this.boundHandlerMethod=this._moveListener.bind(this),Event.observe(document.body,"mousemove",this.boundHandlerMethod))),actionModel.hideMenu()}.bind(this)),Event.observe(document.body,isSupportsTouch()?"touchend":"mouseup",function(e){this.boundHandlerMethod&&(Event.stopObserving(document.body,"mousemove",this.boundHandlerMethod),this._caughtByMarquee(e),this._deleteMarquee(),this.boundHandlerMethod=null)}.bind(this)),$(this.DROP_ZONE).observe(isSupportsTouch()?"touchend":"mouseup",function(e){var t=null,o=e.element();if(!isRightClick(e)&&!this.draggingMarquee)if(this._checkIfDraggingFromTree()){if(t=matchAny(o,[this.CONTENT_FRAME_OVERLAY_PATTERN,this.CONTENT_FRAME_PATTERN],!0)){this.shouldReplace=!0;var a=null;a=t.match(this.CONTENT_FRAME_PATTERN)?$(t).down("DIV.overlay"):t,a&&(this.replacingFrameName=$(a).readAttribute("data-frameName"))}}else{if(o.match(this.CONTENT_FRAME_OVERLAY_PATTERN)?this.addContentFrameToSelection(o,e):o.match(this.CLICKABLE_FRAME_OVERLAY_PATTERN)?this.addClickableFrameToSelection(o,e):o.match(this.TEXT_FRAME_OVERLAY_PATTERN)?this.addTextFrameToSelection(o,e):o.match(this.CONTROL_FRAME_OVERLAY_PATTERN)&&this.addControlFrameToSelection(o,e),o.match(this.CONTENT_FRAME_PATTERN)){var r=$(o).down("DIV.overlay.button");$(r)&&this.addContentFrameToSelection(r,e)}if(t=matchAny(o,[this.EDITABLE_TEXT_PATTERN],!0)){var n=$(t).up("DIV");n&&!$(n).hasClassName("editMode")&&(this.currentEditingTextFrame=$(n),this.currentEditingTextFrame.addClassName("editMode"),this.currentEditingTextFrame.down("input.edit").focus(),this.currentEditingTextFrame.down("input.edit").select())}}}.bind(this)),$(this.DROP_ZONE).observe("click",function(e){var t=null,o=e.element();if(t=matchAny(o,["div.componentContainer.control.actionButton>button.action"],!0)){var a=t.identify(),r=/[A-Za-z]+$/,n=r.exec(a)[0];n&&(this.buttonIdToAction[n](),e.stop())}}.bind(this)),Event.observe($(this.DROP_ZONE),"scroll",function(){actionModel.hideMenu(),this._setDashboardDropZone()}.bind(this)),Event.observe($(this.DASHBOARD_TREE_CONTAINER_ID),"scroll",function(){actionModel.hideMenu()}.bind(this)),document.stopObserving(isSupportsTouch()?"touchend":"mouseup",localContext.deSelectAllPressedNavMuttons),document.observe(isSupportsTouch()?"touchend":"mouseup",localContext.deSelectAllPressedNavMuttons)},initDashboardTreeEvents:function(){for(var e=[this.specialContentTree,this.repoTree],t=0;t<e.length;t++)e[t].observe("leaf:mousedown",function(e){{var t=e.memo.node,o=e.element(),a=matchAny(o,[this.REPO_TREE_LEAF_PATTERN],!0);this._getOtherTreeObject(o,a)}this._deselectAllSelectedDashboardFrames(),this._addTreeLeafToSelection(t,a)}.bind(this)),e[t].observe("leaf.drag:mousedown",function(e){{var t=(e.memo.targetEvent,e.memo.node),o=e.element(),a=matchAny(o,[this.REPO_TREE_LEAF_PATTERN],!0);this._getOtherTreeObject(o,a)}this._deselectAllSelectedDashboardFrames(),this._addTreeLeafToSelection(t,a)}.bind(this)),e[t].observe("leaf:dblclick",function(e){var t=e.memo.targetEvent,o=e.memo.node,a=e.element(),r=matchAny(a,[this.REPO_TREE_LEAF_PATTERN],!0),n=this._getOtherTreeObject(a,r);this.quickAddOfFrameObject(t,o),n._deselectAllNodes(),this._deselectAllSelectedDashboardFrames()}.bind(this)),e[t].observe("node:mousedown",function(e){var t=e.element(),o=matchAny(t,[this.REPO_TREE_LEAF_PATTERN],!0),a=this._getOtherTreeObject(t,o);a._deselectAllNodes(),this._deselectAllSelectedDashboardFrames()}.bind(this)),e[t].observe("node.drag:mousedown",function(e){var t=e.element(),o=matchAny(t,[this.REPO_TREE_LEAF_PATTERN],!0),a=this._getOtherTreeObject(t,o);a._deselectAllNodes(),this._deselectAllSelectedDashboardFrames()}.bind(this))},isTitleShowing:function(){return localContext.titleShowing},isMultiSelect:function(e,t){var o=isMetaHeld(e),a=selectionCategory.area==t;return a&&o},multipleContentFramesSelected:function(){var e=0,t=!1;return this.selectedFrameOverlays.each(function(o){var a=$(o).readAttribute("data-frameType");if(a===this.CONTENT_FRAME&&++e>1)throw t=!0,$break}.bind(this)),t},onlyContentFramesSelected:function(){var e=!0;return this.selectedFrameOverlays.each(function(t){var o=$(t).readAttribute("data-frameType");if(o!=this.CONTENT_FRAME)throw e=!1,$break}.bind(this)),e},singleContentFrameSelected:function(){if(localContext.singleFrameSelected()){var e=localContext.selectedFrameOverlays[0],t=$(e).readAttribute("data-frameType");return t===this.CONTENT_FRAME}return!1},multipleFramesSelected:function(){return localContext.selectedFrameOverlays.length>1},singleFrameSelected:function(){return 1==localContext.selectedFrameOverlays.length},contentFramesSelected:function(){var e=0,t=!1;return this.selectedFrameOverlays.each(function(o){var a=$(o).readAttribute("data-frameType");if(a===this.CONTENT_FRAME&&++e>0)throw t=!0,$break}.bind(this)),t},canEditCustomFrame:function(){if(localContext.singleFrameSelected()){var e=localContext._getLastSelectedOverlayFrame();if(e&&$(e).hasAttribute("data-isCustom")){var t=$(e).readAttribute("data-isCustom");return"true"===t}}return!1},canHideScrollBars:function(){return localContext.singleContentFrameSelected()&&!localContext._checkIfAnySelectedFrameHasOverflowOff()},canShowScrollBars:function(){return localContext.singleContentFrameSelected()&&localContext._checkIfAnySelectedFrameHasOverflowOff()},canHideAllScrollBars:function(){return localContext.multipleContentFramesSelected()&&!localContext._checkIfAnySelectedFrameHasOverflowOff()},canShowAllScrollBars:function(){return localContext.multipleContentFramesSelected()&&localContext._checkIfAnySelectedFrameHasOverflowOff()},canShowRefreshOptions:function(){return localContext.onlyContentFramesSelected()},isScrollBarsPresent:function(e){if($(e)){var t=this._isCustomFrame(e,this._getIFrameNameFromIFrame),o=t?e:getIFrameDocument(document.getElementById(e)).body,a=isWebKitEngine()?"overflow-x":"overflow",r=$(o).getStyle(a);return"scroll"===r}return!1},_isCustomURLNode:function(e){return e&&e.name?e.name===localContext.CUSTOM_URL_LABEL:!1},_isFreeTextNode:function(e){return e&&e.name?e.name===localContext.FREE_TEXT:!1},_isTextLabelNode:function(e){return e&&e.name?e.name===localContext.TEXT_LABEL:!1},_isClickableNode:function(e){return e&&e.param?startsWith(e.param.id,localContext.NODE_CLICKABLE_PREFIX):!1},_isContentFrame:function(e){return e&&e.frameType?e.frameType===localContext.CONTENT_FRAME:!1},_isControlNode:function(e){return e&&e.param?e.param.type===localContext.TREE_NODE_CONTROL_TYPE:void 0},isInFixedSizeMode:function(){return localContext.isFixedSizing},isInProportionalSizeMode:function(){return!localContext.isFixedSizing},_hasSubmitButton:function(){return $("button_submit")},_hasPrintButton:function(){return $("button_print")},_hasResetButton:function(){return $("button_reset")},isNonContentFrameSelected:function(){var e=!1;return localContext.selectedFrameOverlays.each(function(t){if(t){var o=$(t).readAttribute("data-frameType"),a=$(t).readAttribute("data-isCustom");if(o!==this.CONTENT_FRAME||"true"===a)throw e=!0,$break}}.bind(localContext)),e},isCurrentRefreshOption:function(e){var t=!1,o=localContext.selectedFrameOverlays.last();if(o){var a=$(o).readAttribute("data-frameName"),r=$(o).readAttribute("data-frameType");if(r===localContext.CONTENT_FRAME){var n=localContext._getContentFrameByName(a);if(n)return parseFloat(e)===parseFloat(n.autoRefresh)}}return t},canSaveDashboard:function(){var e=!1;return localContext.frameTypes.each(function(t){var o=localContext.framesByType[t];if(o.length>0)throw e=!0,$break}),e},dashboardHasTitle:function(e){return!localContext._isDashboardTitleDeleted(e)},_isIFrameContentLoaded:function(e){var t=this._getIFrameIDFromOverlay(e),o=$(t),a=$(e).hasAttribute("data-iscustom")?$(e).readAttribute("data-iscustom"):!1;if("true"===a){if(o){var r=$(o).readAttribute("data-iframeLoaed");return"complete"==r}return!1}return o?$(o).contentDocument?this._testIfFireFox3_5()?!0:"complete"===$(o).contentDocument.readyState:"complete"===$(o).document.readyState:!1},_testIfFireFox3_5:function(){return navigator.userAgent.toLowerCase().include("firefox/3.5")},_updateIFrameLoadingStatus:function(e,t){var o=null,a=$(e);if(a&&(o=this._getIFrameIDFromOverlay(a),$(o))){$(o).writeAttribute("data-iframeLoaed","complete");var r=($(e).up("DIV"),document.getElementById(o));r&&r.getAttribute("src")&&(0==r.getAttribute("src").indexOf("http")||r.getAttribute("src").indexOf("_flowId=dashboardRuntimeFlow")>0)&&(document.getElementById(o).className=""),this.toggleScrollBarsOnClient(o,t===localContext.SCROLL_ENABLED),this._updateScroll()}},_getNewFrameCoordinates:function(e){var t=null,o=localContext.gridSize;return isMetaHeld(e)&&(o=1),e.keyCode==Event.KEY_LEFT&&(t={left:-o},Event.stop(e)),e.keyCode==Event.KEY_RIGHT&&(t={left:o},Event.stop(e)),e.keyCode==Event.KEY_UP&&(t={top:-o},Event.stop(e)),e.keyCode==Event.KEY_DOWN&&(t={top:o},Event.stop(e)),t},_createMarquee:function(e){var t=e.pointerX(),o=e.pointerY(),a=Builder.node("div",{id:"dragmarquee",className:"dragmarquee",style:"left:"+t+"px; top:"+o+"px"});$(this.DASHBOARD_DOM_ID).appendChild(a)},_deleteMarquee:function(){this.draggingMarquee=!1,$("dragmarquee")&&$("dragmarquee").remove()
},_moveListener:function(e){var t=$("dragmarquee");if(t)if(e.changedTouches&&e.changedTouches.length>1)this._deleteMarquee();else{this.draggingMarquee=!0;var o={x:e.pointerX()-this.marqueeMovePosition.x,y:e.pointerY()-this.marqueeMovePosition.y},a=Math.abs(o.x),r=Math.abs(o.y);t.setStyle(o.x>=0?{width:a+"px"}:{left:e.pointerX()+"px",width:a+"px"}),t.setStyle(o.y>=0?{height:r+"px"}:{top:e.pointerY()+"px",height:r+"px"})}},_caughtByMarquee:function(e){var t=$("dragmarquee"),o=[];if(t){var a=$$("div#dashboardDropZone div.overlay.button"),r=$(this.DROP_ZONE).cumulativeOffset(),n=$(this.DROP_ZONE).cumulativeScrollOffset(),i=$(t).cumulativeOffset(),s=$(t).cumulativeScrollOffset(),l=$(t).getDimensions(),d=parseInt(i[0])-parseInt(r[0])+parseInt(n[0])-parseInt(s[0]),c=parseInt(i[1])-parseInt(r[1])+parseInt(n[1])-parseInt(s[1]),u=parseInt(l.width),h=parseInt(l.height),m=d+(isNaN(u)?0:u),_=c+(isNaN(h)?0:h);a.each(function(e){var t=$(e).readAttribute("data-frametype"),a=$(e).readAttribute("data-frameName"),r=this._getFrameByNameAndType(t,a);if(r){var n=parseInt(r.left),i=parseInt(r.top),s=n+parseInt(r.width),l=i+parseInt(r.height),u=boxesOverlap(d,c,m,_,n,i,s,l);if(u){var h={overlay:e,type:t};o.push(h)}}}.bind(this))}this._batchSelection(o,e)},_batchSelection:function(e,t){var o=null;e.each(function(e){var a=e.type,r=e.overlay;a&&(a.startsWith("content")?o=this.contextLevels.content:a.startsWith("clickable")?o=this.contextLevels.clickable:a.startsWith("text")?o=this.contextLevels.text:a.startsWith("control")&&(o=this.contextLevels.control),this._addFrameToSelection(r,o,t,!0))}.bind(localContext))},_getOtherTreeObject:function(e,t){return t?this.specialContentTree:this.repoTree},_addTreeLeafToSelection:function(e,t){selectionCategory.area=t?designerBase.DASHBOARD_REPO_TREE_AREA:designerBase.DASHBOARD_SPECIAL_CONTENT_TREE_AREA,designerBase.unSelectAll(),designerBase.addToSelected(e)},dashboardSpecificEvents:function(){this.initDashboardTreeEvents(),toolbarButtonModule.initialize(this.toolbarActionMap)},updateMenuPrerequisites:function(e){var t=selObjects.last();t.menuLevel=e},showDynamicMenu:function(e,t,o){this.updateMenuPrerequisites(t),actionModel.showDynamicMenu(t,e,null,o,this.ACTION_MODEL_TAG),document.body.observe(isSupportsTouch()?"touchend":"click",this.dynamicMenuOnClick)},dynamicMenuOnClick:function(e){macOSKeyboardRightClick(e)||(actionModel.hideMenu(),Event.stopObserving(document.body,isSupportsTouch()?"touchend":"click",this.dynamicMenuOnClick))},toggleScrollBarsOnClient:function(e,t){if(e){var o=this._isCustomFrame(e,this._getIFrameNameFromIFrame),a=o?e:getIFrameDocument(document.getElementById(e)).body,r=t?"scroll":"hidden",n=t?"yes":"no",i=isWebKitEngine()?{"overflow-x":r,"overflow-y":r}:{overflow:r};!isIE7()&&jQuery("#"+e).attr("scrolling",n),"function"==typeof $(a).setStyle&&$(a).setStyle(i)}},addContentFrameToSelection:function(e,t){this._addFrameToSelection(e,designerBase.DASHBOARD_CONTENT_FRAME_MENU_LEVEL,t)},addControlFrameToSelection:function(e,t){this._addFrameToSelection(e,designerBase.DASHBOARD_CONTROL_FRAME_MENU_LEVEL,t)},addTextFrameToSelection:function(e,t){this._addFrameToSelection(e,designerBase.DASHBOARD_TEXT_FRAME_MENU_LEVEL,t)},addClickableFrameToSelection:function(e,t){this._addFrameToSelection(e,designerBase.DASHBOARD_CLICKABLE_FRAME_MENU_LEVEL,t)},_addFrameToSelection:function(e,t,o,a){var r=null,n=null,i=null,s=!1,l=!1;if(this._deselectAllTreeNodes(),s=isMetaHeld(o)?!0:a?a:!1,!s){var d=this.isMultiSelect(o,t);d||this.justDragged||(this._deselectAllSelectedDashboardFrames(),this.justDragged=!1)}var c=$(e).up("DIV"),u=designerBase.isObjectInSelection(e,"id");if(u)isMetaHeld(o)&&this._deselectedSelectedDashboardFrames([e]);else if(c){if(i=$(c).identify(),$(c).addClassName("selected"),designerBase.addToSelected(e),this.selectedFrameOverlays.push(e),selectionCategory.area=t,c.match(this.CONTENT_FRAME_PATTERN))r=this.patternToId["this.CONTENT_FRAME_PATTERN"],n=this.CONTENT_FRAME_PATTERN,l=!0;else if(c.match(this.CLICKABLE_FRAME_PATTERN))r=this.patternToId["this.CLICKABLE_FRAME_PATTERN"],n=this.CLICKABLE_FRAME_PATTERN,l=!1;else if(c.match(this.TEXT_FRAME_PATTERN))r=this.patternToId["this.TEXT_FRAME_PATTERN"],n=this.TEXT_FRAME_PATTERN,l=!0;else{if(!c.match(this.CONTROL_FRAME_PATTERN))throw"unknown pattern...";r=this.patternToId["this.CONTROL_FRAME_PATTERN"],n=this.CONTROL_FRAME_PATTERN,l=!0}this.draggableFrame=new Draggable(i,{revert:"failure",onStart:function(){this._setStartCoordinates(n,e)}.bind(this),onDrag:function(){this.moveFrames(r,e)}.bind(this),onEnd:function(){this.notifyServerMoveFrames()}.bind(this)}),l&&layoutModule.createSizer(c)}},_destroyDraggableFrame:function(){this.draggableFrame&&this.draggableFrame.destroy()},_checkIfAnySelectedFrameHasOverflowOff:function(){if(this.selectedFrameOverlays){var e=!1,t=null,o=isWebKitEngine()?"overflow-x":"overflow";this.selectedFrameOverlays.each(function(a){var r=this._isCustomFrame(a,this._getIFrameNameFromOverlay),n=this._getIFrameIDFromOverlay(a);if(n){var i=r?n:getIFrameDocument(document.getElementById(n)).body;if(t=$(i).getStyle(o),"hidden"===t)throw e=!0,$break}}.bind(this))}return e},_getIFrameIDFromOverlay:function(e){return e?$(e).readAttribute("data-iFrameID"):null},_getIFrameNameFromOverlay:function(e){return e?$(e).readAttribute("data-frameName"):null},_getIFrameNameFromIFrame:function(e){return e?$(e).readAttribute("id").substr(localContext.CONTENT_FRAME.length+1):null},_isCustomFrame:function(e,t){var o,a=t(e),r=localContext.contentFrames;return _.isEmpty(r)||(o=_.find(r,function(e){return e.name===a})),o&&o.resourceType===localContext.CUSTOM_RESOURCE_TYPE},_getIFrameFromContainer:function(e){return e?$(e).down("IFRAME"):null},_getIFrameByName:function(e){var t=this.CONTENT_FRAME+"_"+e;return $(t)},_getLastSelectedOverlayFrame:function(){return this.selectedFrameOverlays.last()},_getContentFrameByName:function(e){for(var t=localContext.contentFrames.length,o=0;t>o;o++)if(localContext.contentFrames[o].name===e)return localContext.contentFrames[o];return null},_getFrameByNameAndType:function(e,t){var o=null,a=localContext.framesByType[e];return a&&a.each(function(e){if(e.name===t)throw o=e,$break}),o},_getFrameContainerByName:function(e,t){var o=e+localContext.CONTAINER_ID_STUB+"_"+t;return $(o)},_removeFromSelectionObjects:function(e){selObjects=selObjects.without(e)},_deselectAllSelectedDashboardFrames:function(){this.selectedFrameOverlays.each(function(e){if(e){var t=$(e).up("DIV");t&&($(t).removeClassName("selected"),Draggables.drags.each(function(e){e.element==t&&e.destroy()}.bind(this)))}}.bind(this)),this.selectedFrameOverlays.clear(),designerBase.unSelectAll(),this._revertFrameInEditMode()},deSelectAllPressedNavMuttons:function(){var e=$$("UL#navigationOptions li");e&&e.each(function(e){buttonManager.out($(e),function(e){return $(e).down(layoutModule.LIST_ITEM_WRAP_PATTERN)})})},_revertFrameInEditMode:function(){if(this.currentEditingTextFrame){var e=$(this.currentEditingTextFrame).down(".overlay");if(e){var t=$(e).readAttribute("data-frameName"),o=this._getFrameByNameAndType(localContext.TEXT_FRAME,t),a=$(this.currentEditingTextFrame).down(".read"),r=$(this.currentEditingTextFrame).down("INPUT.edit");if(a&&r){var n=$(r).value.escapeHTML();$(a).update(n);var i=$(this.currentEditingTextFrame).getStyle("fontSize"),s=this._getTextFrameMinimumWidthByLabel(o,n,i);$(this.currentEditingTextFrame).setStyle({width:s+"px"}),$(this.currentEditingTextFrame).removeClassName("editMode"),this.notifyServerUpdateText(t,n,s)}}}this.currentEditingTextFrame=null},_deselectedSelectedDashboardFrames:function(e){var t=null;e.each(function(e){this.selectedFrameOverlays.each(function(o){if($(o).readAttribute("data-frameName")===$(e).readAttribute("data-frameName")){var a=$(o).up("DIV");throw a&&($(a).removeClassName("selected"),Draggables.drags.each(function(e){e.element==a&&e.destroy()}.bind(this))),t=o,$break}}.bind(this)),this.selectedFrameOverlays=this.selectedFrameOverlays.without(t),designerBase.unSelectGiven(t)}.bind(this))},_selectAllDashboardFrameObjects:function(e){localContext.frameTypes.each(function(t){var o=localContext.framesByType[t];o.each(function(o){var a=this._getFrameContainerByName(t,o.name);if(a){var r=$(a).down("DIV.overlay");r&&(t===this.CONTROL_FRAME?this.addControlFrameToSelection(r,e):t==this.CONTENT_FRAME?this.addContentFrameToSelection(r,e):t==this.TEXT_FRAME?this.addTextFrameToSelection(r,e):t==this.CLICKABLE_FRAME&&this.addClickableFrameToSelection(r,e))}}.bind(this))}.bind(this))},_deselectAllTreeNodes:function(){this.repoTree._deselectAllNodes(),this.specialContentTree._deselectAllNodes()},_setSourceForFrame:function(){var e=this._getCurrentReportType();this.nextFrameSrc="/flow.html?_flowId="+this.typeToView[e]},_incrementUnansweredAddRequests:function(){this.unansweredAddRequests++},_decrementUnansweredAddRequests:function(){this.unansweredAddRequests--},_getCurrentReportPath:function(){var e=designerBase.getSelectedObject();return e&&e.param?e.param.uri:null},_getCurrentReportType:function(){var e=designerBase.getSelectedObject();return e&&e.param?e.param.type:null},_getCurrentReportName:function(){var e=designerBase.getSelectedObject();return e?e.name:null},_getContainerPrefix:function(e){return this.patternToId[e]},_setStartCoordinates:function(e,t){var o=null;if(o=t?t:this._getLastSelectedOverlayFrame()){var a=$(o).up(e);if(a){var r=a.offsetLeft,n=a.offsetTop;this.dragStartCoordinates={left:r,top:n}}}},moveFrames:function(e,t){var o=null;if(o=t?t:this._getLastSelectedOverlayFrame())for(var a=$(o).readAttribute("data-frameName"),r=this._calculateDragDelta(e,a),n=this.selectedFrameOverlays.length,i=0;n>i;i++){var s=this.selectedFrameOverlays[i].readAttribute("data-frameName");if(s!==a){var l=e+s,d=this.selectedFrameOverlays[i].up("DIV");d&&(l=$(d).identify(),this._moveFrame(l,r))}}this.justDragged=!0},_moveFrame:function(e,t){if($(e)){var o=$(e).offsetLeft,a=$(e).offsetTop;$(e).setStyle({left:o-t.deltaLeft+"px",top:a-t.deltaTop+"px"})}},_moveFramesByKeys:function(e){this.selectedFrameOverlays.length>0&&this.selectedFrameOverlays.each(function(t){var o=$(t).up("DIV");if(o&&e)if(e.left){var a=$(o).offsetLeft,r=this._getValidCoord(e.left,a);$(o).setStyle({left:r+"px"})}else if(e.top){var n=$(o).offsetTop,i=this._getValidCoord(e.top,n);$(o).setStyle({top:i+"px"})}}.bind(this))},_getValidCoord:function(e,t){var o=e+t;return 0>o?0:o},_calculateDragDelta:function(e,t){var o={deltaLeft:0,deltaTop:0},a=e+t;if($(a)){var r=$(a).offsetLeft,n=$(a).offsetTop,i=this.dragStartCoordinates.left-r,s=this.dragStartCoordinates.top-n;o={deltaLeft:i,deltaTop:s},this.dragStartCoordinates={left:r,top:n}}return o},_getNewFramePositions:function(){var e=[];return this.selectedFrameOverlays.each(function(t){if(t){var o=$(t).readAttribute("data-frameName"),a=$(t).up("DIV");if(a){var r=$(a).offsetLeft,n=$(a).offsetTop,i={frameName:o,frameLeft:r,frameTop:n};e.push(i)}}}),e},_getNewFrameProperties:function(){var e=[];return this.selectedFrameOverlays.each(function(t){if(t){var o=$(t).readAttribute("data-frameName"),a=$(t).up("DIV");if(a){var r=$(a).offsetWidth,n=$(a).offsetHeight,i={frameName:o,frameWidth:r,frameHeight:n,frameFontSize:-1};e.push(i)}}}),e},_getAllSelectedControlFrames:function(){var e=[];return this.selectedFrameOverlays.each(function(t){if(t){var o=$(t).readAttribute("data-frameName"),a=$(t).readAttribute("data-frameType");if(a===this.CONTROL_FRAME){var r=$(t).up("DIV");if(r){var n=parseInt(jQuery(r).css("width"),10),i=$(r).offsetHeight,s={frameName:o,frameWidth:n,frameHeight:i,frameFontSize:-1};e.push(s)}}}}.bind(this)),e},_getAllSelectedContentFrames:function(){var e=[];return this.selectedFrameOverlays.each(function(t){if(t){var o=$(t).readAttribute("data-frameName"),a=$(t).readAttribute("data-frameType");if(a===this.CONTENT_FRAME){var r=$(t).up("DIV");if(r){var n=$(r).offsetWidth,i=$(r).offsetHeight,s={frameName:o,frameWidth:n,frameHeight:i,frameFontSize:-1};e.push(s)}}}}.bind(this)),e},_getAllResizeableFrame:function(){var e=[];return localContext.frameTypes.each(function(t){var o=localContext.framesByType[t];o.each(function(o){if(o.resizeable&&t!==localContext.CONTROL_FRAME){var a=this._getFrameContainerByName(t,o.name);if(a){var r=a.offsetWidth,n=a.offsetHeight,i=null;i=t==localContext.TEXT_FRAME?parseInt(a.getStyle("fontSize")):-1;var s={frameName:o.name,frameWidth:r,frameHeight:n,frameFontSize:-1};e.push(s)}}}.bind(this))}.bind(this)),e},_showCustomURLPrompt:function(e){if($(this.CUSTOM_URL_DOM_ID)){var t=null,o=null;if(this.customURLDialog.isEditMode=e,this.customURLDialog.isVisible=!0,e){var a=this._getLastSelectedOverlayFrame();a&&(t=$(a).readAttribute("data-frameName"),t&&(o=this._getContentFrameByName(t),$(this.CUSTOM_URL_INPUT_DOM_ID).value=o.source))}else{var r=localContext.currentCustomFrame.down("div.overlay");t=$(r).readAttribute("data-frameName"),o=this._getContentFrameByName(o),$(this.CUSTOM_URL_INPUT_DOM_ID).value=""}this._prepareCustomURLPromptControls(o),dialogs.popup.show($(this.CUSTOM_URL_DOM_ID),!0),$(this.CUSTOM_URL_INPUT_DOM_ID).focus()}},_hideCustomURLPrompt:function(){$(this.CUSTOM_URL_DOM_ID)&&(dialogs.popup.hide($(this.CUSTOM_URL_DOM_ID)),this.customURLDialog.isVisible=!1,$(this.CUSTOM_URL_DOM_ID).addClassName(this.CUSTOM_URL_NO_PARAMS_CLS),this._removeCustomURLPromptControls())},_cancelCustomURLPrompt:function(){!this.currentCustomFrame||$(this.currentCustomFrame).hasClassName("hidden")||this.customURLDialog.isEditMode||$(this.currentCustomFrame).remove(),this._hideCustomURLPrompt()},_prepareCustomURLPromptControls:function(e){if(localContext.controlFrames.length>0){var t=$$(this.CUSTOM_URL_INPUTCONTROLS_PATTERN)[0],o=$("inputControls_option_list").cloneNode(!1),a=$("inputControls_option_list:header").cloneNode(!0);$(o).appendChild(a),localContext.controlFrames.each(function(t,a){var r=t.paramName,n=$("inputControls_option_list:control").cloneNode(!0);$(n).writeAttribute("id",$(n).identify()+a);var i=$(n).down(".one .checkBox"),s=$(n).down(".one #label_for_param_1"),l=$(n).down(".one #parameter_1");$(i).writeAttribute("for",localContext.PARAM_MAPPER_CHECKBOX_PREFIX+r),$(s).update(t.label),$(l).writeAttribute("id",localContext.PARAM_MAPPER_CHECKBOX_PREFIX+r),l.checked=e?e[r]:"";var d=$(n).down(".two #label_for_param_1_value"),c=$(n).down(".two #parameter_1_value");$(d).writeAttribute("for",localContext.PARAM_MAPPER_INPUT_PREFIX+r),$(c).writeAttribute("id",localContext.PARAM_MAPPER_INPUT_PREFIX+r),c.value=l.checked?this._getParameterMappingValue(e,r):r,$(o).appendChild(n)}.bind(this)),localContext.controlFrames.length>0&&$(this.CUSTOM_URL_DOM_ID).removeClassName(this.CUSTOM_URL_NO_PARAMS_CLS),$(t).appendChild(o)}},_getParameterMappingValue:function(e,t){return e&&e[t]?e[t]:t},_removeCustomURLPromptControls:function(){if(localContext.controlFrames.length>0){var e=$$(this.CUSTOM_URL_INPUTCONTROLS_PATTERN)[0];e&&e.childElements().each(function(e){$(e).remove()})}},_processCustomURLPromptInput:function(){var e=[],t=$(this.CUSTOM_URL_INPUT_DOM_ID).value;if(!t&&t.blank())return void this._hideCustomURLPrompt();var o=this._getIFrameFromContainer(this.currentCustomFrame);if(o){var a=/[A-Za-z]+_\d+$/,r=o.identify(),n=a.exec(r)[0];if(this.loadIframe(o,checkURLProtocol(t,!0),!0),localContext.controlFrames.each(function(t){var o=t.paramName,a=$(this.PARAM_MAPPER_CHECKBOX_PREFIX+o);if(a.checked){var r=$(this.PARAM_MAPPER_INPUT_PREFIX+o);if(r){var n=o+"@@"+r.value;e.push(n)}}}.bind(this)),this._hideCustomURLPrompt(),o){var i=$(o).up("DIV");i&&$(i).writeAttribute("title",o.src)}this.notifyServerUpdateCustomContentFrame(n,o.src,e)}},_getClickableFrameId:function(e){return e&&e.param?e.param.extra:null},_reSyncFramesIfRequired:function(){localContext.resyncRequired&&this._reSyncFrames(!localContext.isFixedSizing)},_reSyncFramesIfProportionalSizingActive:function(){localContext.isFixedSizing||this._reSyncFrames(!0)},_reSyncFrames:function(e){var t=5,o=[];localContext.frameTypes.each(function(a){var r=localContext.framesByType[a];r&&r.each(function(r){var n=this._getFrameContainerByName(a,r.name),i=parseInt(r.left),s=parseInt(r.top);if(a===localContext.CONTENT_FRAME&&(s+=t),n&&(moveTo(n,i,s,null),e&&($(n).setStyle({width:parseInt(r.width)+"px",height:parseInt(r.height)+"px"}),r.fontResizes||!r.resizable))){var l={frameName:r.name,frameWidth:parseInt(r.width),frameHeight:parseInt(r.height)};l.frameFontSize=a===localContext.TEXT_FRAME?this._getFontSizeForTextFrame(a,l.frameName,l.frameWidth,l.frameHeight):-1,o.push(l)}}.bind(localContext))}.bind(localContext)),this.notifyServerResizeFrames(!0,o)},_updateNewControlFrameWidth:function(e){var t=[],o=localContext.controlFrames.last(),a=this._getFrameContainerByName(localContext.CONTROL_FRAME,o.name);if(o&&a){var r={frameName:o.name,frameWidth:a.clientWidth,frameHeight:o.height,frameFontSize:-1};t.push(r),this.notifyServerResizeFrames(!1,t,!1,e)}else e&&e()},_setNewTextFrameMinimumWidth:function(){var e=[],t=localContext.textFrames.last();if(t){var o={frameName:t.name,frameHeight:t.height,frameFontSize:t.fontSize,frameWidth:this._getTextFrameMinimumWidth(t)};e.push(o),this.notifyServerResizeFrames(!0,e)}},_getTextFrameMinimumWidth:function(e){if(this.fontSizeTester){$(this.fontSizeTester).setStyle({fontSize:e.fontSize+"px"});var t=e.textLabel;return t=this._replaceAllSpaces(t,"&nbsp;"),$(this.fontSizeTester).update(t),this.fontSizeTester.offsetWidth+this.hackPadding}throw"font size tester is not available!!!"},_getTextFrameMinimumWidthByLabel:function(e,t,o){if(this.fontSizeTester)return $(this.fontSizeTester).setStyle(o?{fontSize:o}:{fontSize:e.fontSize+"px"}),t=this._replaceAllSpaces(t,"&nbsp;"),$(this.fontSizeTester).update(t),this.fontSizeTester.offsetWidth+this.hackPadding;throw"font size tester is not available!!!"},_getFontSizeForTextFrame:function(e,t,o,a){var r=this._getFrameByNameAndType(e,t),n=r.fontSize;if(!this.fontSizeTester)throw"font size tester is not available!!!";if(r&&r.fontResizes){var i=r.textLabel;$(this.fontSizeTester).setStyle({fontSize:n+"px"}),i=this._replaceAllSpaces(i,"&nbsp;"),$(this.fontSizeTester).update(i);var s=this.fontSizeTester.offsetWidth+this.hackPadding,l=this.fontSizeTester.offsetHeight;if(s>o||l>a)for(;this.fontSizeTester.offsetWidth>o||this.fontSizeTester.offsetHeight>a;)$(this.fontSizeTester).setStyle({fontSize:n--+"px"});else for(;this.fontSizeTester.offsetWidth<o&&this.fontSizeTester.offsetHeight<a;)$(this.fontSizeTester).setStyle({fontSize:n++ +"px"})}return this.isInFixedSizeMode()||(n=Math.min(r.maxFontSize,n)),n},_resetFontSizeTester:function(){$(this.fontSizeTester).writeAttribute("style","")},_adjustFontForSelectedTextFrames:function(){var e=[];return this.selectedFrameOverlays.each(function(t){var o=t.readAttribute("data-frameName"),a=t.readAttribute("data-frametype");if(a==this.TEXT_FRAME){var r=t.up("DIV");if(r){var n={frameName:o,frameHeight:parseInt($(r).getHeight()),frameWidth:parseInt($(r).getWidth())};n.frameFontSize=this._getFontSizeForTextFrame(localContext.TEXT_FRAME,n.frameName,n.frameWidth,n.frameHeight),e.push(n)}}}.bind(this)),e.length>0?e:null},_clickableControlAlreadyAdded:function(){dialogs.systemConfirm.show(localContext.messages.buttonAlreadyAdded,5e3)},_inputControlAlreadyAdded:function(){dialogs.systemConfirm.show("Control already added!",5e3)},_invalidCustomURLError:function(){dialogs.systemConfirm.show("Please provide a valid URL!",5e3)},_formatParamValue:function(e,t){var o="";if(t)for(var a=e+"=",r=0;r<t.length;r++)o+=a+encodeURIComponent(t[r]),r<t.length-1&&(o+="&");return o},_replaceAllSpaces:function(e,t){var o=/\s+/g;return e.replace(o,t)},singleOverlaySelected:function(){return 1==localContext.selectedFrameOverlays.length},setTextFrameAsEditable:function(){if(localContext.singleOverlaySelected()){var e=localContext.selectedFrameOverlays[0],t=$(e).up("DIV");t&&$(t).hasClassName("displayText")&&!$(t).hasClassName("editMode")&&(localContext._deselectAllSelectedDashboardFrames(),localContext.currentEditingTextFrame=$(t),localContext.currentEditingTextFrame.addClassName("editMode"),$(t).down("input.edit").select(),setTimeout(function(){$(t).down("input.edit").focus()},500))}},removeDashboardTitle:function(){var e=$("title");e&&($(e).update(localContext.NO_DASHBOARD_TITLE_TEXT),localContext.notifyServerDeleteTitle())},editDashboardTitle:function(){var e=$("title");if(!e)throw"no title object!!";localContext.titleEditing=!0,localContext._deselectAllSelectedDashboardFrames(),editor=new InPlaceEditor(e),editor.makeEditable({onMouseup:localContext._revertDashboardTitleFromEditMode,onEnter:localContext._revertDashboardTitleFromEditMode,onTab:localContext._revertDashboardTitleFromEditMode,onEsc:localContext._revertToBackHeaderTitle})},_revertDashboardTitleFromEditMode:function(e){e=e?e:window.event,e.keyCode==Event.KEY_ESC?localContext._revertToBackHeaderTitle():editor&&(editor.makeNonEditable(localContext.titleEditing),editor=null,localContext.notifyServerUpdateTitle()),localContext.titleEditing=!1},_revertToBackHeaderTitle:function(){editor&&(editor.revertEdit(),editor=null),localContext.titleEditing=!1},_updateTitleClass:function(e){var t=$("title");t&&(e?$("title").removeClassName(this.DELETED_TITLE_CSS):($("title").addClassName(this.DELETED_TITLE_CSS),$("title").update(localContext.NO_DASHBOARD_TITLE_TEXT)))},_isDashboardTitleDeleted:function(e){var t=$("title"),o=$("titleInput");return editor&&o?"true"!=e:t?getInnerText(t).blank()||getInnerText(t)===localContext.NO_DASHBOARD_TITLE_TEXT:!0},_purgeDeletedInputControlTextFrames:function(){var e=[];localContext.textFrames.each(function(t){var o=t.inputControlRef;if("null"!=o){var a=!1;this.controlTypes.each(function(e){if(localContext.controls[e].each(function(e){if(e.name===o)throw a=!0,$break}.bind(this)),a)throw $break}.bind(this)),a||e.push(t.name)}}.bind(this)),e.each(function(e){var t=$("textFrameContainer_"+e);t&&$(t).remove()}.bind(this)),e.length>0&&this.notifyServerDeleteFrames(e)},_controlFrameAlreadyAdded:function(e){return _.find(localContext.controlFrames,function(t){return t.paramName===e})},_setLastControlClicked:function(){var e=localContext.controlFrames.last();if(e){var t=this._getFrameContainerByName(localContext.CONTROL_FRAME,e.name);if(t){var o=$(t).down(".overlay");o&&(controlClicked=$(o).readAttribute("data-inputControlName"),controlClickedControlType=$(o).readAttribute("data-controlType"))}}},_updateAllSelectedControlFrameCoordinates:function(){var e=this._getAllSelectedControlFrames();e.length>0&&this.notifyServerResizeFrames(!0,e)},_updateAllSelectedContentFrameCoordinates:function(){var e=this._getAllSelectedContentFrames();e.length>0&&this.notifyServerResizeFrames(!1,e)},checkScreenSize:function(e,t){return screen.width<e||screen.height<t},_changeScreenSizeForFixedMode:function(){$("sizeGuide").removeClassName("proportional"),$("sizeGuide").setStyle({width:localContext.layoutWidth+"px",height:localContext.layoutHeight+"px"}),this._updateScroll(),$("guideLabel").update(localContext.layoutWidth+" x "+localContext.layoutHeight)},_changeScreenSizeForProportionalMode:function(){$("sizeGuide").writeAttribute("style",""),$("sizeGuide").addClassName("proportional"),$("guideLabel").update()},_calculateSizeConversionFactor:function(){var e=null,t=null,o=null,a=null,r=null,n=null,i=null,s=20;return localContext.rightCoordinates.clear(),localContext.bottomCoordinates.clear(),localContext.frameTypes.each(function(e){var t=localContext.framesByType[e];this._getRightAndBottomCords(t)}.bind(this)),e=Math.max.apply(null,localContext.rightCoordinates),t=Math.max.apply(null,localContext.bottomCoordinates),o=parseInt($("dashboardDropZone").getStyle("width"))-s,a=parseInt($("dashboardDropZone").getStyle("height"))-s,r=o/e,n=a/t,i=Math.min(r,n),this.notifyServerUpdateSizeConversionFactor(i),i},_calculateGrowthFactorForProportionalRuntime:function(){var e=null,t=null,o=null,a=$("dashboardCanvasArea").getDimensions();return t=a.width,o=a.height,e=t+"_"+o},_getRightAndBottomCords:function(e){e.each(function(e){var t=e.left+e.width,o=e.top+e.height;localContext.rightCoordinates.push(t),localContext.bottomCoordinates.push(o)}.bind(this))},requestSizeGuideChange:function(e){if(e){var t=localContext.regexForBeginningNums.exec(e)[0],o=localContext.regexForEndingNums.exec(e)[0],a=!0;localContext.checkScreenSize(t,o)&&(a=confirm(localContext.RESOLUTION_MESSAGE)),a&&localContext.notifyServerSetLayoutSize(e)}},_checkIfClickableControlAlreadyExists:function(e){var t=!1;return localContext.clickableControlIDs.each(function(o){if(o===e)throw t=!0,$break}),t},checkLayoutSize:function(e){return e==localContext.layoutSize},undo:function(){alert("not implemented")},redo:function(){alert("not implemented")},quickAddOfFrameObject:function(e,t){t&&(this._isCustomURLNode(t)?this.addCustomURLFrame():this._isTextLabelNode(t)?this.addTextLabelFrame():this._isFreeTextNode(t)?this.addFreeTextLabelFrame():this._isClickableNode(t)?this.addClickableFrame(t):this._isControlNode(t)?this.addControlFrame(t):this.addContentFrame(e))},quickAddOfFrameObjectByEvent:function(e){if(localContext.specialContentTree){var t=localContext.specialContentTree.getTreeNodeByEvent(e);localContext.quickAddOfFrameObject(e,t)}},dragNDropOfFrameObject:function(e,t,o){if(localContext.specialContentTree&&localContext.repoTree){var a=null,r=localContext.specialContentTree.selectedNodes.length;1==r?(a=localContext.specialContentTree.selectedNodes[0],localContext._updateDragNDropCoordinates(o),localContext.quickAddOfFrameObject(o,a),localContext.specialContentTree._deselectAllNodes()):(r=localContext.repoTree.selectedNodes.length,1==r&&(a=localContext.repoTree.selectedNodes[0],localContext._updateDragNDropCoordinates(o),localContext.quickAddOfFrameObject(o,a)))}},_updateDragNDropCoordinates:function(e){var t=$(this.DROP_ZONE).cumulativeOffset(),o=$(this.DROP_ZONE).cumulativeScrollOffset(),a=e.changedTouches?e.changedTouches[0]:void 0,r=a?a.pageX:e.pointerX(),n=a?a.pageY:e.pointerY();localContext.nextControlFrameLeft=r-t[0]+o[0],localContext.nextControlFrameTop=n-t[1]+o[1],localContext.nextContentFrameLeft=r-t[0]+o[0],localContext.nextContentFrameTop=n-t[1]+o[1]},addContentFrame:function(e){var t=localContext._getCurrentReportType(),o=localContext._getCurrentReportPath(),a=localContext._getCurrentReportName();if(null!=t&&null!=o&&null!=a){if(localContext.unansweredAddRequests>0)return;if(localContext._setSourceForFrame(),this.shouldReplace&&this.replacingFrameName){var r=localContext._getCurrentReportPath(),n=this._getIFrameByName(this.replacingFrameName);if(n){this.loadIframe(n,urlContext+localContext.nextFrameSrc+r,t===this.CUSTOM_RESOURCE_TYPE);var i=n.up("DIV");i&&$(i).writeAttribute("title",r),localContext.notifyServerReplaceFrame(this.replacingFrameName)}}else{localContext._createDomForFrame(!1);var s={left:localContext.nextContentFrameLeft,top:localContext.nextContentFrameTop,width:localContext.nextContentFrameWidth,height:localContext.nextContentFrameHeight};localContext.notifyServerAddContentFrame(s,e)}}},addControlFrame:function(e){if(e&&e.param){var t=e.param.extra;t&&(this._controlFrameAlreadyAdded(t)?this._inputControlAlreadyAdded():this.notifyServerAddControlFrame(t))}},addCustomURLFrame:function(){localContext.unansweredAddRequests>0||(localContext.currentCustomFrame=localContext._createDomForFrame(!0),localContext._showCustomURLPrompt(!1))},addClickableFrame:function(e){var t=this._getClickableFrameId(e);t&&(this._checkIfClickableControlAlreadyExists(t)?this._clickableControlAlreadyAdded():this.notifyServerAddClickableFrame(t))},addTextLabelFrame:function(){this.notifyServerAddTextLabelFrame()},addFreeTextLabelFrame:function(){this.notifyServerAddFreeTextLabelFrame()},editCustomURLFrame:function(){var e=localContext._getLastSelectedOverlayFrame();if(e){var t=$(e).readAttribute("data-frameName"),o=$(e).readAttribute("data-frameType"),a=$(e).readAttribute("data-isCustom");if(o===localContext.CONTENT_FRAME&&a){{$(e).readAttribute("data-iFrameID")}localContext.currentCustomFrame=$("contentFrameContainer_"+t),localContext.currentCustomFrame&&localContext._showCustomURLPrompt(!0)}}},_createDomForFrame:function(e){var t=$(localContext.CONTENT_FRAME_DOM_ID).cloneNode(!0);$(t).writeAttribute("id",localContext.CONTENT_FRAME+localContext.CONTAINER_ID_STUB+"_"+localContext.nextContentFrameName),$(t).setStyle({left:localContext.nextContentFrameLeft+"px",top:localContext.nextContentFrameTop+"px",width:localContext.nextContentFrameWidth+"px",height:localContext.nextContentFrameHeight+"px"});var o=t.down("IFRAME"),a=localContext.CONTENT_FRAME+"_"+localContext.nextContentFrameName;$(o).writeAttribute("id",a);var r=localContext.OVERLAY_PREFIX+localContext.nextContentFrameName;return $(o).observe("load",function(){localContext._updateIFrameLoadingStatus(r,localContext.SCROLL_ENABLED)}),e||(this.loadIframe(o,urlContext+localContext.nextFrameSrc+localContext._getCurrentReportPath()+"&fid="+a,!1),$(t).writeAttribute("title",localContext._getCurrentReportPath())),e&&$(t).addClassName("hidden"),$(localContext.ALL_CONTENT_PARENT_DOM_ID).appendChild(t),localContext.updateAttributesForContentFrameOverlay(t,e),t},updateAttributesForContentFrameOverlay:function(e,t){if(e&&"contentFrameTemplate"!==$(e).identify()){var o=/[A-Za-z]+_\d+$/,a=o.exec($(e).identify())[0],r=$(e).down("DIV.overlay.button");$(r)&&($(r).writeAttribute("id",localContext.OVERLAY_PREFIX+a),$(r).writeAttribute("data-frameType",localContext.CONTENT_FRAME),$(r).writeAttribute("data-frameName",a),$(r).writeAttribute("data-iFrameID",localContext.CONTENT_FRAME+"_"+a),$(r).writeAttribute("data-isCustom",t.toString()))}},_deleteFrameOverlayFromDOM:function(e){if(!e)return!1;var t=$(e).up("DIV");return $(t)?($(t).remove(),!0):!1},deleteSelectedFrames:function(){var e=[];localContext.selectedFrameOverlays.each(function(t){if(t){var o=$(t).readAttribute("data-frameName");localContext._deleteFrameOverlayFromDOM(t)&&e.push(o)}}),e.length>0&&localContext.notifyServerDeleteFrames(e)},toggleSelectedFrameScrollBars:function(){var e=localContext._getLastSelectedOverlayFrame();if(e){var t=$(e).readAttribute("data-frameType"),o=$(e).readAttribute("data-frameName");if(t===localContext.CONTENT_FRAME){var a=localContext._getIFrameIDFromOverlay(e),r=localContext.isScrollBarsPresent(a);localContext.toggleScrollBarsOnClient(a,!r),localContext.notifyServerToggleContentFrameScrollBars(o)}}},toggleAllSelectedFrameScrollBars:function(e){var t=[];e="true"===e,localContext.selectedFrameOverlays.each(function(o){var a=$(o).readAttribute("data-frameType"),r=$(o).readAttribute("data-frameName");if(a===localContext.CONTENT_FRAME){var n=localContext._getIFrameIDFromOverlay(o);t.push(r),localContext.toggleScrollBarsOnClient(n,e)}}),t.length>0&&localContext.notifyServerToggleAllContentFramesScrollBars(t,e)},refreshIFrame:function(){var e=!1,t=localContext._getLastSelectedOverlayFrame(),o=localContext._getIFrameIDFromOverlay(t),a=$(t).readAttribute("data-isCustom");if(e="false"===a,o&&e)try{$(o).contentWindow.location.reload(!0)}catch(r){throw"unable to refresh iframe"}},updateInputControlParams:function(e){e&&this._hasSubmitButton()||(e||(e=this.controlsController.get("selection")),this.notifyServerUpdateControlValues(e))},sizeSelectedFrameToContent:function(){var e=[],t=2;localContext.selectedFrameOverlays.each(function(o){if(o){var a=null,r=null,n=$(o).readAttribute("data-frameName"),i=$(o).readAttribute("data-frameType"),s=$(o).readAttribute("data-isCustom");if(i===this.CONTENT_FRAME&&"false"===s){var l=$(o).up("DIV");if(l){var d=this._getIFrameFromContainer(l),c=this._getContentFrameByName(n);try{c?c.reportWidth>0?(a=c.reportWidth+t,r=c.reportHeight+t):(a=localContext.layoutWidth,r=localContext.layoutHeight):d.contentDocument?(a=d.contentDocument.body.scrollWidth,r=d.contentDocument.body.scrollHeight):(a=d.Document.body.scrollWidth,r=d.Document.body.scrollHeight);var u={frameName:n,frameWidth:a,frameHeight:r,frameFontSize:-1};$(l).setStyle({width:a+"px",height:r+"px"}),e.push(u)
}catch(h){throw"[sizeSelectedFrameToContent]: possible crosssite scripting"}}}}}.bind(localContext)),e.length>0&&localContext.notifyServerResizeFrames(!1,e,!0)},resetInputControlParams:function(){var e=this.controlsController.reset();e.done(function(){var e=this.controlsController.get("selection");this.notifyServerUpdateControlValues(e)}.bind(this))},saveDashboard:function(e,t,o,a){return this.notifyServerSaveDashboard(e,t,o,a)},printDashboard:function(){dialogs.systemConfirm.show(this.messages.dashboardOptionMessage,5e3)},runDashboard:function(){buttonManager.isDisabled($("presentation"))||(buttonManager.disable($("presentation")),window.setTimeout(function(){buttonManager.enable($("presentation"))},5e3),this.requestServerToRunDashboard())},setAutoRefresh:function(e){var t=[],o=localContext._getAllSelectedContentFrames();o.each(function(o){var a={name:o.frameName,interval:e};t.push(a)}),localContext.notifyServerSetAutoRefresh(t)},requestServerToRunDashboard:function(){localContext.allowPreview=isIPad();var e=this.getPreviewUrl(),t=function(){if(this._updateState(),isIPad()){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,1,1,1,1,1,!1,!1,!1,!1,0,null),$("presentation").up().dispatchEvent(t)}else{var o=window.open(e,"");if(o&&o.focus)return o.focus(),!1}}.bind(localContext);designerBase.sendRequest("da_saveTempDashboard",[],t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},getPreviewUrl:function(){return this.RUN_URL_PREFIX+clientKey},notifyServerSetLayoutSize:function(e){var t=function(){this._updateState(),this._changeScreenSizeForFixedMode()}.bind(localContext);designerBase.sendRequest("da_setLayoutSize",new Array("size="+e),t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerAddContentFrame:function(e,t){this._incrementUnansweredAddRequests();var o=localContext.nextContentFrameName,a="containerOverlay_"+o,r=Object.clone(t),n=function(){localContext._updateState(),localContext._updateAllIFramesSRCParam(o),localContext._reSyncFramesIfRequired(),localContext._updateInputControlsNodes(),localContext.shouldReplace=!1,localContext.replacingFrameName=null,localContext.addContentFrameToSelection($(a),r),localContext.controlsController.draw(),localContext._decrementUnansweredAddRequests(),localContext._updateScroll()},i=function(e){if(!(e.response&&e.response.indexOf(localContext.SESSION_ATTRIBUTE_MISSING_EXCEPTION)>-1)){localContext._decrementUnansweredAddRequests();var t=function(){localContext._deleteFrameOverlayFromDOM($(a))&&localContext.notifyServerDeleteFrames([o])};setTimeout(t,0)}},s=this._getCurrentReportType(),l=this._getCurrentReportPath(),d=this._getCurrentReportName();designerBase.sendRequest("da_addContentFrame",new Array("type="+encodeText(s),"resourceName="+encodeText(d),"src="+encodeText(localContext.nextFrameSrc),"uri="+encodeText(l),"left="+e.left,"top="+e.top,"width="+e.width,"height="+e.height),n,{target:"dashboardControlsPlaceHolder",hideLoader:!0,mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE},i)},notifyServerReplaceFrame:function(e){var t=function(){this._updateState(),this._updateInputControlsNodes(),this.shouldReplace=!1,this.replacingFrameName=null,this.controlsController.draw()}.bind(localContext);designerBase.sendRequest("da_replaceFrame",new Array("uri="+encodeText(localContext._getCurrentReportPath()),"name="+encodeText(e)),t,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerAddControlFrame:function(e){this._incrementUnansweredAddRequests();var t=function(){this._updateState(),this.controlsController.draw();var e=[this._getControlInformation(_.last(localContext.controlFrames))],t=_.bind(function(){this._updateNewControlFrameWidth(_.bind(this._setNewTextFrameMinimumWidth,this)),this._reSyncFramesIfRequired(),this._decrementUnansweredAddRequests(),this._setLastControlClicked()},this);e&&0!=e.length?this.controlsController.addControls(e).always(t):t&&t()}.bind(localContext);designerBase.sendRequest("da_addControlFrame",new Array("name="+e,"left="+localContext.nextControlFrameLeft,"top="+localContext.nextControlFrameTop,"width=0","height="+localContext.nextControlFrameHeight),t,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerUpdateCustomContentFrame:function(e,t,o){this._incrementUnansweredAddRequests();var a="",r=o.length;o.each(function(e,t){a+=e,r-1>t&&(a+="**")});var n=function(){this._updateState(),this._reSyncFramesIfRequired(),a.length>0&&this._updateAllIFramesSRCParam(e),this._decrementUnansweredAddRequests(),this.controlsController.draw()}.bind(localContext);designerBase.sendRequest("da_updateCustomContentFrame",new Array("frameName="+e,"src="+encodeText(t),"paramMappingsString="+encodeText(a),"left="+this.currentCustomFrame.offsetLeft,"top="+this.currentCustomFrame.offsetTop,"width="+this.currentCustomFrame.offsetWidth,"height="+this.currentCustomFrame.offsetHeight),n,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerDeleteFrames:function(e){this._incrementUnansweredAddRequests();var t=e.join("**"),o=function(){this._updateState(),this._purgeDeletedInputControlTextFrames(),this._updateInputControlsNodes();var e=this.controlsController.getViewModel().pluck("id"),t=_.pluck(localContext.controlFrames,"paramName"),o=_.difference(e,t);o&&o.length>0&&this.controlsController.removeControls(o),this.controlsController.draw(),this._decrementUnansweredAddRequests()}.bind(localContext);designerBase.sendRequest("da_deleteFrames",new Array("names="+t),o,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerMoveFrames:function(){this._incrementUnansweredAddRequests();var e=this._getNewFramePositions(),t=e.length,o="";e.each(function(e,a){o+=e.frameName+"@@"+e.frameLeft+"@@"+e.frameTop,t-1>a&&(o+="**")});var a=function(){this._updateState(),this._reSyncFramesIfRequired(),this.justDragged=!1,this._decrementUnansweredAddRequests()}.bind(localContext);designerBase.sendRequest("da_moveFrames",new Array("paramString="+o),a,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerResizeFrames:function(e,t,o,a){this._incrementUnansweredAddRequests();var r="",n=null;n=t?t:this._getNewFrameProperties();var i=n.length;n.each(function(e,t){r+=e.frameName+"@@"+e.frameWidth+"@@"+e.frameHeight+"@@"+e.frameFontSize,i-1>t&&(r+="**")});var s=function(){this._updateState(),this._reSyncFramesIfRequired(),this.adjustingFontSize=!1,this._decrementUnansweredAddRequests(),o&&this.toggleAllSelectedFrameScrollBars(!1),e&&this.controlsController.draw(),a&&a()}.bind(localContext);designerBase.sendRequest(e?"da_resizeFramesAndRenderControls":"da_resizeFrames",new Array("paramString="+r),s,{target:e?"dashboardControlsPlaceHolder":"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerSetAutoRefresh:function(e){var t="",o=e.length;e.each(function(e,a){t+=e.name+"@@"+e.interval,o-1>a&&(t+="**")});var a=function(){this._updateState()}.bind(localContext);designerBase.sendRequest("da_setAutoRefresh",new Array("paramString="+t),a,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerToggleContentFrameScrollBars:function(e){var t=function(){this._updateState()}.bind(localContext);designerBase.sendRequest("da_toggleScrollBars",new Array("names="+e),t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerToggleAllContentFramesScrollBars:function(e,t){var o="",a=e.length,r=function(){this._updateState()}.bind(localContext);e.each(function(e,t){o+=e,a-1>t&&(o+="**")}),designerBase.sendRequest("da_setScrollBars",new Array("names="+o,"showScrollBars="+t),r,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerAddClickableFrame:function(e){this._incrementUnansweredAddRequests();var t=function(){this._updateState(),this._deselectAllSelectedDashboardFrames(),this._reSyncFramesIfRequired(),this._decrementUnansweredAddRequests(),this.controlsController.draw()}.bind(localContext);designerBase.sendRequest("da_addButtonFrame",new Array("left="+localContext.nextControlFrameLeft,"top="+localContext.nextControlFrameTop,"width="+localContext.nextControlFrameWidth,"height="+localContext.nextControlFrameHeight,"id="+e),t,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerAddTextLabelFrame:function(){this._incrementUnansweredAddRequests();var e=function(){this._updateState(),this._deselectAllSelectedDashboardFrames(),this._reSyncFramesIfRequired(),this._decrementUnansweredAddRequests(),this.controlsController.draw()}.bind(localContext);designerBase.sendRequest("da_addTextLabelFrame",new Array("label="+encodeText(localContext.TEXT_LABEL),"left="+localContext.nextControlFrameLeft,"top="+localContext.nextControlFrameTop,"width="+localContext.nextControlFrameWidth,"height="+localContext.nextControlFrameHeight),e,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerAddFreeTextLabelFrame:function(){this._incrementUnansweredAddRequests();var e=function(){this._updateState(),this._deselectAllSelectedDashboardFrames(),this._reSyncFramesIfRequired(),this._decrementUnansweredAddRequests(),this.controlsController.draw()}.bind(localContext);designerBase.sendRequest("da_addFreeTextFrame",new Array("label="+encodeText(localContext.FREE_TEXT),"left="+localContext.nextControlFrameLeft,"top="+localContext.nextControlFrameTop,"width="+localContext.nextControlFrameWidth,"height="+localContext.nextControlFrameHeight),e,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerSaveDashboard:function(e,t,o,a){var r=jQuery.Deferred(),n=function(){designerBase._saveConfirmMessage(),this._updateState(),jQuery("#canvas .header .title").html(localContext.dashboardName),r.resolve()}.bind(localContext),i=designerBase.createOverwriteHanlder(r,[e,t,o,!0]);return designerBase.sendRequest("da_save",new Array("dbFolder="+encodeText(e),"dbLabel="+encodeText(t),"dbDesc="+encodeText(o),"aruOverwrite="+a),n,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE},i),r},notifyServerUpdateControlValues:function(e){var t=[];_.map(e,_.bind(function(e,o){t.push(this._formatParamValue(o,e))},this));var o=function(){this._updateState(),this._reSyncFramesIfRequired(),this._updateAllIFramesSRCParam()}.bind(this);designerBase.sendRequest("da_updateControlValues",t,o,{bPost:!0,target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerUpdateText:function(e,t,o){var a=function(){this._updateState(),this._reSyncFramesIfRequired(),this.controlsController.draw()}.bind(this);designerBase.sendRequest("da_setTextLabel",new Array("name="+encodeText(e),"label="+encodeText(t),"width="+encodeText(o)),a,{target:"dashboardControlsPlaceHolder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerReset:function(e,t){var o=function(){this._updateState(),this._reSyncFrames(!1),this._updateInputControlsNodes(),this._updateAllIFramesSRCParam()}.bind(this);designerBase.sendRequest("da_reset",new Array("layoutLeft="+e,"layoutTop="+t),o,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerDeleteTitle:function(){var e=function(){this._updateState()}.bind(this);designerBase.sendRequest("da_setTitle",new Array("title=_null"),e,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerUpdateTitle:function(){if($("title")){var e=getInnerText($("title"));localContext._isDashboardTitleDeleted()&&(e="_null",$("title").update(localContext.NO_DASHBOARD_TITLE_TEXT));var t=function(){this._updateState()}.bind(this);designerBase.sendRequest("da_setTitle",new Array("title="+encodeText(e)),t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})}},notifyServerConvertToProportionalMode:function(){var e=localContext._calculateSizeConversionFactor(),t=localContext._calculateGrowthFactorForProportionalRuntime(),o=function(){this._updateState(),this._reSyncFrames(!0),this._changeScreenSizeForProportionalMode()}.bind(localContext);isNaN(e)||designerBase.sendRequest("da_convertToProportionalMode",new Array("conversionFactor="+e,"growthFactor="+t),o,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerConvertToFixedMode:function(){var e=localContext.conversionFactor,t=function(){this._updateState(),this._reSyncFrames(!0),this._changeScreenSizeForFixedMode()}.bind(localContext);isNaN(e)||(0>=e&&(e=1),designerBase.sendRequest("da_convertToFixedMode",new Array("conversionFactor="+e),t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE}))},notifyServerUpdateSizeConversionFactor:function(e){var t=function(){this._updateState()}.bind(localContext);e&&!isNaN(e)&&designerBase.sendRequest("da_setConversionFactor",new Array("conversionFactor="+e),t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},notifyServerUpdateGrowthFactor:function(e){var t=function(){this._updateState()}.bind(localContext);e&&!isNaN(e)&&designerBase.sendRequest("da_setGrowthFactor",new Array("growthFactor="+e),t,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},tryToKeepServerAlive:function(){var e=function(){this._updateState()}.bind(this);designerBase.sendRequest("da_tryToKeepServerAlive",[],e,{target:"dashboardStatePlaceholder",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})}};